<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Port Forwarding and Tunneling | Hacking Notes</title>
<meta name="generator" content="Jekyll v3.8.4" />
<meta property="og:title" content="Port Forwarding and Tunneling" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Introduction" />
<meta property="og:description" content="Introduction" />
<link rel="canonical" href="http://0.0.0.0:4000/hackingnotes/post-exploitation/port-forwarding/" />
<meta property="og:url" content="http://0.0.0.0:4000/hackingnotes/post-exploitation/port-forwarding/" />
<meta property="og:site_name" content="Hacking Notes" />
<script type="application/ld+json">
{"description":"Introduction","url":"http://0.0.0.0:4000/hackingnotes/post-exploitation/port-forwarding/","@type":"Article","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/hackingnotes/siteicon.png"}},"headline":"Port Forwarding and Tunneling","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

		<link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/hackingnotes/feed.xml" title="Hacking Notes" />

		<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic|Open+Sans:400,400italic,600,600italic,700,700italic|Inconsolata:400,700">
		<link rel="stylesheet" href="/hackingnotes/css/main.css">
		<link rel="apple-touch-icon" href="/hackingnotes/apple-touch-icon.png">
		<link rel="icon" type="image/png" href="/hackingnotes/touch-icon.png" sizes="192x192">
		<link rel="icon" type="image/png" href="/hackingnotes/images/favicon.png">

		
	</head>

	<body>
		<header>
			<h1>
				<a href="/hackingnotes/"><img src="/hackingnotes/images/emblem.svg" width="40" height="40" alt="Hacking Notes logo"></a>
				Hacking Notes
				<button type="button" class="open-nav" id="open-nav"></button>
			</h1>

			<form action="/hackingnotes/search/" method="get">
				<input type="text" name="q" id="search-input" placeholder="Search" autofocus>
				<input type="submit" value="Search" style="display: none;">
			</form>

			<nav class="full-navigation">
				<ul>
					<li class="nav-item top-level ">
						
						<a href="/hackingnotes/">What is this?</a>
					</li>
				</ul>

				<ul>
					
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/active-directory/domain-enumeration/">Active Directory</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/active-directory/domain-enumeration/">Domain Enumeration</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/active-directory/lateral-movement/">Lateral Movement</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/active-directory/domain-persistence/">Domain Persistence</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/active-directory/domain-privesc/">Domain Privilege Escalation</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/active-directory/ad-attacks/">AD Attacks</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/client-side-attacks/evil-pdf/">Client Side Attacks</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/client-side-attacks/evil-pdf/">Evil PDF</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/client-side-attacks/microsoft-office-macros/">Microsoft Office Macros</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/enumeration/host-discovery/">Enumeration</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/enumeration/host-discovery/">Host Discovery</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/enumeration/dns-enumeration/">DNS Enumeration</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/enumeration/os-discovery/">OS Discovery</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/enumeration/port-scanning/">Port Scanning</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/enumeration/waf-evasion/">WAF Evasion</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/exploiting/buffer-overflow/">Exploiting</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/exploiting/buffer-overflow/">Buffer Overflow</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/hacking-wifi/theory/">Hacking Wifi</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/hacking-wifi/theory/">Theory</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/hacking-wifi/wep/">Hacking Wifi - WEP</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/hacking-wifi/wpa-wpa2-psk/">Hacking Wifi - WPA/WPA2 PSK</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/hacking-wifi/wpa-wpa2-peap-enterprise/">Hacking Wifi - WPA/WPA2 PEAP (Enterprise)</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/other/hacking-aws/">Other</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/other/hacking-aws/">Hacking AWS</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/other/hacking-with-powershell/">Hacking with PowerShell</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level current">
							
							<a href="/hackingnotes/post-exploitation/av-evasion/">Post Exploitation</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/post-exploitation/av-evasion/">AV Evasion</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/post-exploitation/bypass-uac/">Bypass UAC</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/post-exploitation/get-credentials/">Gathering Credentials</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/post-exploitation/password-cracking/">Password Cracking</a></li>
								
									<li class="nav-item current"><a href="/hackingnotes/post-exploitation/port-forwarding/">Port Forwarding and Tunneling</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/post-exploitation/reverse-shell/">Reverse Shell</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/post-exploitation/transfering-files/">Transfering Files</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/privilege-escalation/linux-privesc/">Privilege Escalation</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/privilege-escalation/linux-privesc/">Linux Privesc</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/privilege-escalation/windows-privesc/">Windows Privesc</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/privilege-escalation/run-commands-as/">Run Commands As</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/reconnaissance/information-gathering/">Reconnaissance</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/reconnaissance/information-gathering/">Information Gathering</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/services/ftp/">Services</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/services/ftp/">PORT 21/tcp - FTP</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/smtp/">PORT 25/tcp - SMTP</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/dns/">PORT 53/tcp - DNS</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/http/">PORT 80/tcp, 443/tcp - HTTP Server</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/rpcbind/">PORT 111/tcp - RPCBind</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/imap/">PORT 143/tcp, 993/tcp - IMAP</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/smb/">PORT 139/tcp, 445/tcp - SMB</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/snmp/">PORT 161/udp - SNMP</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/java-rmi/">PORT 1100/tcp - Java RMI</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/sql-server/">PORT 1433/tcp - Microsoft SQL Server</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/nfs/">PORT 2049/tcp - NFS</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/mysql/">PORT 3306/tcp - MySQL Server</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/rdp/">PORT 3389/tcp - RDP</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/software/wordpress/">Software</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/software/wordpress/">WordPress</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/software/drupal/">Drupal</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/software/tomcat/">Tomcat</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/software/jenkins/">Jenkins</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/software/pypi-server/">PyPI Server</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/web/file-inclusion/">Web</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/web/file-inclusion/">File Inclusion</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/web/login-panes/">Login Panes</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/web/sqli/">SQL Injection (SQLi)</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/web/nosqli/">NoSQL Injection (NoSQLi)</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/web/templates-injections/">Server Side Templates Injections (SSTI)</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/web/unrestricted-file-upload/">Unrestricted File Upload</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/web/oauth-2.0-bypass/">OAuth 2.0 Bypass</a></li>
								
							</ul>
						</li>
					
				</ul>

				<ul>
					<li class="nav-item top-level ">
						
						<a href="/hackingnotes/changelog/">Change Log</a>
					</li>
				</ul>
			</nav>
		</header>

		<section class="main">
			<div class="page-header">
				<h2>Post Exploitation</h2>
				<h3>Port Forwarding and Tunneling</h3>
			</div>
			<article class="content">
				<h1 id="introduction">Introduction</h1>

<p>In computer networking, port forwarding or port mapping is an application of network address translation that redirects a communication request from one address and port number combination to another.</p>

<h1 id="simple-port-forwarding-or-tunneling">Simple Port Forwarding or Tunneling</h1>

<h2 id="ssh-port-forwarding">SSH Port Forwarding</h2>

<p>Reverse SSH port forwarding specifies that the given port on the remote server host is to be forwarded to the given host and port on the local side.</p>

<p><img src="/hackingnotes/images/ssh_portforwarding.png" alt="SSH Port Forwarding" /></p>

<h3 id="ssh-local-port-forwarding">SSH Local Port Forwarding</h3>

<p><strong>-L</strong> is a local tunnel (YOU –&gt; CLIENT). If a site was blocked, you can forward the traffic to a server you own and view it. For example, if <em>test</em> was blocked at work, you can do <strong>the next command.</strong> Going to localhost:9000 on your machine, will load <em>test</em> traffic using your other server.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~$ ssh -N -L 900:test.com:80 user@example.com
</code></pre></div></div>

<h3 id="ssh-remote-port-forwarding"><strong>SSH Remote Port Forwarding</strong></h3>

<p><strong>-R</strong> is a remote tunnel (YOU &lt;– CLIENT). You forward your traffic to the other server for others to view. Similar to the example above, but in reverse. Sometimes the ssh server is off and you need to ssh back to your attacking machine in order to forward a traffic port.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>user@target:~$ ssh -N -R example.com:80:test.com:80 user@example.com
</code></pre></div></div>

<h3 id="ssh-dynamic-port-forwarding">SSH Dynamic Port Forwarding</h3>

<p>This is the coolest one because uses <code class="highlighter-rouge">SOCKS4 proxy</code> and redirects all traffic sent via proxy to the target machine, which would be similar like launching our scripts from the target machine.</p>

<p>First we need to configure <code class="highlighter-rouge">proxychains</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo echo "socks4    5566" &gt;&gt; /etc/proxychains.conf
</code></pre></div></div>

<p>Create the dynamic tunnel with the specified port.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh -N -D 5566 user@example.com
</code></pre></div></div>

<p>After that all commands that begins with <code class="highlighter-rouge">proxychains</code> will be sent through the proxy.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo proxychains nmap -sV -sC 10.10.10.10
</code></pre></div></div>

<h3 id="ssh-reverse-dynamic-port-forwarding">SSH Reverse Dynamic Port Forwarding</h3>

<p>If the host is not specified ssh creates a socks4 tunnel. So if there are no ssh service on the target machine we can also create a tunnel.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh -N -R 5566 kali@kali
</code></pre></div></div>

<p>If it’s not possible to setup a tty, because the target machine does not have python installed, we would not be able to put the password on the prompt. So instead of that we will use a pair of keys.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen
ssh -N -R 5566 -i ~/.ssh/id_rsa -o "UserKnownHostsFile=/dev/null" -o "StrictHostKeyChecking=no" kali@kali
</code></pre></div></div>

<p>Remember to add the id_rsa.pub key on the authorized keys.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDORkdAZlHfTTbMZNPX7VaU3yx9dl3a1RwP4Px4SZWpkE3I95P2X9aAD4TvyiyvrEYzhOMymGulE69pAbXnfjvzFpMfQRUBEjrMqQv+jUL62MhpiVaB8AkO9iay2j90mNxLmrqNRSEuDiVpX2eDGcHKAhLno1uOrMkvvzc3HTVfLy8/ukbVmFGCb8TSA9mvcnjTyBeIA67yC5oPeHQ4GMKQIunrcV8XFj2qX4iTDRrUXyLj2socdCVwZAymJzTPbLEY/1oSRw6JkaR+iszQXKl+J9PR6Ev01EkmMPac5iRmtS9+6hXzKV40t6F5gBJGXvFA1qQwfydHLt8noUTYXuYymAx7MW+fO7blrjVVfbHGag03qz1xlQPcaG/CtQeV94YWJI47Cj91j6t+iZhj4ntwbgYcrOl3nm/7hpJdrXdOdxFeuEtbUmxdO7ljXsr7q9hKLHONtFVII5+ej8gBvw0N0MtJRnVCIAcjizNCz8gtBsxIVKSV9pxxvagSKeIoKus= mysql@target' &gt; authorized_keys
</code></pre></div></div>

<h2 id="chisel">Chisel</h2>

<p>Chisel is a fast TCP/UDP tunnel, transported over HTTP, secured via SSH. Single executable including both client and server. Written in Go (golang). Chisel is mainly useful for passing through firewalls, though it can also be used to provide a secure endpoint into your network. Available on Windows and Linux</p>

<ul>
  <li><a href="https://github.com/jpillora/chisel">https://github.com/jpillora/chisel</a></li>
</ul>

<blockquote>
  <p><strong>Note</strong>: Download a Release</p>
</blockquote>

<h3 id="server">Server</h3>

<p>Start the <em>Chisel</em> server on your <strong>attacker machine</strong> specifying the port to use.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./chisel server -p PORT --reverse
</code></pre></div></div>

<h3 id="client">Client</h3>

<p>On the target machine, you need to start the <em>Chisel</em> client, specify the server IP and port, and specify the ports to tunneling.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./chisel client IP:PORT R:PORT_KALI:localhost:PORT_VICTIM R:PORT2_KALI:localhost:PORT2_VICTIM
</code></pre></div></div>

<h2 id="rinetd">rinetd</h2>

<p><code class="highlighter-rouge">rinetd</code> is a port forwarding tool easily configurable and installable.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install rinetd
</code></pre></div></div>

<p>The <code class="highlighter-rouge">rinetd</code> configuration file is <code class="highlighter-rouge">/etc/rinetd.conf</code> that lists all forwarding rules.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># bindadress  bindport  connectaddress  connectport  options...
# 0.0.0.0     80        192.168.1.2     80
# ::1         80        192.168.1.2     80
# 0.0.0.0     80        fe80::1         80
# 127.0.0.1   4000      127.0.0.1       3000
# 127.0.0.1   4000/udp  127.0.0.1       22           [timeout=1200]
# 127.0.0.1   8000/udp  192.168.1.2     8000/udp     [src=192.168.1.2,timeout=1200]
</code></pre></div></div>

<p>Remember restart the service:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo service rinetd restart
</code></pre></div></div>

<h2 id="httptunnel-hts">httptunnel (hts)</h2>

<p><code class="highlighter-rouge">hts</code> is a the <code class="highlighter-rouge">httptunnel</code> server which has an easily installation.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install httptunnel
</code></pre></div></div>

<p>The use is similar a <code class="highlighter-rouge">rinetd</code> but the configuration is established by parameters.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hts --forward-port localhost:8888 example.com:1234
</code></pre></div></div>

<h2 id="plinkexe">PLINK.exe</h2>

<p><a href="https://www.chiark.greenend.org.uk/\~sgtatham/putty/latest.html">Plink </a>is a windows based command line port forwarding tool based on the PuTTY project. Same as SSH has local, remote and dynamic port forwarding.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>plink.exe -ssh -l &lt;user&gt; -pw &lt;pass&gt; -R &lt;kali-ip&gt;:80:127.0.0.1:80 &lt;kali-ip&gt;
plink.exe -ssh -l &lt;user&gt; -pw &lt;pass&gt; -L 127.0.0.1:80:test.com:80 test.com
plink.exe -ssh -l &lt;user&gt; -pw &lt;pass&gt; -D 5566 test.com
</code></pre></div></div>

<blockquote>
  <p><strong>Warning:</strong> May be in a Reverse Shell the command doen’t works so you need to pipe to:</p>

  <table>
    <tbody>
      <tr>
        <td>**cmd.exe /c echo y</td>
        <td>plink.exe -ssh …..**</td>
      </tr>
    </tbody>
  </table>
</blockquote>

<h2 id="netsh"><strong>NETSH</strong></h2>

<p><code class="highlighter-rouge">netsh</code> utility is installed by default on every modern version of Windows.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh interface portproxy add v4tov4 listenport=4455 listenaddress=10.0.0.1 connectport=445 connectaddress=192.168.0.1
</code></pre></div></div>

<p>By default, Windows will block our connections with the Firewall, being administrator we can easily add a rule to let the traffic pass.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh advfirewall firewall add rule name="forward_port_rule" protocol=TCP dir=in localip=10.0.0.1 localport=4455 action=allow
</code></pre></div></div>

<h1 id="doble-tunneling">Doble Tunneling</h1>

<p>Sometimes in Internal Penetration test we can find the following scenario, where we need to access to a network NET3.</p>

<ul>
  <li><strong>Kali</strong> has access to <strong>NET1</strong>.</li>
  <li><strong>SRV1</strong> has access to <strong>NET2.</strong></li>
  <li><strong>SRV2</strong> has access to <strong>NET3</strong>.</li>
</ul>

<p><img src="/hackingnotes/images/doble_pivoting.png" alt="" /></p>

<p>We can access to <strong>NET2</strong> via creating a dynamic SSH Tunnel (SOCKS4) from a host on <strong>NET1</strong> which have access to NET2 such as <strong>SRV1</strong>. SRV1 does not have access to NET3.</p>

<p>To access to NET3 we need to create a dynamic SSH Tunnel to SRV2, which we don’t have access directly from Kali.</p>

<h2 id="ssh-dynamic-port-forwarding-1">SSH Dynamic Port Forwarding</h2>

<p>Create a Port forwarding From Kali to SRV1 redirecting the SSH port of SRV2 to a local port such as 9998.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali~:$ ssh -L 9998:SRV2:22 -N user@SRV1
</code></pre></div></div>

<p>And finally create the dynamic SSH tunnel to SRV2.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali~:$ ssh -N -D 5566 -p 9998 user@localhost
</code></pre></div></div>

<p>Final graph where we can see what we do with the tunnels.</p>

<p><img src="/hackingnotes/images/doble_pivotting_2.png" alt="" /></p>

<h2 id="ssh-local-port-forwarding-1">SSH Local Port Forwarding</h2>

<p>To forward only one port we can do a double Local port forwarding.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>user@SRV1~:$ ssh -N -L 9999:SRV3:80 user@SRV2
root@kali~:$ ssh -N -L 9999:localhost:9999 user@SRV1
</code></pre></div></div>

<p>Now port 9999 of the kali is the port 80 of SRV3.</p>

			</article>
		</section>

		<script>
			document.getElementById("open-nav").addEventListener("click", function () {
				document.body.classList.toggle("nav-open");
			});
		</script>
	</body>
</html>
